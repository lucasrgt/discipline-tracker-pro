<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Tracker Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Scale = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
            </svg>
        );

        const TrendingDown = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
            </svg>
        );

        const Calendar = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const Target = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Flame = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" />
            </svg>
        );

        const Award = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
        );

        const AlertTriangle = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        );

        const CheckCircle2 = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Plus = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const Trash2 = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const Download = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        const Upload = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
        );

        const Ruler = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
            </svg>
        );

        const Settings = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const X = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const Beef = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
            </svg>
        );

        const TrendingUp = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
        );

        const Activity = ({ className = "h-6 w-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
        );

        function BodyTracker() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [evaluations, setEvaluations] = useState([]);
            const [dailyLogs, setDailyLogs] = useState([]);
            const [showAddEval, setShowAddEval] = useState(false);
            const [showAddLog, setShowAddLog] = useState(false);
            const [editingEval, setEditingEval] = useState(null); // ID da avalia√ß√£o sendo editada
            const [editingLog, setEditingLog] = useState(null); // ID do log sendo editado
            const [dailyLogViewDate, setDailyLogViewDate] = useState(new Date()); // Data de navega√ß√£o nos logs
            const [deficitViewMode, setDeficitViewMode] = useState('real'); // 'real' ou 'simulado'
            const [basalCalories, setBasalCalories] = useState(2300);
            const [targetBodyFat, setTargetBodyFat] = useState(6.0);
            const [isSetupComplete, setIsSetupComplete] = useState(false);
            const [showImportOnWelcome, setShowImportOnWelcome] = useState(false);
            const [dismissedGoodAlert, setDismissedGoodAlert] = useState(false);
            const [calendarView, setCalendarView] = useState('monthly');
            const [showSettingsModal, setShowSettingsModal] = useState(false);
            
            // M√≥dulos opcionais
            const [spiritualModeEnabled, setSpiritualModeEnabled] = useState(false);
            const [nofapModeEnabled, setNofapModeEnabled] = useState(false);
            const [spiritualLogs, setSpiritualLogs] = useState([]);
            const [nofapLogs, setNofapLogs] = useState([]);
            
            // Visualiza√ß√£o de m√©tricas (mensal vs hist√≥rico)
            const [spiritualMetricsView, setSpiritualMetricsView] = useState('monthly'); // 'monthly' ou 'alltime'
            const [nofapMetricsView, setNofapMetricsView] = useState('monthly'); // 'monthly' ou 'alltime'
            
            // Calend√°rio do Journal Espiritual
            const [spiritualJournalDate, setSpiritualJournalDate] = useState(() => {
                const now = new Date();
                return { year: now.getFullYear(), month: now.getMonth() };
            });
            const [selectedSpiritualDay, setSelectedSpiritualDay] = useState(null); // Dia selecionado para ver detalhes
            
            // Sistema de Navega√ß√£o Temporal
            const [currentViewDate, setCurrentViewDate] = useState(new Date());
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normaliza para meia-noite
            
            // Helper: Verifica se uma data √© hoje
            const isToday = (date) => {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                return d.getTime() === today.getTime();
            };
            
            // Helper: Verifica se uma data √© no futuro
            const isFutureDate = (date) => {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                return d.getTime() > today.getTime();
            };
            
            // Helper: Formata m√™s/ano para exibi√ß√£o
            const getMonthYearLabel = (date) => {
                return date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
            };
            
            // Navega√ß√£o: Anterior/Pr√≥ximo
            const navigateCalendar = (direction) => {
                const newDate = new Date(currentViewDate);
                if (calendarView === 'monthly') {
                    newDate.setMonth(newDate.getMonth() + direction);
                } else {
                    newDate.setDate(newDate.getDate() + (7 * direction));
                }
                setCurrentViewDate(newDate);
            };
            
            // Reset para hoje
            const goToToday = () => {
                setCurrentViewDate(new Date());
            };
            
            // Admin mode (secret: press Ctrl+Shift+A three times)
            const [adminMode, setAdminMode] = useState(() => {
                return localStorage.getItem('adminMode') === 'true';
            });
            const [adminKeyPressCount, setAdminKeyPressCount] = useState(0);
            const [debugSettings, setDebugSettings] = useState({
                forceAlert: null, // null, 'critical', 'warning', 'caution', 'good', 'excellent'
                forceFastingDays: null,
                forceDeficit: null
            });

            // Form states
            const [newEval, setNewEval] = useState({
                date: new Date().toISOString().split('T')[0],
                weight: '',
                triceps: '',
                subscapular: '',
                chest: '',
                midaxillary: '',
                abdominal: '',
                suprailiac: '',
                thigh: ''
            });

            const [newLog, setNewLog] = useState({
                date: new Date().toISOString().split('T')[0],
                calories: '',
                isFasting: false,
                isRefeed: false,
                exerciseCalories: {
                    strength: '',
                    cardio: ''
                },
                hungerLevel: 5, // 1-10 scale
                energyLevel: 5, // 1-10 scale
                notes: '',
                // Spiritual mode fields
                meditations: [], // Array de {type: 'limpeza-propria'|'limpeza-ambiente'|'protecao'|'conexao'|'consagracao-cristais', minutes: number}
                gratitude: false,
                judgedOthers: false,
                charity: false,
                feltAnger: false, // Sentiu raiva/ira
                gossiped: false, // Fofocou
                spiritualNotes: '',
                // NoFap mode fields
                cleanDay: true, // true = sem PMO
                urgeLevel: 0, // 0-10 scale
                nofapNotes: ''
            });
            
            // Estado tempor√°rio para adicionar medita√ß√£o
            const [newMeditation, setNewMeditation] = useState({
                type: 'limpeza-propria',
                minutes: ''
            });

            // Setup form state
            const [setupData, setSetupData] = useState({
                date: new Date().toISOString().split('T')[0],
                weight: '',
                basalCalories: '',
                targetBodyFat: '',
                triceps: '',
                subscapular: '',
                chest: '',
                midaxillary: '',
                abdominal: '',
                suprailiac: '',
                thigh: ''
            });

            // Admin mode activation (click title 5 times)
            const handleTitleClick = () => {
                const newCount = adminKeyPressCount + 1;
                setAdminKeyPressCount(newCount);
                
                if (newCount >= 5) {
                    if (!adminMode) {
                        // Ativando modo admin - avisar para salvar dados
                        const confirmed = confirm(
                            'üîß MODO ADMIN / DEBUG\n\n' +
                            '‚ö†Ô∏è IMPORTANTE: Este modo adiciona dados de teste que podem afetar suas estat√≠sticas.\n\n' +
                            'üíæ Recomendamos EXPORTAR seus dados antes de ativar!\n\n' +
                            'Deseja ativar o Modo Admin?'
                        );
                        
                        if (confirmed) {
                            setAdminMode(true);
                            localStorage.setItem('adminMode', 'true');
                            alert('üîì MODO ADMIN ATIVADO!\n\nLembre-se: Os dados de teste N√ÉO s√£o salvos automaticamente no localStorage.');
                        }
                        setAdminKeyPressCount(0);
                    } else {
                        // Desativando
                        setAdminMode(false);
                        localStorage.setItem('adminMode', 'false');
                        alert('üîí Modo Admin Desativado');
                        setAdminKeyPressCount(0);
                    }
                } else {
                    setTimeout(() => setAdminKeyPressCount(0), 2000);
                }
            };

            // Load data from localStorage and check if setup is complete
            useEffect(() => {
                const savedEvals = localStorage.getItem('bodyEvaluations');
                const savedLogs = localStorage.getItem('dailyLogs');
                const savedBasal = localStorage.getItem('basalCalories');
                const savedTargetBF = localStorage.getItem('targetBodyFat');
                const setupComplete = localStorage.getItem('setupComplete');
                const savedSpiritualMode = localStorage.getItem('spiritualModeEnabled');
                const savedNofapMode = localStorage.getItem('nofapModeEnabled');
                const savedSpiritualLogs = localStorage.getItem('spiritualLogs');
                const savedNofapLogs = localStorage.getItem('nofapLogs');
                
                if (savedEvals) setEvaluations(JSON.parse(savedEvals));
                if (savedLogs) setDailyLogs(JSON.parse(savedLogs));
                if (savedBasal) setBasalCalories(Number(savedBasal));
                if (savedTargetBF) setTargetBodyFat(Number(savedTargetBF));
                if (savedSpiritualMode) setSpiritualModeEnabled(savedSpiritualMode === 'true');
                if (savedNofapMode) setNofapModeEnabled(savedNofapMode === 'true');
                if (savedSpiritualLogs) setSpiritualLogs(JSON.parse(savedSpiritualLogs));
                if (savedNofapLogs) setNofapLogs(JSON.parse(savedNofapLogs));
                
                // Check if setup is complete
                if (setupComplete === 'true') {
                    setIsSetupComplete(true);
                }
            }, []);

            // Save to localStorage
            useEffect(() => {
                localStorage.setItem('bodyEvaluations', JSON.stringify(evaluations));
            }, [evaluations]);

            useEffect(() => {
                localStorage.setItem('dailyLogs', JSON.stringify(dailyLogs));
                // Reseta o dismissed quando novos logs s√£o adicionados
                setDismissedGoodAlert(false);
            }, [dailyLogs]);

            useEffect(() => {
                localStorage.setItem('basalCalories', basalCalories.toString());
            }, [basalCalories]);

            useEffect(() => {
                localStorage.setItem('targetBodyFat', targetBodyFat.toString());
            }, [targetBodyFat]);

            useEffect(() => {
                localStorage.setItem('spiritualModeEnabled', spiritualModeEnabled.toString());
            }, [spiritualModeEnabled]);

            useEffect(() => {
                localStorage.setItem('nofapModeEnabled', nofapModeEnabled.toString());
            }, [nofapModeEnabled]);

            useEffect(() => {
                localStorage.setItem('spiritualLogs', JSON.stringify(spiritualLogs));
            }, [spiritualLogs]);

            useEffect(() => {
                localStorage.setItem('nofapLogs', JSON.stringify(nofapLogs));
            }, [nofapLogs]);

            // Export data to JSON
            const exportData = () => {
                const data = {
                    evaluations,
                    dailyLogs,
                    basalCalories,
                    targetBodyFat,
                    spiritualModeEnabled,
                    nofapModeEnabled,
                    spiritualLogs,
                    nofapLogs,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `body-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            // Import data from JSON
            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.evaluations) setEvaluations(data.evaluations);
                        if (data.dailyLogs) setDailyLogs(data.dailyLogs);
                        if (data.basalCalories) setBasalCalories(data.basalCalories);
                        if (data.targetBodyFat) setTargetBodyFat(data.targetBodyFat);
                        if (data.spiritualModeEnabled !== undefined) setSpiritualModeEnabled(data.spiritualModeEnabled);
                        if (data.nofapModeEnabled !== undefined) setNofapModeEnabled(data.nofapModeEnabled);
                        if (data.spiritualLogs) setSpiritualLogs(data.spiritualLogs);
                        if (data.nofapLogs) setNofapLogs(data.nofapLogs);
                        localStorage.setItem('setupComplete', 'true');
                        setIsSetupComplete(true);
                        alert('‚úÖ Dados importados com sucesso!');
                    } catch (error) {
                        alert('‚ùå Erro ao importar dados. Verifique o arquivo.');
                    }
                };
                reader.readAsText(file);
            };

            // Complete initial setup
            const completeSetup = () => {
                if (!setupData.weight || !setupData.basalCalories || !setupData.triceps || !setupData.targetBodyFat) {
                    alert('‚ö†Ô∏è Por favor, preencha pelo menos: Peso, Calorias Basais, % de Gordura Desejado e Triceps');
                    return;
                }

                // Create initial evaluation
                const initialEval = {
                    id: Date.now(),
                    date: setupData.date,
                    weight: Number(setupData.weight),
                    triceps: Number(setupData.triceps),
                    subscapular: Number(setupData.subscapular) || 0,
                    chest: Number(setupData.chest) || 0,
                    midaxillary: Number(setupData.midaxillary) || 0,
                    abdominal: Number(setupData.abdominal) || 0,
                    suprailiac: Number(setupData.suprailiac) || 0,
                    thigh: Number(setupData.thigh) || 0
                };

                // Save everything
                setEvaluations([initialEval]);
                setBasalCalories(Number(setupData.basalCalories));
                setTargetBodyFat(Number(setupData.targetBodyFat));
                localStorage.setItem('bodyEvaluations', JSON.stringify([initialEval]));
                localStorage.setItem('basalCalories', setupData.basalCalories);
                localStorage.setItem('targetBodyFat', setupData.targetBodyFat);
                localStorage.setItem('setupComplete', 'true');
                setIsSetupComplete(true);
            };

            // Fun√ß√£o auxiliar para formatar n√∫meros com seguran√ßa (evita NaN)
            const safeFixed = (value, decimals = 1) => {
                if (value === null || value === undefined || isNaN(value)) return '0';
                return value.toFixed(decimals);
            };

            // Calculate body fat % using Jackson-Pollock 7 dobras (male)
            const calculateBodyFat = (eval_data) => {
                if (!eval_data) return 0;
                const sum = (eval_data.triceps || 0) + (eval_data.subscapular || 0) + (eval_data.chest || 0) + 
                            (eval_data.midaxillary || 0) + (eval_data.abdominal || 0) + (eval_data.suprailiac || 0) + (eval_data.thigh || 0);
                
                if (sum === 0) return 0;
                
                // Jackson-Pollock 7-site formula for men
                const density = 1.112 - (0.00043499 * sum) + (0.00000055 * sum * sum) - (0.00028826 * 25);
                const bodyFat = ((4.95 / density) - 4.5) * 100;
                
                return isNaN(bodyFat) ? 0 : bodyFat;
            };

            // Calculate protein requirements
            const calculateProteinNeeds = (leanMassKg) => {
                const leanMassLbs = leanMassKg * 2.20462;
                const minimum = Math.round(leanMassLbs * 0.8); // 0.8g/lb massa magra = 1.6g/kg massa magra
                const ideal = Math.round(leanMassKg * 2); // 2g/kg massa magra
                return { minimum, ideal };
            };

            // Check if refeed is needed
            const getRefeedStatus = () => {
                const deficitDays = dailyLogs.filter(log => {
                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                    const deficit = (basalCalories + exerciseTotal) - log.calories;
                    return deficit >= 500 && !log.isFasting && !log.isRefeed;
                }).length;

                const lastRefeed = dailyLogs.filter(log => log.isRefeed).sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                const daysSinceRefeed = lastRefeed 
                    ? Math.floor((new Date() - new Date(lastRefeed.date)) / (1000 * 60 * 60 * 24))
                    : deficitDays;

                const needsRefeed = deficitDays >= 12 && daysSinceRefeed >= 12; // A cada ~2 semanas de deficit
                const refeedRecommendation = basalCalories + 300; // Manuten√ß√£o + 300 kcal

                return {
                    needsRefeed,
                    deficitDays,
                    daysSinceRefeed,
                    refeedRecommendation,
                    lastRefeedDate: lastRefeed?.date
                };
            };

            // Calculate muscle mass change
            const calculateMuscleMassChange = () => {
                if (evaluations.length < 2) return { 
                    change: 0, 
                    trend: 'stable',
                    history: []
                };
                
                const history = evaluations.map(ev => {
                    const bf = calculateBodyFat(ev);
                    const fatMass = (bf / 100) * ev.weight;
                    const leanMass = ev.weight - fatMass;
                    return {
                        date: ev.date,
                        leanMass: leanMass,
                        fatMass: fatMass,
                        weight: ev.weight
                    };
                });
                
                const first = history[0];
                const latest = history[history.length - 1];
                const change = latest.leanMass - first.leanMass;
                const trend = change > 0.5 ? 'gaining' : change < -0.5 ? 'losing' : 'stable';
                
                return { change, trend, history };
            };

            // Calculate deficit needed to reach target BF%
            const calculateDeficitNeeded = () => {
                if (evaluations.length === 0) return { 
                    deficit: 0, 
                    currentBF: 0, 
                    fatToLose: 0, 
                    daysNeeded: 0,
                    totalSkinfolds: 0,
                    targetWeight: 0,
                    avgDailyDeficit: 0,
                    deficitAccomplished: 0
                };
                
                const latest = evaluations[evaluations.length - 1];
                const currentBF = calculateBodyFat(latest);
                const currentFatMass = (currentBF / 100) * latest.weight;
                const targetFatMass = (targetBodyFat / 100) * latest.weight;
                const fatToLose = currentFatMass - targetFatMass;
                
                // 1kg of fat = ~7700 kcal
                const totalDeficitNeeded = fatToLose * 7700;
                
                // Calcula deficit j√° alcan√ßado (progresso desde a primeira avalia√ß√£o)
                let deficitAccomplished = 0;
                if (evaluations.length > 1) {
                    const first = evaluations[0];
                    const weightLost = first.weight - latest.weight;
                    deficitAccomplished = weightLost * 7700;
                }
                
                // Calculate average daily deficit from last 7 days
                const last7Days = dailyLogs.filter(log => {
                    const logDate = new Date(log.date);
                    const daysAgo = Math.floor((new Date() - logDate) / (1000 * 60 * 60 * 24));
                    return daysAgo <= 7;
                });
                
                let avgDailyDeficit = 500; // Default fallback
                let daysNeeded;
                
                if (last7Days.length > 0) {
                    const totalConsumed = last7Days.reduce((sum, log) => sum + log.calories, 0);
                    const totalBasal = basalCalories * last7Days.length;
                    const totalDeficit = totalBasal - totalConsumed;
                    avgDailyDeficit = Math.round(totalDeficit / last7Days.length);
                    
                    // If average deficit is negative or too small, use 500 as fallback
                    if (avgDailyDeficit <= 100) {
                        avgDailyDeficit = 500;
                        daysNeeded = Math.ceil(totalDeficitNeeded / avgDailyDeficit);
                    } else {
                        daysNeeded = Math.ceil(totalDeficitNeeded / avgDailyDeficit);
                    }
                } else {
                    // No data yet, use 500 kcal/day estimate
                    daysNeeded = Math.ceil(totalDeficitNeeded / 500);
                }
                
                // Total skinfolds
                const totalSkinfolds = parseFloat((latest.triceps + latest.subscapular + latest.chest + 
                                     latest.midaxillary + latest.abdominal + latest.suprailiac + latest.thigh).toFixed(1));
                
                return { 
                    deficit: totalDeficitNeeded, 
                    currentBF, 
                    fatToLose,
                    daysNeeded,
                    targetWeight: parseFloat((latest.weight - fatToLose).toFixed(2)),
                    totalSkinfolds,
                    avgDailyDeficit,
                    deficitAccomplished
                };
            };

            // Calculate total calories consumed vs basal
            const getTotalCaloriesStats = () => {
                const today = new Date().toISOString().split('T')[0];
                const last7Days = dailyLogs.filter(log => {
                    const logDate = new Date(log.date);
                    const daysAgo = Math.floor((new Date() - logDate) / (1000 * 60 * 60 * 24));
                    return daysAgo <= 7;
                });
                
                const totalConsumed = last7Days.reduce((sum, log) => sum + log.calories, 0);
                const totalExerciseCalories = last7Days.reduce((sum, log) => {
                    const strength = log.exerciseCalories?.strength || 0;
                    const cardio = log.exerciseCalories?.cardio || 0;
                    return sum + strength + cardio;
                }, 0);
                const totalBasal = basalCalories * last7Days.length;
                const actualDeficit = (totalBasal + totalExerciseCalories) - totalConsumed;
                const fastingDays = dailyLogs.filter(log => log.isFasting).length;
                
                return { totalConsumed, totalBasal, actualDeficit, daysLogged: last7Days.length, fastingDays, totalExerciseCalories };
            };

            // Calcula d√©ficit simulado baseado nos logs di√°rios
            const getSimulatedDeficit = () => {
                if (evaluations.length === 0) return { remaining: 0, accumulated: 0, initial: 0 };
                
                // D√©ficit inicial (da primeira avalia√ß√£o)
                const first = evaluations[0];
                const firstBF = calculateBodyFat(first);
                const firstFatMass = (firstBF / 100) * first.weight;
                const targetFatMass = (targetBodyFat / 100) * first.weight;
                const initialFatToLose = firstFatMass - targetFatMass;
                const initialDeficit = initialFatToLose * 7700;
                
                // Acumula d√©ficit de todos os logs di√°rios
                const totalAccumulated = dailyLogs.reduce((sum, log) => {
                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                    const dailyDeficit = (basalCalories + exerciseTotal) - log.calories;
                    return sum + dailyDeficit;
                }, 0);
                
                // D√©ficit restante simulado
                const remainingSimulated = Math.max(0, initialDeficit - totalAccumulated);
                
                return {
                    remaining: remainingSimulated,
                    accumulated: totalAccumulated,
                    initial: initialDeficit
                };
            };

            // Check recent performance and generate alerts
            const getPerformanceAlert = () => {
                // Admin mode override
                if (adminMode && debugSettings.forceAlert) {
                    const alerts = {
                        critical: {
                            type: 'critical',
                            title: 'üö® ALERTA VERMELHO - VOC√ä REALMENTE QUER CONTINUAR ASSIM?',
                            message: 'Sabia que cada dia ruim pode adicionar at√© 0,2% de gordura corporal? E pior: um dia de vacilo anula TODO o esfor√ßo de um dia bom. Isso significa que voc√™ pode estar 2-3 dias atrasado agora. Cada besteira que voc√™ come est√° literalmente destruindo semanas de progresso. PARE. REAJA. AGORA.',
                            color: 'bg-red-600',
                            border: 'border-red-500'
                        },
                        warning: {
                            type: 'warning',
                            title: '‚ö†Ô∏è ATEN√á√ÉO - VOC√ä EST√Å JOGANDO SEU PROGRESSO FORA',
                            message: 'Dois dias ruins = pelo menos 2 dias bons anulados. Voc√™ pode ter ganhado 0,3-0,4% de gordura de volta. Pense: vale a pena aquela comida de 5 minutos destruir dias de disciplina? Cada escolha ruim √© uma escolha CONTRA seus objetivos. Volte ao foco HOJE!',
                            color: 'bg-orange-600',
                            border: 'border-orange-500'
                        },
                        caution: {
                            type: 'caution',
                            title: '‚ö° SE LIGA - Mantenha a consist√™ncia',
                            message: 'Seus √∫ltimos dias n√£o est√£o no deficit ideal. N√£o deixe a disciplina escorregar!',
                            color: 'bg-yellow-600',
                            border: 'border-yellow-500'
                        },
                        excellent: {
                            type: 'excellent',
                            title: 'üî• EXCELENTE! VOC√ä √â IMPAR√ÅVEL!',
                            message: 'Tr√™s dias perfeitos seguidos! Essa √© a disciplina que transforma corpo e mente. Continue assim!',
                            color: 'bg-green-600',
                            border: 'border-green-500'
                        },
                        good: {
                            type: 'good',
                            title: '‚úÖ BOM TRABALHO - Voc√™ est√° no caminho certo!',
                            message: 'Mantendo o deficit! Continue focado e os resultados vir√£o.',
                            color: 'bg-blue-600',
                            border: 'border-blue-500'
                        }
                    };
                    return alerts[debugSettings.forceAlert] || null;
                }
                
                const sortedLogs = [...dailyLogs].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                if (sortedLogs.length < 2) return null;
                
                // Helper function to classify a day
                const classifyDay = (log) => {
                    if (log.isRefeed) return 'refeed'; // Estrat√©gico, n√£o conta para alertas
                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                    const deficit = (basalCalories + exerciseTotal) - log.calories;
                    
                    if (log.isFasting || deficit >= 500) return 'excellent'; // Jejum ou deficit grande
                    if (deficit >= 300) return 'good'; // Deficit bom
                    if (deficit >= 0) return 'ok'; // Deficit pequeno mas positivo
                    if (deficit >= -200) return 'maintenance'; // Pr√≥ximo da manuten√ß√£o
                    return 'bad'; // Super√°vit real
                };
                
                // Conta sequ√™ncia CONSECUTIVA atual (ignora refeeds)
                let consecutiveGood = 0;
                let consecutiveBad = 0;
                let recentDays = [];
                
                for (let i = 0; i < Math.min(sortedLogs.length, 7); i++) {
                    const classification = classifyDay(sortedLogs[i]);
                    if (classification !== 'refeed') {
                        recentDays.push(classification);
                    }
                }
                
                // Conta sequ√™ncia consecutiva do in√≠cio
                for (const day of recentDays) {
                    if (day === 'excellent' || day === 'good') {
                        consecutiveGood++;
                        break; // Para na primeira quebra
                    } else if (day === 'bad') {
                        consecutiveBad++;
                    } else if (day === 'maintenance') {
                        // Manuten√ß√£o quebra sequ√™ncia boa mas n√£o conta como ruim
                        break;
                    } else {
                        break;
                    }
                }
                
                // Se come√ßou com dias bons, conta quantos s√£o consecutivos
                if (consecutiveGood > 0) {
                    consecutiveGood = 0;
                    for (const day of recentDays) {
                        if (day === 'excellent' || day === 'good') {
                            consecutiveGood++;
                        } else if (day === 'refeed') {
                            continue; // Ignora refeed na contagem
                        } else {
                            break;
                        }
                    }
                }
                
                // Se come√ßou com dias ruins, conta quantos s√£o consecutivos
                if (consecutiveBad > 0) {
                    consecutiveBad = 0;
                    for (const day of recentDays) {
                        if (day === 'bad' || day === 'maintenance') {
                            consecutiveBad++;
                        } else {
                            break;
                        }
                    }
                }
                
                // PRIORIDADE 1: Celebrar sequ√™ncias boas CONSECUTIVAS
                if (consecutiveGood >= 5) {
                    return {
                        type: 'excellent',
                        title: `üèÜ ${consecutiveGood} DIAS PERFEITOS SEGUIDOS! IMPAR√ÅVEL!`,
                        message: 'Voc√™ est√° em uma sequ√™ncia INCR√çVEL! Essa disciplina √© o que separa campe√µes de sonhadores. CONTINUE!',
                        color: 'bg-green-600',
                        border: 'border-green-500',
                        canDismiss: true
                    };
                }
                
                if (consecutiveGood >= 3) {
                    return {
                        type: 'excellent',
                        title: 'üî• 3+ DIAS CONSECUTIVOS DE FOCO TOTAL!',
                        message: 'Voc√™ est√° DESTRUINDO! Continue assim e os resultados v√£o ser INSANOS! üí™',
                        color: 'bg-green-600',
                        border: 'border-green-500',
                        canDismiss: true
                    };
                }
                
                if (consecutiveGood >= 2) {
                    return {
                        type: 'good',
                        title: '‚úÖ RECUPEROU O FOCO! 2 DIAS SEGUIDOS!',
                        message: 'Muito bem! Mais um dia assim e voc√™ estar√° em uma sequ√™ncia incr√≠vel! ÔøΩ',
                        color: 'bg-emerald-600',
                        border: 'border-emerald-500',
                        canDismiss: true
                    };
                }
                
                // PRIORIDADE 2: Alertas negativos CONSECUTIVOS (N√ÉO podem fechar)
                if (consecutiveBad >= 3) {
                    return {
                        type: 'critical',
                        title: `üö® ${consecutiveBad} DIAS RUINS SEGUIDOS - REAJA AGORA!`,
                        message: 'Sabia que cada dia ruim pode adicionar at√© 0,2% de gordura corporal? E pior: um dia de vacilo anula TODO o esfor√ßo de um dia bom. Isso significa que voc√™ pode estar 2-3 dias atrasado agora. Cada besteira que voc√™ come est√° literalmente destruindo semanas de progresso. PARE. REAJA. AGORA.',
                        color: 'bg-red-600',
                        border: 'border-red-500',
                        canDismiss: false
                    };
                }
                
                if (consecutiveBad >= 2) {
                    return {
                        type: 'warning',
                        title: '‚ö†Ô∏è 2 DIAS RUINS SEGUIDOS - CUIDADO!',
                        message: 'Dois dias ruins = pelo menos 2 dias bons anulados. Voc√™ pode ter ganhado 0,3-0,4% de gordura de volta. Pense: vale a pena aquela comida de 5 minutos destruir dias de disciplina? Cada escolha ruim √© uma escolha CONTRA seus objetivos. Volte ao foco HOJE!',
                        color: 'bg-orange-600',
                        border: 'border-orange-500',
                        canDismiss: false
                    };
                }
                
                // PRIORIDADE 3: Encorajamento para 1 dia bom
                if (consecutiveGood === 1 && recentDays.length > 0) {
                    return {
                        type: 'good',
                        title: 'üí™ BOM COME√áO! CONTINUE!',
                        message: 'Um dia bom! Mais um dia assim e voc√™ estar√° de volta aos trilhos! N√£o pare agora!',
                        color: 'bg-blue-600',
                        border: 'border-blue-500',
                        canDismiss: true
                    };
                }
                
                return null;
            };

            // Add evaluation
            // Edit evaluation
            const handleEditEvaluation = (evaluation) => {
                setEditingEval(evaluation.id);
                setNewEval({
                    date: evaluation.date,
                    weight: evaluation.weight,
                    triceps: evaluation.triceps,
                    subscapular: evaluation.subscapular,
                    chest: evaluation.chest,
                    midaxillary: evaluation.midaxillary,
                    abdominal: evaluation.abdominal,
                    suprailiac: evaluation.suprailiac,
                    thigh: evaluation.thigh
                });
                setShowAddEval(true);
            };

            const handleSaveEvaluation = () => {
                if (!newEval.weight || !newEval.triceps) return;
                
                if (editingEval) {
                    // Editando avalia√ß√£o existente
                    setEvaluations(evaluations.map(e => 
                        e.id === editingEval ? {
                            ...e,
                            date: newEval.date,
                            weight: Number(newEval.weight),
                            triceps: Number(newEval.triceps),
                            subscapular: Number(newEval.subscapular),
                            chest: Number(newEval.chest),
                            midaxillary: Number(newEval.midaxillary),
                            abdominal: Number(newEval.abdominal),
                            suprailiac: Number(newEval.suprailiac),
                            thigh: Number(newEval.thigh)
                        } : e
                    ));
                    setEditingEval(null);
                } else {
                    // Adicionando nova avalia√ß√£o
                    const evaluation = {
                        id: Date.now(),
                        date: newEval.date,
                        weight: Number(newEval.weight),
                        triceps: Number(newEval.triceps),
                        subscapular: Number(newEval.subscapular),
                        chest: Number(newEval.chest),
                        midaxillary: Number(newEval.midaxillary),
                        abdominal: Number(newEval.abdominal),
                        suprailiac: Number(newEval.suprailiac),
                        thigh: Number(newEval.thigh)
                    };
                    setEvaluations([...evaluations, evaluation]);
                }
                
                setShowAddEval(false);
                setNewEval({
                    date: new Date().toISOString().split('T')[0],
                    weight: '', triceps: '', subscapular: '', chest: '',
                    midaxillary: '', abdominal: '', suprailiac: '', thigh: ''
                });
            };

            // Edit daily log
            const handleEditLog = (log) => {
                setEditingLog(log.id);
                setNewLog({
                    date: log.date,
                    calories: log.calories,
                    isFasting: log.isFasting,
                    isRefeed: log.isRefeed,
                    exerciseCalories: {
                        strength: log.exerciseCalories?.strength || '',
                        cardio: log.exerciseCalories?.cardio || ''
                    },
                    hungerLevel: log.hungerLevel || 5,
                    energyLevel: log.energyLevel || 5,
                    notes: log.notes || '',
                    // Spiritual mode fields
                    meditations: log.meditations || [],
                    gratitude: log.gratitude || false,
                    judgedOthers: log.judgedOthers || false,
                    charity: log.charity || false,
                    feltAnger: log.feltAnger || false,
                    gossiped: log.gossiped || false,
                    spiritualNotes: log.spiritualNotes || '',
                    // NoFap mode fields
                    cleanDay: log.cleanDay !== undefined ? log.cleanDay : true,
                    urgeLevel: log.urgeLevel || 0,
                    nofapNotes: log.nofapNotes || ''
                });
                setShowAddLog(true);
            };

            const handleSaveLog = () => {
                if (!newLog.calories && !newLog.isFasting) return;
                
                const logData = {
                    date: newLog.date,
                    calories: newLog.isFasting ? 0 : Number(newLog.calories),
                    isFasting: newLog.isFasting || false,
                    isRefeed: newLog.isRefeed || false,
                    exerciseCalories: {
                        strength: Number(newLog.exerciseCalories?.strength || 0),
                        cardio: Number(newLog.exerciseCalories?.cardio || 0)
                    },
                    hungerLevel: Number(newLog.hungerLevel || 5),
                    energyLevel: Number(newLog.energyLevel || 5),
                    notes: newLog.notes || '',
                    // Spiritual mode fields
                    ...(spiritualModeEnabled && {
                        meditations: newLog.meditations || [],
                        gratitude: newLog.gratitude || false,
                        judgedOthers: newLog.judgedOthers || false,
                        charity: newLog.charity || false,
                        feltAnger: newLog.feltAnger || false,
                        gossiped: newLog.gossiped || false,
                        spiritualNotes: newLog.spiritualNotes || ''
                    }),
                    // NoFap mode fields
                    ...(nofapModeEnabled && {
                        cleanDay: newLog.cleanDay !== undefined ? newLog.cleanDay : true,
                        urgeLevel: Number(newLog.urgeLevel || 0),
                        nofapNotes: newLog.nofapNotes || ''
                    })
                };
                
                if (editingLog) {
                    // Editando log existente
                    setDailyLogs(dailyLogs.map(log => 
                        log.id === editingLog ? { ...log, ...logData } : log
                    ));
                    setEditingLog(null);
                } else {
                    // Adicionando novo log
                    setDailyLogs([...dailyLogs, { id: Date.now(), ...logData }]);
                }
                
                setShowAddLog(false);
                setNewLog({
                    date: new Date().toISOString().split('T')[0],
                    calories: '',
                    isFasting: false,
                    isRefeed: false,
                    exerciseCalories: { strength: '', cardio: '' },
                    hungerLevel: 5,
                    energyLevel: 5,
                    notes: '',
                    meditations: [],
                    gratitude: false,
                    judgedOthers: false,
                    charity: false,
                    feltAnger: false,
                    gossiped: false,
                    spiritualNotes: '',
                    cleanDay: true,
                    urgeLevel: 0,
                    nofapNotes: ''
                });
            };

            // Delete log
            const deleteLog = (id) => {
                if (confirm('Deletar este registro?')) {
                    setDailyLogs(dailyLogs.filter(log => log.id !== id));
                }
            };

            // Delete evaluation
            const deleteEvaluation = (id) => {
                if (confirm('Deletar esta avalia√ß√£o?')) {
                    setEvaluations(evaluations.filter(evaluation => evaluation.id !== id));
                }
            };

            // Get status for daily log
            const getLogStatus = (calories) => {
                const deficit = basalCalories - calories;
                const maintenanceRange = 100;
                
                if (deficit < -maintenanceRange) {
                    return { status: 'surplus', label: 'VACIL√ÉO', color: 'border-red-500 bg-red-500/10 text-red-400', icon: AlertTriangle };
                } else if (Math.abs(deficit) <= maintenanceRange) {
                    return { status: 'maintenance', label: 'N√ÉO PERDEU NEM GANHOU', color: 'border-yellow-500 bg-yellow-500/10 text-yellow-400', icon: AlertTriangle };
                } else {
                    return { status: 'deficit', label: 'PARAB√âNS, VOC√ä √â UM VENCEDOR', color: 'border-green-500 bg-green-500/10 text-green-400', icon: CheckCircle2 };
                }
            };

            const stats = calculateDeficitNeeded();
            const caloriesStats = getTotalCaloriesStats();
            const simulatedDeficit = getSimulatedDeficit();

            // Welcome Screen for new users
            if (!isSetupComplete && !showImportOnWelcome) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4 flex items-center justify-center">
                        <div className="max-w-2xl w-full">
                            <div className="text-center mb-8">
                                <h1 className="text-6xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                                    Body Tracker Pro
                                </h1>
                                <p className="text-2xl text-slate-300 mb-2">Bem-vindo! üí™</p>
                                <p className="text-slate-400">Vamos come√ßar sua jornada rumo aos seus objetivos de gordura corporal</p>
                            </div>

                            <div className="bg-slate-800/80 backdrop-blur rounded-2xl p-8 border border-slate-700 shadow-2xl">
                                <div className="flex items-center justify-center mb-6">
                                    <Target className="h-16 w-16 text-blue-400" />
                                </div>
                                
                                <h2 className="text-2xl font-bold text-center mb-6">Escolha uma op√ß√£o</h2>
                                
                                <div className="space-y-4">
                                    <button
                                        onClick={() => setShowImportOnWelcome(true)}
                                        className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition-all transform hover:scale-105"
                                    >
                                        <Upload className="h-6 w-6" />
                                        J√° tenho dados - Importar Backup
                                    </button>
                                    
                                    <button
                                        onClick={() => setIsSetupComplete('setup')}
                                        className="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition-all transform hover:scale-105"
                                    >
                                        <Plus className="h-6 w-6" />
                                        Come√ßar do Zero - Setup Inicial
                                    </button>
                                </div>

                                <div className="mt-8 pt-6 border-t border-slate-700 text-center text-sm text-slate-400">
                                    <p>üîí Seus dados s√£o salvos localmente no seu navegador</p>
                                    <p className="mt-1">Voc√™ pode exportar e fazer backup a qualquer momento</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Import Screen
            if (!isSetupComplete && showImportOnWelcome) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4 flex items-center justify-center">
                        <div className="max-w-2xl w-full">
                            <div className="text-center mb-8">
                                <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                                    Importar Dados
                                </h1>
                                <p className="text-slate-400">Importe seu arquivo de backup JSON</p>
                            </div>

                            <div className="bg-slate-800/80 backdrop-blur rounded-2xl p-8 border border-slate-700 shadow-2xl">
                                <div className="flex items-center justify-center mb-6">
                                    <Upload className="h-16 w-16 text-green-400" />
                                </div>
                                
                                <label className="block w-full bg-green-600 hover:bg-green-700 px-8 py-6 rounded-xl font-bold text-lg text-center cursor-pointer transition-all transform hover:scale-105">
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        className="hidden"
                                    />
                                    üìÇ Selecionar Arquivo JSON
                                </label>

                                <div className="mt-6 p-4 bg-slate-700/50 rounded-lg text-sm text-slate-300">
                                    <p className="font-semibold mb-2">‚ÑπÔ∏è Como importar:</p>
                                    <ol className="list-decimal list-inside space-y-1">
                                        <li>Clique no bot√£o acima</li>
                                        <li>Selecione seu arquivo de backup (.json)</li>
                                        <li>Os dados ser√£o carregados automaticamente</li>
                                    </ol>
                                </div>

                                <button
                                    onClick={() => setShowImportOnWelcome(false)}
                                    className="w-full mt-6 bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-lg font-semibold transition-all"
                                >
                                    ‚Üê Voltar
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Setup Form for new users
            if (isSetupComplete === 'setup') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4">
                        <div className="max-w-4xl mx-auto py-8">
                            <div className="text-center mb-8">
                                <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                                    Setup Inicial
                                </h1>
                                <p className="text-slate-400">Vamos configurar seus dados para come√ßar o tracking</p>
                            </div>

                            <div className="bg-slate-800/80 backdrop-blur rounded-2xl p-8 border border-slate-700 shadow-2xl">
                                <div className="space-y-8">
                                    {/* Basic Info */}
                                    <div>
                                        <h2 className="text-2xl font-bold mb-4 flex items-center">
                                            <Scale className="mr-3 h-8 w-8 text-blue-400" />
                                            Informa√ß√µes B√°sicas
                                        </h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Data da Avalia√ß√£o *</label>
                                                <input
                                                    type="date"
                                                    value={setupData.date}
                                                    onChange={(e) => setSetupData({...setupData, date: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Peso Atual (kg) *</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.weight}
                                                    onChange={(e) => setSetupData({...setupData, weight: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg"
                                                    placeholder="Ex: 80.5"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Calorias Basais/Manuten√ß√£o (kcal/dia) *</label>
                                                <input
                                                    type="number"
                                                    value={setupData.basalCalories}
                                                    onChange={(e) => setSetupData({...setupData, basalCalories: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg"
                                                    placeholder="Ex: 2300"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">% de Gordura Desejado *</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.targetBodyFat}
                                                    onChange={(e) => setSetupData({...setupData, targetBodyFat: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg"
                                                    placeholder="Ex: 10"
                                                />
                                            </div>
                                        </div>
                                        <p className="text-xs text-slate-500 mt-2">
                                            üí° Suas calorias de manuten√ß√£o s√£o as calorias que voc√™ precisa consumir para manter seu peso atual. O % de gordura desejado √© sua meta final.
                                        </p>
                                    </div>

                                    {/* Skinfolds */}
                                    <div>
                                        <h2 className="text-2xl font-bold mb-4 flex items-center">
                                            <Ruler className="mr-3 h-8 w-8 text-purple-400" />
                                            Medidas de Dobras Cut√¢neas (7 pontos)
                                        </h2>
                                        <p className="text-sm text-slate-400 mb-4">
                                            Preencha as medidas em mil√≠metros (mm). Pelo menos a Triceps √© obrigat√≥ria.
                                        </p>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Triceps (mm) *</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.triceps}
                                                    onChange={(e) => setSetupData({...setupData, triceps: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 14.5"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Subscapular (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.subscapular}
                                                    onChange={(e) => setSetupData({...setupData, subscapular: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 15.2"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Chest (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.chest}
                                                    onChange={(e) => setSetupData({...setupData, chest: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 7.8"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Midaxillary (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.midaxillary}
                                                    onChange={(e) => setSetupData({...setupData, midaxillary: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 11.3"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Abdominal (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.abdominal}
                                                    onChange={(e) => setSetupData({...setupData, abdominal: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 22.7"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Suprailiac (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.suprailiac}
                                                    onChange={(e) => setSetupData({...setupData, suprailiac: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 21.4"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Thigh (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={setupData.thigh}
                                                    onChange={(e) => setSetupData({...setupData, thigh: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="Ex: 26.9"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* Action Buttons */}
                                    <div className="flex gap-4 pt-6">
                                        <button
                                            onClick={completeSetup}
                                            className="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition-all transform hover:scale-105"
                                        >
                                            <CheckCircle2 className="h-6 w-6" />
                                            Completar Setup e Come√ßar!
                                        </button>
                                        <button
                                            onClick={() => setIsSetupComplete(false)}
                                            className="bg-slate-700 hover:bg-slate-600 px-6 py-4 rounded-xl font-semibold transition-all"
                                        >
                                            Cancelar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Admin Panel */}
                        {adminMode && (
                            <div className="mb-6 bg-gradient-to-r from-purple-900 to-pink-900 border-2 border-purple-500 rounded-xl p-6 shadow-2xl">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-2xl font-bold flex items-center gap-2">
                                        üîß MODO ADMIN / DEBUG
                                    </h2>
                                    <button
                                        onClick={() => {
                                            setAdminMode(false);
                                            localStorage.setItem('adminMode', 'false');
                                        }}
                                        className="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold transition-all"
                                    >
                                        Desativar
                                    </button>
                                </div>
                                <p className="text-sm text-purple-200 mb-4">
                                    üí° Dica: Clique 5 vezes no t√≠tulo "Body Tracker Pro" para ativar/desativar este painel
                                </p>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Alert Testing */}
                                    <div className="bg-slate-800/50 rounded-lg p-4">
                                        <h3 className="font-bold mb-3 text-purple-300">üö® For√ßar Alerta de Performance</h3>
                                        <div className="space-y-2">
                                            {[
                                                { value: null, label: '‚ùå Nenhum (Normal)', color: 'bg-slate-600' },
                                                { value: 'critical', label: 'üö® CR√çTICO - Alerta Vermelho', color: 'bg-red-600' },
                                                { value: 'warning', label: '‚ö†Ô∏è WARNING - Aten√ß√£o', color: 'bg-orange-600' },
                                                { value: 'caution', label: '‚ö° CAUTION - Se Liga', color: 'bg-yellow-600' },
                                                { value: 'good', label: '‚úÖ BOM - Bom Trabalho', color: 'bg-blue-600' },
                                                { value: 'excellent', label: 'üî• EXCELENTE - Impar√°vel', color: 'bg-green-600' }
                                            ].map((alert) => (
                                                <label key={alert.value || 'none'} className="flex items-center gap-3 cursor-pointer hover:bg-slate-700/30 p-2 rounded">
                                                    <input
                                                        type="radio"
                                                        name="forceAlert"
                                                        checked={debugSettings.forceAlert === alert.value}
                                                        onChange={() => setDebugSettings({...debugSettings, forceAlert: alert.value})}
                                                        className="w-4 h-4"
                                                    />
                                                    <span className={`px-3 py-1 rounded text-sm font-semibold ${alert.color}`}>
                                                        {alert.label}
                                                    </span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Quick Actions */}
                                    <div className="bg-slate-800/50 rounded-lg p-4">
                                        <h3 className="font-bold mb-3 text-purple-300">‚ö° A√ß√µes R√°pidas de Teste</h3>
                                        <p className="text-xs text-yellow-300 mb-3 bg-yellow-900/20 p-2 rounded border border-yellow-700/30">
                                            ‚ö†Ô∏è Dados de teste s√£o TEMPOR√ÅRIOS e aparecem apenas na sess√£o atual. Recarregue a p√°gina para limpar.
                                        </p>
                                        <div className="space-y-3">
                                            <button
                                                onClick={() => {
                                                    const numDays = 15;
                                                    const testLogs = [];
                                                    
                                                    // Remove logs dos √∫ltimos N dias para substituir
                                                    const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                    const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                    
                                                    // Gera novos dados aleat√≥rios para √∫ltimos N dias
                                                    for (let i = numDays - 1; i >= 0; i--) {
                                                        const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                        const dayOfWeek = currentDate.getDay();
                                                        const isSunday = dayOfWeek === 0;
                                                        
                                                        // Medita√ß√µes (se espiritual ativo)
                                                        const meditations = spiritualModeEnabled && Math.random() > 0.2 ? [
                                                            { type: 'limpeza-propria', minutes: 10 + Math.floor(Math.random() * 15) },
                                                            { type: 'protecao', minutes: 8 + Math.floor(Math.random() * 12) },
                                                            { type: 'conexao', minutes: 15 + Math.floor(Math.random() * 20) },
                                                            ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 20 + Math.floor(Math.random() * 15) }] : [])
                                                        ] : [];
                                                        
                                                        // NoFap (se ativo)
                                                        const isCleanDay = !nofapModeEnabled || Math.random() > 0.15;
                                                        const urgeLevel = nofapModeEnabled ? (isCleanDay ? Math.floor(Math.random() * 6) + 2 : 0) : undefined;
                                                        
                                                        testLogs.push({
                                                            id: Date.now() - (i * 10000),
                                                            date: currentDate.toISOString().split('T')[0],
                                                            calories: basalCalories + Math.floor(Math.random() * 400) + 200, // 200-600 kcal super√°vit
                                                            isFasting: false,
                                                            exerciseCalories: {
                                                                strength: Math.floor(Math.random() * 100),
                                                                cardio: Math.floor(Math.random() * 100)
                                                            },
                                                            ...(spiritualModeEnabled && {
                                                                meditations,
                                                                gratitude: Math.random() > 0.3,
                                                                judgedOthers: Math.random() > 0.6,
                                                                charity: Math.random() > 0.85,
                                                                feltAnger: Math.random() > 0.75,
                                                                gossiped: Math.random() > 0.85,
                                                                spiritualNotes: meditations.length > 0 ? 'Protocolo realizado' : 'Dia dif√≠cil'
                                                            }),
                                                            ...(nofapModeEnabled && {
                                                                cleanDay: isCleanDay,
                                                                urgeLevel,
                                                                nofapNotes: isCleanDay ? `Urges n√≠vel ${urgeLevel}, resisti` : 'Reca√≠da'
                                                            })
                                                        });
                                                    }
                                                    
                                                    setDailyLogs([...filteredLogs, ...testLogs]);
                                                }}
                                                className="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                            >
                                                üî¥ 15 dias ruins (super√°vit + dados aleat√≥rios)
                                            </button>
                                            <button
                                                onClick={() => {
                                                    const numDays = 15;
                                                    const testLogs = [];
                                                    
                                                    // Remove logs dos √∫ltimos N dias para substituir
                                                    const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                    const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                    
                                                    // Gera novos dados aleat√≥rios para √∫ltimos N dias
                                                    for (let i = numDays - 1; i >= 0; i--) {
                                                        const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                        const dayOfWeek = currentDate.getDay();
                                                        const isSunday = dayOfWeek === 0;
                                                        
                                                        // Medita√ß√µes (se espiritual ativo)
                                                        const meditations = spiritualModeEnabled ? [
                                                            { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 20) },
                                                            { type: 'protecao', minutes: 12 + Math.floor(Math.random() * 15) },
                                                            { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 25) },
                                                            ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 25 + Math.floor(Math.random() * 20) }] : [])
                                                        ] : [];
                                                        
                                                        // NoFap (se ativo) - dias bons = pouqu√≠ssimas reca√≠das
                                                        const isCleanDay = !nofapModeEnabled || Math.random() > 0.05;
                                                        const urgeLevel = nofapModeEnabled ? (isCleanDay ? Math.floor(Math.random() * 5) : 0) : undefined;
                                                        
                                                        testLogs.push({
                                                            id: Date.now() - (i * 10000),
                                                            date: currentDate.toISOString().split('T')[0],
                                                            calories: basalCalories - Math.floor(Math.random() * 400) - 250, // 250-650 kcal deficit
                                                            isFasting: false,
                                                            exerciseCalories: {
                                                                strength: Math.floor(Math.random() * 200) + 100,
                                                                cardio: Math.floor(Math.random() * 300) + 150
                                                            },
                                                            ...(spiritualModeEnabled && {
                                                                meditations,
                                                                gratitude: true,
                                                                judgedOthers: Math.random() > 0.85,
                                                                charity: Math.random() > 0.7,
                                                                feltAnger: Math.random() > 0.9,
                                                                gossiped: false,
                                                                spiritualNotes: `Protocolo completo - ${meditations.reduce((sum, m) => sum + m.minutes, 0)} minutos`
                                                            }),
                                                            ...(nofapModeEnabled && {
                                                                cleanDay: isCleanDay,
                                                                urgeLevel,
                                                                nofapNotes: isCleanDay ? `Dia controlado, urges baixos (${urgeLevel})` : 'Reca√≠da isolada'
                                                            })
                                                        });
                                                    }
                                                    
                                                    setDailyLogs([...filteredLogs, ...testLogs]);
                                                }}
                                                className="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                            >
                                                üü¢ 15 dias bons (deficit + dados aleat√≥rios)
                                            </button>
                                            <button
                                                onClick={() => {
                                                    const numDays = 7;
                                                    const testLogs = [];
                                                    
                                                    // Remove logs dos √∫ltimos N dias para substituir
                                                    const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                    const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                    
                                                    // Gera dias de jejum aleat√≥rios (30-40% dos dias)
                                                    for (let i = numDays - 1; i >= 0; i--) {
                                                        const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                        const dayOfWeek = currentDate.getDay();
                                                        const isSunday = dayOfWeek === 0;
                                                        const isFastingDay = Math.random() > 0.65; // ~35% jejum
                                                        
                                                        // Medita√ß√µes (sempre presentes se espiritual ativo)
                                                        const meditations = spiritualModeEnabled ? [
                                                            { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 20) },
                                                            { type: 'protecao', minutes: 10 + Math.floor(Math.random() * 15) },
                                                            { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 25) },
                                                            ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 25 + Math.floor(Math.random() * 15) }] : [])
                                                        ] : [];
                                                        
                                                        // NoFap
                                                        const isCleanDay = !nofapModeEnabled || Math.random() > 0.1;
                                                        const urgeLevel = nofapModeEnabled ? (isCleanDay ? Math.floor(Math.random() * 6) : 0) : undefined;
                                                        
                                                        testLogs.push({
                                                            id: Date.now() - (i * 10000),
                                                            date: currentDate.toISOString().split('T')[0],
                                                            calories: isFastingDay ? 0 : basalCalories - Math.floor(Math.random() * 300) - 200,
                                                            isFasting: isFastingDay,
                                                            exerciseCalories: isFastingDay ? 
                                                                { strength: 0, cardio: 0 } :
                                                                { strength: Math.floor(Math.random() * 150), cardio: Math.floor(Math.random() * 200) },
                                                            ...(spiritualModeEnabled && {
                                                                meditations,
                                                                gratitude: true,
                                                                judgedOthers: Math.random() > 0.8,
                                                                charity: Math.random() > 0.8,
                                                                feltAnger: Math.random() > 0.85,
                                                                gossiped: false,
                                                                spiritualNotes: isFastingDay ? 'Jejum + protocolo - conex√£o profunda' : 'Protocolo regular'
                                                            }),
                                                            ...(nofapModeEnabled && {
                                                                cleanDay: isCleanDay,
                                                                urgeLevel,
                                                                nofapNotes: isCleanDay ? `Dia ${urgeLevel <= 3 ? 'tranquilo' : 'desafiador'}` : 'Reca√≠da'
                                                            })
                                                        });
                                                    }
                                                    
                                                    setDailyLogs([...filteredLogs, ...testLogs]);
                                                }}
                                                className="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                            >
                                                üü£ 7 dias com jejuns (35% jejum)
                                            </button>
                                            
                                            <button
                                                onClick={() => {
                                                    // Gera 3 avalia√ß√µes com progress√£o (perda de gordura)
                                                    const newEvals = [];
                                                    for (let i = 2; i >= 0; i--) {
                                                        const baseWeight = 80 - (2 - i) * 2;
                                                        const baseFat = 15 - (2 - i) * 2;
                                                        
                                                        newEvals.push({
                                                            id: Date.now() - (i * 10000),
                                                            date: new Date(Date.now() - i * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                                                            weight: parseFloat((baseWeight + Math.random() * 2).toFixed(1)),
                                                            chest: parseFloat((baseFat + Math.random() * 3).toFixed(1)),
                                                            abdominal: parseFloat((baseFat * 1.5 + Math.random() * 4).toFixed(1)),
                                                            thigh: parseFloat((baseFat * 1.2 + Math.random() * 3).toFixed(1)),
                                                            triceps: parseFloat((baseFat * 0.9 + Math.random() * 2).toFixed(1)),
                                                            subscapular: parseFloat((baseFat * 1.1 + Math.random() * 3).toFixed(1)),
                                                            suprailiac: parseFloat((baseFat * 1.3 + Math.random() * 4).toFixed(1)),
                                                            midaxillary: parseFloat((baseFat * 1.15 + Math.random() * 3).toFixed(1))
                                                        });
                                                    }
                                                    setEvaluations([...evaluations, ...newEvals]);
                                                }}
                                                className="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                            >
                                                üìä 3 avalia√ß√µes com progress√£o (30 dias cada)
                                            </button>
                                            
                                            {/* Geradores de 1 dia */}
                                            <div className="col-span-full border-t-2 border-blue-600/50 pt-3 mt-2">
                                                <div className="flex items-center gap-2 mb-2">
                                                    <span className="text-xl">üçΩÔ∏è</span>
                                                    <h4 className="text-sm font-bold text-blue-400">FITNESS</h4>
                                                </div>
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                                    <button
                                                        onClick={() => {
                                                            const today = new Date().toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                            const dayOfWeek = new Date().getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            
                                                            filteredLogs.push({
                                                                id: Date.now(),
                                                                date: today,
                                                                calories: basalCalories + Math.floor(Math.random() * 400) + 200,
                                                                isFasting: false,
                                                                exerciseCalories: { strength: Math.floor(Math.random() * 100), cardio: Math.floor(Math.random() * 100) },
                                                                ...(spiritualModeEnabled && {
                                                                    meditations: Math.random() > 0.5 ? [
                                                                        { type: 'limpeza-propria', minutes: 10 + Math.floor(Math.random() * 10) }
                                                                    ] : [],
                                                                    gratitude: Math.random() > 0.5,
                                                                    judgedOthers: Math.random() > 0.5,
                                                                    charity: false,
                                                                    feltAnger: Math.random() > 0.6,
                                                                    gossiped: Math.random() > 0.7,
                                                                    spiritualNotes: 'Dia dif√≠cil'
                                                                }),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: Math.random() > 0.3,
                                                                    urgeLevel: Math.floor(Math.random() * 6) + 2,
                                                                    nofapNotes: 'Dia desafiador'
                                                                })
                                                            });
                                                            setDailyLogs(filteredLogs);
                                                        }}
                                                        className="bg-red-700 hover:bg-red-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                    >
                                                        üî¥ Hoje ruim
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            const randomDays = Math.floor(Math.random() * 30) + 1;
                                                            const randomDate = new Date(Date.now() - randomDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date !== randomDate);
                                                            const dayOfWeek = new Date(randomDate).getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            
                                                            filteredLogs.push({
                                                                id: Date.now(),
                                                                date: randomDate,
                                                                calories: basalCalories + Math.floor(Math.random() * 400) + 200,
                                                                isFasting: false,
                                                                exerciseCalories: { strength: Math.floor(Math.random() * 100), cardio: Math.floor(Math.random() * 100) },
                                                                ...(spiritualModeEnabled && {
                                                                    meditations: Math.random() > 0.5 ? [
                                                                        { type: 'limpeza-propria', minutes: 10 + Math.floor(Math.random() * 10) }
                                                                    ] : [],
                                                                    gratitude: Math.random() > 0.5,
                                                                    judgedOthers: Math.random() > 0.5,
                                                                    charity: false,
                                                                    feltAnger: Math.random() > 0.6,
                                                                    gossiped: Math.random() > 0.7,
                                                                    spiritualNotes: 'Dia dif√≠cil'
                                                                }),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: Math.random() > 0.3,
                                                                    urgeLevel: Math.floor(Math.random() * 6) + 2,
                                                                    nofapNotes: 'Dia desafiador'
                                                                })
                                                            });
                                                            setDailyLogs(filteredLogs);
                                                        }}
                                                        className="bg-red-600 hover:bg-red-700 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                    >
                                                        üî¥ +1 aleat√≥rio ruim
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            const today = new Date().toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                            const dayOfWeek = new Date().getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            
                                                            filteredLogs.push({
                                                                id: Date.now(),
                                                                date: today,
                                                                calories: basalCalories - Math.floor(Math.random() * 400) - 250,
                                                                isFasting: false,
                                                                exerciseCalories: { strength: Math.floor(Math.random() * 200) + 100, cardio: Math.floor(Math.random() * 300) + 150 },
                                                                ...(spiritualModeEnabled && {
                                                                    meditations: [
                                                                        { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 15) },
                                                                        { type: 'protecao', minutes: 10 + Math.floor(Math.random() * 10) },
                                                                        { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 15) },
                                                                        ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 25 }] : [])
                                                                    ],
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.7,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: 'Protocolo completo'
                                                                }),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 4),
                                                                    nofapNotes: 'Dia controlado'
                                                                })
                                                            });
                                                            setDailyLogs(filteredLogs);
                                                        }}
                                                        className="bg-green-700 hover:bg-green-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                    >
                                                        üü¢ Hoje bom
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            const randomDays = Math.floor(Math.random() * 30) + 1;
                                                            const randomDate = new Date(Date.now() - randomDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date !== randomDate);
                                                            const dayOfWeek = new Date(randomDate).getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            
                                                            filteredLogs.push({
                                                                id: Date.now(),
                                                                date: randomDate,
                                                                calories: basalCalories - Math.floor(Math.random() * 400) - 250,
                                                                isFasting: false,
                                                                exerciseCalories: { strength: Math.floor(Math.random() * 200) + 100, cardio: Math.floor(Math.random() * 300) + 150 },
                                                                ...(spiritualModeEnabled && {
                                                                    meditations: [
                                                                        { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 15) },
                                                                        { type: 'protecao', minutes: 10 + Math.floor(Math.random() * 10) },
                                                                        { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 15) },
                                                                        ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 25 }] : [])
                                                                    ],
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.7,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: 'Protocolo completo'
                                                                }),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 4),
                                                                    nofapNotes: 'Dia controlado'
                                                                })
                                                            });
                                                            setDailyLogs(filteredLogs);
                                                        }}
                                                        className="bg-green-600 hover:bg-green-700 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                    >
                                                        üü¢ +1 aleat√≥rio bom
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            const today = new Date().toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                            const dayOfWeek = new Date().getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            
                                                            filteredLogs.push({
                                                                id: Date.now(),
                                                                date: today,
                                                                calories: 0,
                                                                isFasting: true,
                                                                exerciseCalories: { strength: 0, cardio: 0 },
                                                                ...(spiritualModeEnabled && {
                                                                    meditations: [
                                                                        { type: 'limpeza-propria', minutes: 20 + Math.floor(Math.random() * 15) },
                                                                        { type: 'protecao', minutes: 15 + Math.floor(Math.random() * 10) },
                                                                        { type: 'conexao', minutes: 30 + Math.floor(Math.random() * 20) },
                                                                        ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 30 }] : [])
                                                                    ],
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.6,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: 'Jejum 24h - conex√£o profunda üî•'
                                                                }),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 3),
                                                                    nofapNotes: 'Jejum fortalece a vontade'
                                                                })
                                                            });
                                                            setDailyLogs(filteredLogs);
                                                        }}
                                                        className="bg-purple-700 hover:bg-purple-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                    >
                                                        üü£ Hoje jejum
                                                    </button>
                                                    <button
                                                        onClick={() => {
                                                            const randomDays = Math.floor(Math.random() * 30) + 1;
                                                            const randomDate = new Date(Date.now() - randomDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date !== randomDate);
                                                            const dayOfWeek = new Date(randomDate).getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            
                                                            filteredLogs.push({
                                                                id: Date.now(),
                                                                date: randomDate,
                                                                calories: 0,
                                                                isFasting: true,
                                                                exerciseCalories: { strength: 0, cardio: 0 },
                                                                ...(spiritualModeEnabled && {
                                                                    meditations: [
                                                                        { type: 'limpeza-propria', minutes: 20 + Math.floor(Math.random() * 15) },
                                                                        { type: 'protecao', minutes: 15 + Math.floor(Math.random() * 10) },
                                                                        { type: 'conexao', minutes: 30 + Math.floor(Math.random() * 20) },
                                                                        ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 30 }] : [])
                                                                    ],
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.6,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: 'Jejum 24h - conex√£o profunda üî•'
                                                                }),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 3),
                                                                    nofapNotes: 'Jejum fortalece a vontade'
                                                                })
                                                            });
                                                            setDailyLogs(filteredLogs);
                                                        }}
                                                        className="bg-purple-600 hover:bg-purple-700 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                    >
                                                        üü£ +1 jejum aleat√≥rio
                                                    </button>
                                                </div>
                                            </div>

                                            {/* ========== SPIRITUAL ========== */}
                                            {spiritualModeEnabled && (
                                                <div className="col-span-full border-t-2 border-indigo-600/50 pt-3 mt-2">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <span className="text-xl">üßò</span>
                                                        <h4 className="text-sm font-bold text-indigo-400">SPIRITUAL</h4>
                                                    </div>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                                        <button
                                                            onClick={() => {
                                                                const today = new Date().toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                                const dayOfWeek = new Date().getDay();
                                                                const isSunday = dayOfWeek === 0;
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: today,
                                                                    calories: basalCalories - Math.floor(Math.random() * 200) - 150,
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 100) + 50, cardio: Math.floor(Math.random() * 200) + 100 },
                                                                    meditations: [
                                                                        { type: 'limpeza-propria', minutes: 20 + Math.floor(Math.random() * 10) },
                                                                        { type: 'protecao', minutes: 15 + Math.floor(Math.random() * 10) },
                                                                        { type: 'conexao', minutes: 25 + Math.floor(Math.random() * 15) },
                                                                        ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 30 }] : [])
                                                                    ],
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.6,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: 'Protocolo completo - dia pleno üåü',
                                                                    ...(nofapModeEnabled && {
                                                                        cleanDay: true,
                                                                        urgeLevel: Math.floor(Math.random() * 3),
                                                                        nofapNotes: 'Dia limpo'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-indigo-700 hover:bg-indigo-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚≠ê Protocolo completo
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                const randomDays = Math.floor(Math.random() * 30) + 1;
                                                                const randomDate = new Date(Date.now() - randomDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== randomDate);
                                                                const dayOfWeek = new Date(randomDate).getDay();
                                                                const isSunday = dayOfWeek === 0;
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: randomDate,
                                                                    calories: basalCalories - Math.floor(Math.random() * 200) - 150,
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 100) + 50, cardio: Math.floor(Math.random() * 200) + 100 },
                                                                    meditations: [
                                                                        { type: 'limpeza-propria', minutes: 20 + Math.floor(Math.random() * 10) },
                                                                        { type: 'protecao', minutes: 15 + Math.floor(Math.random() * 10) },
                                                                        { type: 'conexao', minutes: 25 + Math.floor(Math.random() * 15) },
                                                                        ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 30 }] : [])
                                                                    ],
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.6,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: 'Protocolo completo - dia pleno üåü',
                                                                    ...(nofapModeEnabled && {
                                                                        cleanDay: true,
                                                                        urgeLevel: Math.floor(Math.random() * 3),
                                                                        nofapNotes: 'Dia limpo'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-indigo-600 hover:bg-indigo-700 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚≠ê +1 completo aleat√≥rio
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                const today = new Date().toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                                
                                                                const medTypes = ['limpeza-propria', 'protecao', 'conexao'];
                                                                const randomCount = Math.floor(Math.random() * 2) + 1; // 1-2 medita√ß√µes
                                                                const selectedMeds = [];
                                                                for (let i = 0; i < randomCount; i++) {
                                                                    const type = medTypes[Math.floor(Math.random() * medTypes.length)];
                                                                    selectedMeds.push({ type, minutes: Math.floor(Math.random() * 10) + 5 });
                                                                }
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: today,
                                                                    calories: basalCalories - Math.floor(Math.random() * 100),
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 100), cardio: Math.floor(Math.random() * 100) },
                                                                    meditations: selectedMeds,
                                                                    gratitude: Math.random() > 0.5,
                                                                    judgedOthers: Math.random() > 0.7,
                                                                    charity: false,
                                                                    feltAnger: Math.random() > 0.8,
                                                                    gossiped: Math.random() > 0.9,
                                                                    spiritualNotes: 'Dia incompleto',
                                                                    ...(nofapModeEnabled && {
                                                                        cleanDay: true,
                                                                        urgeLevel: Math.floor(Math.random() * 6) + 2,
                                                                        nofapNotes: 'Dia ok'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-orange-700 hover:bg-orange-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚ö†Ô∏è Dia incompleto
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                const today = new Date().toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: today,
                                                                    calories: basalCalories + Math.floor(Math.random() * 300),
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: 0, cardio: 0 },
                                                                    meditations: [],
                                                                    gratitude: false,
                                                                    judgedOthers: true,
                                                                    charity: false,
                                                                    feltAnger: true,
                                                                    gossiped: Math.random() > 0.5,
                                                                    spiritualNotes: 'Dia perdido üòî',
                                                                    ...(nofapModeEnabled && {
                                                                        cleanDay: Math.random() > 0.3,
                                                                        urgeLevel: Math.floor(Math.random() * 3) + 7,
                                                                        nofapNotes: 'Dia dif√≠cil'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-red-800 hover:bg-red-900 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚ùå Dia perdido
                                                        </button>
                                                    </div>
                                                </div>
                                            )}

                                            {/* ========== NOFAP ========== */}
                                            {nofapModeEnabled && (
                                                <div className="col-span-full border-t-2 border-cyan-600/50 pt-3 mt-2">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <span className="text-xl">üí™</span>
                                                        <h4 className="text-sm font-bold text-cyan-400">NOFAP</h4>
                                                    </div>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                                        <button
                                                            onClick={() => {
                                                                const today = new Date().toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: today,
                                                                    calories: basalCalories - Math.floor(Math.random() * 200) - 150,
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 200) + 100, cardio: Math.floor(Math.random() * 200) + 100 },
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 3),
                                                                    nofapNotes: 'Dia limpo - controle total üí™',
                                                                    ...(spiritualModeEnabled && {
                                                                        meditations: [
                                                                            { type: 'limpeza-propria', minutes: 15 },
                                                                            { type: 'conexao', minutes: 20 }
                                                                        ],
                                                                        gratitude: true,
                                                                        judgedOthers: false,
                                                                        charity: false,
                                                                        feltAnger: false,
                                                                        gossiped: false,
                                                                        spiritualNotes: 'Dia bom'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-cyan-700 hover:bg-cyan-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚úÖ Dia limpo
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                const randomDays = Math.floor(Math.random() * 30) + 1;
                                                                const randomDate = new Date(Date.now() - randomDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== randomDate);
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: randomDate,
                                                                    calories: basalCalories - Math.floor(Math.random() * 200) - 150,
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 200) + 100, cardio: Math.floor(Math.random() * 200) + 100 },
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 3),
                                                                    nofapNotes: 'Dia limpo - controle total üí™',
                                                                    ...(spiritualModeEnabled && {
                                                                        meditations: [
                                                                            { type: 'limpeza-propria', minutes: 15 },
                                                                            { type: 'conexao', minutes: 20 }
                                                                        ],
                                                                        gratitude: true,
                                                                        judgedOthers: false,
                                                                        charity: false,
                                                                        feltAnger: false,
                                                                        gossiped: false,
                                                                        spiritualNotes: 'Dia bom'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-cyan-600 hover:bg-cyan-700 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚úÖ +1 limpo aleat√≥rio
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                const today = new Date().toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: today,
                                                                    calories: basalCalories - Math.floor(Math.random() * 100),
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 100), cardio: Math.floor(Math.random() * 150) },
                                                                    cleanDay: true,
                                                                    urgeLevel: Math.floor(Math.random() * 3) + 6,
                                                                    nofapNotes: 'Dia dif√≠cil mas resistiu üò§',
                                                                    ...(spiritualModeEnabled && {
                                                                        meditations: [
                                                                            { type: 'limpeza-propria', minutes: 10 }
                                                                        ],
                                                                        gratitude: Math.random() > 0.5,
                                                                        judgedOthers: Math.random() > 0.7,
                                                                        charity: false,
                                                                        feltAnger: Math.random() > 0.6,
                                                                        gossiped: false,
                                                                        spiritualNotes: 'Dia tenso'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-orange-700 hover:bg-orange-800 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚ö†Ô∏è Dia dif√≠cil
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                const today = new Date().toISOString().split('T')[0];
                                                                const filteredLogs = dailyLogs.filter(log => log.date !== today);
                                                                
                                                                filteredLogs.push({
                                                                    id: Date.now(),
                                                                    date: today,
                                                                    calories: basalCalories + Math.floor(Math.random() * 400),
                                                                    isFasting: false,
                                                                    exerciseCalories: { strength: 0, cardio: 0 },
                                                                    cleanDay: false,
                                                                    urgeLevel: 10,
                                                                    nofapNotes: 'Reca√≠da üòû',
                                                                    ...(spiritualModeEnabled && {
                                                                        meditations: [],
                                                                        gratitude: false,
                                                                        judgedOthers: Math.random() > 0.5,
                                                                        charity: false,
                                                                        feltAnger: Math.random() > 0.6,
                                                                        gossiped: false,
                                                                        spiritualNotes: 'Dia dif√≠cil'
                                                                    })
                                                                });
                                                                setDailyLogs(filteredLogs);
                                                            }}
                                                            className="bg-red-800 hover:bg-red-900 px-3 py-1.5 rounded text-xs font-semibold transition-all"
                                                        >
                                                            ‚ùå Reca√≠da
                                                        </button>
                                                    </div>
                                                </div>
                                            )}
                                            
                                            {spiritualModeEnabled && (
                                                <>
                                                    <button
                                                        onClick={() => {
                                                            const numDays = 30;
                                                        const testLogs = [];
                                                        
                                                        // Remove logs dos √∫ltimos N dias para substituir
                                                        const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                        const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                        
                                                        const today = new Date();
                                                        const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                                                        const firstSunday = new Date(firstDayOfMonth);
                                                        while (firstSunday.getDay() !== 0) {
                                                            firstSunday.setDate(firstSunday.getDate() + 1);
                                                        }
                                                        
                                                        for (let i = numDays - 1; i >= 0; i--) {
                                                            const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                            const dayOfWeek = currentDate.getDay();
                                                            const isSunday = dayOfWeek === 0;
                                                            const isFirstSunday = isSunday && currentDate.getDate() === firstSunday.getDate();
                                                            
                                                            const meditations = [];
                                                            
                                                            // Protocolo padr√£o (falta ocasionalmente)
                                                            if (Math.random() > 0.15) {
                                                                meditations.push({ type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 20) });
                                                                meditations.push({ type: 'protecao', minutes: 10 + Math.floor(Math.random() * 15) });
                                                                meditations.push({ type: 'conexao', minutes: 20 + Math.floor(Math.random() * 25) });
                                                                
                                                                if (isSunday && !isFirstSunday) {
                                                                    meditations.push({ type: 'limpeza-ambiente', minutes: 20 + Math.floor(Math.random() * 15) });
                                                                }
                                                                
                                                                if (isFirstSunday) {
                                                                    meditations.push({ type: 'consagracao-cristais', minutes: 30 + Math.floor(Math.random() * 20) });
                                                                }
                                                            }
                                                            
                                                            const hadAnger = Math.random() > 0.85;
                                                            const hadGossip = Math.random() > 0.9;
                                                            
                                                            // NoFap (se ativo)
                                                            const isCleanDay = !nofapModeEnabled || Math.random() > 0.1;
                                                            const urgeLevel = nofapModeEnabled ? (isCleanDay ? Math.floor(Math.random() * 7) : 0) : undefined;
                                                            
                                                            testLogs.push({
                                                                id: Date.now() - (i * 10000),
                                                                date: currentDate.toISOString().split('T')[0],
                                                                calories: basalCalories - Math.floor(Math.random() * 400) - 200,
                                                                isFasting: Math.random() > 0.8, // 20% jejum
                                                                exerciseCalories: { strength: Math.floor(Math.random() * 200), cardio: Math.floor(Math.random() * 300) },
                                                                meditations: meditations,
                                                                gratitude: Math.random() > 0.2,
                                                                judgedOthers: Math.random() > 0.75,
                                                                charity: Math.random() > 0.85,
                                                                feltAnger: hadAnger,
                                                                gossiped: hadGossip,
                                                                spiritualNotes: meditations.length === 0 ? 'Dia dif√≠cil, protocolo incompleto' : 
                                                                                (isFirstSunday ? 'Consagra√ß√£o dos cristais ‚ú®' :
                                                                                (isSunday ? 'Limpeza do ambiente üè†' :
                                                                                (hadAnger || hadGossip ? 'Desafiador, mas fiz as pr√°ticas' : 
                                                                                'Conex√£o com o cosmos'))),
                                                                ...(nofapModeEnabled && {
                                                                    cleanDay: isCleanDay,
                                                                    urgeLevel,
                                                                    nofapNotes: isCleanDay ? `Urges ${urgeLevel}` : 'Reca√≠da'
                                                                })
                                                            });
                                                        }
                                                        setDailyLogs([...filteredLogs, ...testLogs]);
                                                    }}
                                                    className="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                                >
                                                    üßò Protocolo Filhos das Estrelas (30 dias + todos m√≥dulos)
                                                </button>
                                                </>
                                            )}
                                            
                                            {nofapModeEnabled && (
                                                <>
                                                    <button
                                                    onClick={() => {
                                                        const numDays = 30;
                                                            const testLogs = [];
                                                            
                                                            // Remove logs dos √∫ltimos N dias
                                                            const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                            
                                                            for (let i = numDays - 1; i >= 0; i--) {
                                                                const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                                const dayOfWeek = currentDate.getDay();
                                                                const isSaturday = dayOfWeek === 6;
                                                                const isSunday = dayOfWeek === 0;
                                                                const isRelapse = isSaturday && Math.random() > 0.5;
                                                                
                                                                const urgeLevel = isRelapse ? 0 : (isSaturday ? 8 : Math.floor(Math.random() * 7));
                                                                
                                                                // Medita√ß√µes (se espiritual ativo)
                                                                const meditations = spiritualModeEnabled && Math.random() > 0.2 ? [
                                                                    { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 20) },
                                                                    { type: 'protecao', minutes: 10 + Math.floor(Math.random() * 15) },
                                                                    { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 25) },
                                                                    ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 20 + Math.floor(Math.random() * 15) }] : [])
                                                                ] : [];
                                                                
                                                                testLogs.push({
                                                                    id: Date.now() - (i * 10000),
                                                                    date: currentDate.toISOString().split('T')[0],
                                                                    calories: basalCalories - Math.floor(Math.random() * 400) - 200,
                                                                    isFasting: Math.random() > 0.85,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 200), cardio: Math.floor(Math.random() * 300) },
                                                                    cleanDay: !isRelapse,
                                                                    urgeLevel: urgeLevel,
                                                                    nofapNotes: isRelapse ? 'Reca√≠da s√°bado - t√©dio gatilho' : 
                                                                               (isSaturday ? 'S√°bado dif√≠cil, resisti' :
                                                                               urgeLevel >= 7 ? 'Urges altos, exerc√≠cios ajudaram' :
                                                                               'Dia tranquilo'),
                                                                    ...(spiritualModeEnabled && {
                                                                        meditations,
                                                                        gratitude: Math.random() > 0.3,
                                                                        judgedOthers: Math.random() > 0.7,
                                                                        charity: Math.random() > 0.85,
                                                                        feltAnger: Math.random() > 0.8,
                                                                        gossiped: Math.random() > 0.9,
                                                                        spiritualNotes: meditations.length > 0 ? 'Protocolo ok' : 'Sem protocolo'
                                                                    })
                                                                });
                                                            }
                                                            setDailyLogs([...filteredLogs, ...testLogs]);
                                                        }}
                                                        className="w-full bg-cyan-600 hover:bg-cyan-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                                    >
                                                        üí™ NoFap: Padr√£o S√°bado (30 dias + todos m√≥dulos)
                                                    </button>
                                                    
                                                    <button
                                                        onClick={() => {
                                                            const numDays = 90;
                                                            const testLogs = [];
                                                            
                                                            // Remove logs dos √∫ltimos N dias
                                                            const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                            
                                                            let currentStreakDays = 0;
                                                            for (let i = numDays - 1; i >= 0; i--) {
                                                                const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                                const dayOfWeek = currentDate.getDay();
                                                                const isSunday = dayOfWeek === 0;
                                                                
                                                                // Reca√≠das estrat√©gicas
                                                                const isRelapse = i === 70 || i === 45 || i === 20;
                                                                
                                                                if (isRelapse) {
                                                                    currentStreakDays = 0;
                                                                } else {
                                                                    currentStreakDays++;
                                                                }
                                                                
                                                                const daysSinceRelapse = currentStreakDays;
                                                                const nearRecord = daysSinceRelapse > 15 && daysSinceRelapse % 5 === 0;
                                                                const urgeLevel = isRelapse ? 0 : (nearRecord ? 8 + Math.floor(Math.random() * 2) : Math.floor(Math.random() * 6));
                                                                
                                                                // Medita√ß√µes (se espiritual ativo)
                                                                const meditations = spiritualModeEnabled && Math.random() > 0.15 ? [
                                                                    { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 20) },
                                                                    { type: 'protecao', minutes: 10 + Math.floor(Math.random() * 15) },
                                                                    { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 25) },
                                                                    ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 20 + Math.floor(Math.random() * 15) }] : [])
                                                                ] : [];
                                                                
                                                                testLogs.push({
                                                                    id: Date.now() - (i * 10000),
                                                                    date: currentDate.toISOString().split('T')[0],
                                                                    calories: basalCalories - Math.floor(Math.random() * 400) - 200,
                                                                    isFasting: Math.random() > 0.9,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 200), cardio: Math.floor(Math.random() * 300) },
                                                                    cleanDay: !isRelapse,
                                                                    urgeLevel: urgeLevel,
                                                                    nofapNotes: isRelapse ? `Reca√≠da ap√≥s ${daysSinceRelapse}d` : 
                                                                               (nearRecord ? `Dia ${daysSinceRelapse} - Efeito ca√ßador!` :
                                                                               urgeLevel >= 7 ? 'Urges altos, resisti' :
                                                                               `Dia ${daysSinceRelapse} - forte`),
                                                                    ...(spiritualModeEnabled && {
                                                                        meditations,
                                                                        gratitude: Math.random() > 0.25,
                                                                        judgedOthers: Math.random() > 0.75,
                                                                        charity: Math.random() > 0.85,
                                                                        feltAnger: Math.random() > 0.85,
                                                                        gossiped: Math.random() > 0.9,
                                                                        spiritualNotes: meditations.length > 0 ? 'Protocolo' : 'Incompleto'
                                                                    })
                                                                });
                                                            }
                                                            setDailyLogs([...filteredLogs, ...testLogs]);
                                                        }}
                                                        className="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                                    >
                                                        üèÜ NoFap: 90 dias + Efeito Ca√ßador + todos m√≥dulos
                                                    </button>
                                                </>
                                            )}
                                            
                                            {spiritualModeEnabled && (
                                                <>
                                                    <button
                                                    onClick={() => {
                                                        const numDays = 7;
                                                            const testLogs = [];
                                                            
                                                            // Remove logs dos √∫ltimos 7 dias
                                                            const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                            
                                                            for (let i = numDays - 1; i >= 0; i--) {
                                                                const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                                const dayOfWeek = currentDate.getDay();
                                                                const isSunday = dayOfWeek === 0;
                                                                
                                                                const meditations = [
                                                                    { type: 'limpeza-propria', minutes: 20 + Math.floor(Math.random() * 15) },
                                                                    { type: 'protecao', minutes: 15 + Math.floor(Math.random() * 10) },
                                                                    { type: 'conexao', minutes: 25 + Math.floor(Math.random() * 20) },
                                                                    ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 30 }] : [])
                                                                ];
                                                                
                                                                // NoFap (se ativo)
                                                                const isCleanDay = !nofapModeEnabled || true; // Semana perfeita
                                                                const urgeLevel = nofapModeEnabled ? Math.floor(Math.random() * 4) : undefined;
                                                                
                                                                testLogs.push({
                                                                    id: Date.now() - (i * 10000),
                                                                    date: currentDate.toISOString().split('T')[0],
                                                                    calories: basalCalories - Math.floor(Math.random() * 400) - 200,
                                                                    isFasting: Math.random() > 0.7,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 200), cardio: Math.floor(Math.random() * 300) },
                                                                    meditations: meditations,
                                                                    gratitude: true,
                                                                    judgedOthers: false,
                                                                    charity: Math.random() > 0.5,
                                                                    feltAnger: false,
                                                                    gossiped: false,
                                                                    spiritualNotes: isSunday ? 'Limpeza profunda üè†‚ú®' : `${meditations.reduce((sum, m) => sum + m.minutes, 0)}min conex√£o`,
                                                                    ...(nofapModeEnabled && {
                                                                        cleanDay: isCleanDay,
                                                                        urgeLevel,
                                                                        nofapNotes: `Dia tranquilo (${urgeLevel})`
                                                                    })
                                                                });
                                                            }
                                                            setDailyLogs([...filteredLogs, ...testLogs]);
                                                        }}
                                                        className="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                                    >
                                                        ‚ú® Espiritual: Semana Perfeita + todos m√≥dulos
                                                    </button>
                                                    
                                                    <button
                                                        onClick={() => {
                                                            const numDays = 14;
                                                            const testLogs = [];
                                                            
                                                            // Remove logs dos √∫ltimos 14 dias
                                                            const cutoffDate = new Date(Date.now() - numDays * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                                                            const filteredLogs = dailyLogs.filter(log => log.date < cutoffDate);
                                                            
                                                            for (let i = numDays - 1; i >= 0; i--) {
                                                                const currentDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                                                                const dayOfWeek = currentDate.getDay();
                                                                const isSunday = dayOfWeek === 0;
                                                                
                                                                const hadBadDay = i % 3 === 0;
                                                                const meditations = hadBadDay ? [] : [
                                                                    { type: 'limpeza-propria', minutes: 15 + Math.floor(Math.random() * 10) },
                                                                    { type: 'protecao', minutes: 10 + Math.floor(Math.random() * 10) },
                                                                    { type: 'conexao', minutes: 20 + Math.floor(Math.random() * 15) },
                                                                    ...(isSunday ? [{ type: 'limpeza-ambiente', minutes: 20 + Math.floor(Math.random() * 10) }] : [])
                                                                ];
                                                                
                                                                // NoFap (se ativo) - dias dif√≠ceis = mais reca√≠das
                                                                const isCleanDay = !nofapModeEnabled || Math.random() > 0.25;
                                                                const urgeLevel = nofapModeEnabled ? (isCleanDay ? Math.floor(Math.random() * 5) + 4 : 0) : undefined;
                                                                
                                                                testLogs.push({
                                                                    id: Date.now() - (i * 10000),
                                                                    date: currentDate.toISOString().split('T')[0],
                                                                    calories: basalCalories - Math.floor(Math.random() * 400) - 200,
                                                                    isFasting: Math.random() > 0.9,
                                                                    exerciseCalories: { strength: Math.floor(Math.random() * 200), cardio: Math.floor(Math.random() * 300) },
                                                                    meditations: meditations,
                                                                    gratitude: !hadBadDay,
                                                                    judgedOthers: hadBadDay,
                                                                    charity: false,
                                                                    feltAnger: hadBadDay && Math.random() > 0.5,
                                                                    gossiped: hadBadDay && Math.random() > 0.7,
                                                                    spiritualNotes: hadBadDay ? 
                                                                        'Dia pesado, negatividade' :
                                                                        'Pr√°ticas me centraram',
                                                                    ...(nofapModeEnabled && {
                                                                        cleanDay: isCleanDay,
                                                                        urgeLevel,
                                                                        nofapNotes: isCleanDay ? `Urges altos (${urgeLevel})` : 'Reca√≠da'
                                                                    })
                                                                });
                                                            }
                                                            setDailyLogs([...filteredLogs, ...testLogs]);
                                                        }}
                                                        className="w-full bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                                    >
                                                        ‚ö†Ô∏è Espiritual: 14 dias dif√≠ceis + todos m√≥dulos
                                                    </button>
                                                </>
                                            )}
                                            
                                            <button
                                                onClick={() => {
                                                    if (confirm('‚ö†Ô∏è Tem certeza que deseja recarregar?\n\nIsso vai limpar todos os dados de teste tempor√°rios.')) {
                                                        window.location.reload();
                                                    }
                                                }}
                                                className="w-full bg-slate-600 hover:bg-slate-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm border border-slate-500"
                                            >
                                                üîÑ Recarregar e Limpar Dados de Teste
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Settings Button - Fixed Top Right */}
                        <button
                            onClick={() => setShowSettingsModal(true)}
                            className="fixed top-4 right-4 z-50 bg-slate-700 hover:bg-slate-600 text-white p-3 rounded-full shadow-2xl border-2 border-slate-500 hover:border-slate-400 transition-all hover:scale-110"
                            title="Configura√ß√µes"
                        >
                            <Settings className="h-6 w-6" />
                        </button>

                        {/* Settings Modal */}
                        {showSettingsModal && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <div className="bg-slate-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border-2 border-slate-700 shadow-2xl">
                                    {/* Modal Header */}
                                    <div className="sticky top-0 bg-slate-900 border-b border-slate-700 p-6 flex items-center justify-between">
                                        <div>
                                            <h2 className="text-3xl font-bold flex items-center gap-3">
                                                <Settings className="h-8 w-8 text-purple-400" />
                                                Configura√ß√µes
                                            </h2>
                                            <p className="text-slate-400 mt-1">Personalize sua experi√™ncia</p>
                                        </div>
                                        <button
                                            onClick={() => setShowSettingsModal(false)}
                                            className="bg-slate-700 hover:bg-slate-600 p-2 rounded-lg transition-all"
                                        >
                                            <X className="h-6 w-6" />
                                        </button>
                                    </div>

                                    {/* Modal Content */}
                                    <div className="p-6 space-y-6">
                                        {/* Goals Section */}
                                        <div className="bg-slate-800/50 rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                                <Target className="h-6 w-6 text-blue-400" />
                                                Metas & Configura√ß√µes
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-semibold text-slate-300 mb-2">
                                                        Calorias Basais / Manuten√ß√£o. 
                                                        <br/>
                                                        N√ÉO CONTE N√çVEL DE ATIVIDADE!
                                                    </label>
                                                    <div className="flex items-center gap-2">
                                                        <input
                                                            type="number"
                                                            value={basalCalories}
                                                            onChange={(e) => setBasalCalories(Number(e.target.value))}
                                                            className="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg"
                                                            placeholder="2300"
                                                        />
                                                        <span className="text-slate-400 font-semibold">kcal/dia</span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-semibold text-slate-300 mb-2">
                                                        Meta de Gordura Corporal
                                                    </label>
                                                    <div className="flex items-center gap-2">
                                                        <input
                                                            type="number"
                                                            step="0.1"
                                                            min="4"
                                                            max="25"
                                                            value={targetBodyFat}
                                                            onChange={(e) => setTargetBodyFat(Number(e.target.value))}
                                                            className="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg"
                                                            placeholder="6.0"
                                                        />
                                                        <span className="text-slate-400 font-semibold">% gordura</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Optional Modules */}
                                        <div className="bg-gradient-to-br from-purple-900/30 to-pink-900/30 rounded-xl p-6 border-2 border-purple-500/30">
                                            <h3 className="text-2xl font-bold mb-2 flex items-center gap-2">
                                                <span className="text-3xl">üîÆ</span>
                                                M√≥dulos Opcionais
                                            </h3>
                                            <p className="text-sm text-slate-400 mb-6">Ative funcionalidades extras para uma transforma√ß√£o completa</p>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {/* Spiritual Mode Toggle */}
                                                <div className="bg-slate-800/50 rounded-lg p-5 border border-slate-600">
                                                    <div className="flex items-center justify-between mb-3">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-3xl">üßò</span>
                                                            <div>
                                                                <h4 className="font-bold text-lg">Modo Espiritual</h4>
                                                                <p className="text-xs text-slate-400">Medita√ß√£o & Journaling</p>
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => setSpiritualModeEnabled(!spiritualModeEnabled)}
                                                            className={`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${
                                                                spiritualModeEnabled ? 'bg-green-600' : 'bg-slate-600'
                                                            }`}
                                                        >
                                                            <span className={`inline-block h-6 w-6 transform rounded-full bg-white transition-transform ${
                                                                spiritualModeEnabled ? 'translate-x-7' : 'translate-x-1'
                                                            }`} />
                                                        </button>
                                                    </div>
                                                    <p className="text-sm text-slate-300">
                                                        Rastreie medita√ß√£o, gratid√£o, julgamentos e pr√°ticas espirituais di√°rias
                                                    </p>
                                                </div>

                                                {/* NoFap Mode Toggle */}
                                                <div className="bg-slate-800/50 rounded-lg p-5 border border-slate-600">
                                                    <div className="flex items-center justify-between mb-3">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-3xl">üí™</span>
                                                            <div>
                                                                <h4 className="font-bold text-lg">Modo NoFap</h4>
                                                                <p className="text-xs text-slate-400">Controle & Disciplina</p>
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => setNofapModeEnabled(!nofapModeEnabled)}
                                                            className={`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${
                                                                nofapModeEnabled ? 'bg-green-600' : 'bg-slate-600'
                                                            }`}
                                                        >
                                                            <span className={`inline-block h-6 w-6 transform rounded-full bg-white transition-transform ${
                                                                nofapModeEnabled ? 'translate-x-7' : 'translate-x-1'
                                                            }`} />
                                                        </button>
                                                    </div>
                                                    <p className="text-sm text-slate-300">
                                                        Rastreie sua jornada NoFap com an√°lise de padr√µes e suporte anti-reca√≠da
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Modal Footer */}
                                    <div className="sticky bottom-0 bg-slate-900 border-t border-slate-700 p-6">
                                        <button
                                            onClick={() => setShowSettingsModal(false)}
                                            className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-lg transition-all"
                                        >
                                            Salvar e Fechar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Smart Badge Flutuante - FEATURE CRIATIVA */}
                        {dailyLogs.length > 0 && (() => {
                            // Calcula a m√©trica mais relevante do momento
                            const getSmartBadge = () => {
                                // 1. Verifica streak atual (prioridade alta se > 3 dias)
                                const last7Days = dailyLogs.slice(-7);
                                let consecutiveGood = 0;
                                for (let i = last7Days.length - 1; i >= 0; i--) {
                                    const log = last7Days[i];
                                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                    const deficit = (basalCalories + exerciseTotal) - log.calories;
                                    
                                    if (log.isFasting || deficit >= 300) {
                                        consecutiveGood++;
                                    } else if (!log.isRefeed) {
                                        break;
                                    }
                                }
                                
                                if (consecutiveGood >= 3) {
                                    return {
                                        emoji: 'üî•',
                                        value: consecutiveGood,
                                        label: 'dias seguidos',
                                        color: 'from-orange-500 to-red-500',
                                        pulse: false
                                    };
                                }
                                
                                // 2. Dias at√© a meta (se o progresso √© bom)
                                if (stats.avgDailyDeficit > 300 && stats.daysNeeded < 100) {
                                    return {
                                        emoji: 'üéØ',
                                        value: stats.daysNeeded,
                                        label: `dias at√© ${targetBodyFat}%`,
                                        color: 'from-blue-500 to-purple-500',
                                        pulse: false
                                    };
                                }
                                
                                // 3. BF% atual (sempre relevante)
                                return {
                                    emoji: 'üìä',
                                    value: safeFixed(stats.currentBF, 1),
                                    label: '% gordura',
                                    color: 'from-cyan-500 to-blue-500',
                                    pulse: false
                                };
                            };
                            
                            const badge = getSmartBadge();
                            
                            return (
                                <div className={`fixed top-4 left-4 z-50 bg-gradient-to-r ${badge.color} rounded-full px-4 py-2 shadow-2xl border-2 border-white/30 ${badge.pulse ? '' : ''}`}>
                                    <div className="flex items-center gap-2">
                                        <span className="text-2xl">{badge.emoji}</span>
                                        <div className="text-white">
                                            <div className="text-2xl font-black leading-none">{badge.value}</div>
                                            <div className="text-[9px] font-semibold uppercase tracking-wide opacity-90">{badge.label}</div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })()}

                        {/* Header */}
                        <div className="text-center mb-8 pt-6">
                            <h1 
                                onClick={handleTitleClick}
                                className="text-5xl font-bold mb-2 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent select-none"
                            >
                                Body Tracker Pro
                            </h1>
                            <p className="text-slate-400">Sua jornada rumo aos {targetBodyFat}% de gordura corporal</p>
                            
                            {/* Import/Export Buttons */}
                            <div className="flex gap-3 justify-center mt-4">
                                <button
                                    onClick={exportData}
                                    className="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all"
                                >
                                    <Download className="h-5 w-5" />
                                    Exportar Dados
                                </button>
                                <label className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all cursor-pointer">
                                    <Upload className="h-5 w-5" />
                                    Importar Dados
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        className="hidden"
                                    />
                                </label>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 mb-6 bg-slate-800/50 p-2 rounded-xl overflow-x-auto">
                            <button
                                onClick={() => setActiveTab('dashboard')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                    activeTab === 'dashboard' 
                                        ? 'bg-blue-600 text-white shadow-lg' 
                                        : 'text-slate-400 hover:text-white hover:bg-slate-700'
                                }`}
                            >
                                <Target className="inline mr-2 h-5 w-5" />
                                Dashboard
                            </button>
                            <button
                                onClick={() => setActiveTab('evaluations')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                    activeTab === 'evaluations' 
                                        ? 'bg-blue-600 text-white shadow-lg' 
                                        : 'text-slate-400 hover:text-white hover:bg-slate-700'
                                }`}
                            >
                                <Scale className="inline mr-2 h-5 w-5" />
                                Avalia√ß√µes F√≠sicas
                            </button>
                            <button
                                onClick={() => setActiveTab('logs')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                    activeTab === 'logs' 
                                        ? 'bg-blue-600 text-white shadow-lg' 
                                        : 'text-slate-400 hover:text-white hover:bg-slate-700'
                                }`}
                            >
                                <Calendar className="inline mr-2 h-5 w-5" />
                                Registro Di√°rio
                            </button>
                            <button
                                onClick={() => setActiveTab('charts')}
                                className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                    activeTab === 'charts' 
                                        ? 'bg-blue-600 text-white shadow-lg' 
                                        : 'text-slate-400 hover:text-white hover:bg-slate-700'
                                }`}
                            >
                                <TrendingUp className="inline mr-2 h-5 w-5" />
                                Gr√°ficos
                            </button>
                            {spiritualModeEnabled && (
                                <button
                                    onClick={() => setActiveTab('spiritual')}
                                    className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                        activeTab === 'spiritual' 
                                            ? 'bg-purple-600 text-white shadow-lg' 
                                            : 'text-slate-400 hover:text-white hover:bg-slate-700'
                                    }`}
                                >
                                    üßò Espiritual
                                </button>
                            )}
                            {nofapModeEnabled && (
                                <button
                                    onClick={() => setActiveTab('nofap')}
                                    className={`flex-1 py-3 px-4 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                        activeTab === 'nofap' 
                                            ? 'bg-cyan-600 text-white shadow-lg' 
                                            : 'text-slate-400 hover:text-white hover:bg-slate-700'
                                    }`}
                                >
                                    üí™ NoFap
                                </button>
                            )}
                        </div>

                        {/* Dashboard Tab */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                {/* Snake Diet Banner */}
                                <a 
                                    href="https://www.youtube.com/@SnakeDiet/featured" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="block bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 shadow-2xl border-2 border-slate-600 hover:border-blue-500 hover:scale-[1.02] transition-all duration-300"
                                >
                                    <div className="flex items-center justify-center gap-4">
                                        <div className="text-5xl">üêç</div>
                                        <div className="text-center">
                                            <h2 className="text-3xl font-black text-white mb-1">SNAKE DIET</h2>
                                            <p className="text-lg font-semibold text-slate-300">Cole Robinson - Canal Oficial</p>
                                            <p className="text-sm text-slate-400 mt-1">Clique para acessar o canal no YouTube üé•</p>
                                        </div>
                                        <div className="text-5xl">üí™</div>
                                    </div>
                                </a>

                                {/* Activity Calendar - GitHub Style */}
                                {(() => {
                                    // Gera dados do calend√°rio baseado na data de visualiza√ß√£o atual
                                    const generateCalendarData = () => {
                                        const viewDate = new Date(currentViewDate);
                                        const days = calendarView === 'monthly' ? 30 : 7;
                                        const data = [];
                                        
                                        // Para visualiza√ß√£o mensal, mostra os √∫ltimos 30 dias a partir da viewDate
                                        // Para semanal, mostra a semana completa da viewDate
                                        if (calendarView === 'monthly') {
                                            for (let i = days - 1; i >= 0; i--) {
                                                const date = new Date(viewDate);
                                                date.setDate(date.getDate() - i);
                                                const dateStr = date.toISOString().split('T')[0];
                                                
                                                const log = dailyLogs.find(l => l.date === dateStr);
                                                const isTodayDate = isToday(dateStr);
                                                const isFuture = isFutureDate(dateStr);
                                                
                                                let status = 'none'; // cinza
                                                if (log) {
                                                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                    const deficit = (basalCalories + exerciseTotal) - log.calories;
                                                    
                                                    if (log.isRefeed) {
                                                        status = 'refeed'; // azul
                                                    } else if (log.isFasting) {
                                                        status = 'fasting'; // roxo - jejum
                                                    } else if (deficit >= 500) {
                                                        status = 'excellent'; // verde escuro
                                                    } else if (deficit >= 300) {
                                                        status = 'good'; // verde claro
                                                    } else if (deficit >= 0) {
                                                        status = 'ok'; // amarelo
                                                    } else if (deficit >= -200) {
                                                        status = 'maintenance'; // laranja
                                                    } else {
                                                        status = 'bad'; // vermelho
                                                    }
                                                } else if (isFuture) {
                                                    status = 'future'; // futuro = mais escuro
                                                }
                                                
                                                data.push({
                                                    date: dateStr,
                                                    dayOfWeek: date.getDay(),
                                                    dayOfMonth: date.getDate(),
                                                    month: date.getMonth(),
                                                    year: date.getFullYear(),
                                                    status,
                                                    log,
                                                    isToday: isTodayDate,
                                                    isFuture
                                                });
                                            }
                                        } else {
                                            // Modo semanal: mostra a semana que cont√©m a viewDate
                                            const startOfWeek = new Date(viewDate);
                                            const dayOfWeek = startOfWeek.getDay();
                                            startOfWeek.setDate(startOfWeek.getDate() - dayOfWeek); // Volta para domingo
                                            
                                            for (let i = 0; i < 7; i++) {
                                                const date = new Date(startOfWeek);
                                                date.setDate(date.getDate() + i);
                                                const dateStr = date.toISOString().split('T')[0];
                                                
                                                const log = dailyLogs.find(l => l.date === dateStr);
                                                const isTodayDate = isToday(dateStr);
                                                const isFuture = isFutureDate(dateStr);
                                                
                                                let status = 'none';
                                                if (log) {
                                                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                    const deficit = (basalCalories + exerciseTotal) - log.calories;
                                                    
                                                    if (log.isRefeed) {
                                                        status = 'refeed';
                                                    } else if (log.isFasting) {
                                                        status = 'fasting';
                                                    } else if (deficit >= 500) {
                                                        status = 'excellent';
                                                    } else if (deficit >= 300) {
                                                        status = 'good';
                                                    } else if (deficit >= 0) {
                                                        status = 'ok';
                                                    } else if (deficit >= -200) {
                                                        status = 'maintenance';
                                                    } else {
                                                        status = 'bad';
                                                    }
                                                } else if (isFuture) {
                                                    status = 'future';
                                                }
                                                
                                                data.push({
                                                    date: dateStr,
                                                    dayOfWeek: date.getDay(),
                                                    dayOfMonth: date.getDate(),
                                                    month: date.getMonth(),
                                                    year: date.getFullYear(),
                                                    status,
                                                    log,
                                                    isToday: isTodayDate,
                                                    isFuture
                                                });
                                            }
                                        }
                                        
                                        return data;
                                    };
                                    
                                    const getStatusColor = (status, isTodayDate, isFuture) => {
                                        let baseColor;
                                        switch(status) {
                                            case 'excellent': baseColor = 'bg-green-600 hover:bg-green-500'; break;
                                            case 'good': baseColor = 'bg-green-400 hover:bg-green-300'; break;
                                            case 'ok': baseColor = 'bg-yellow-400 hover:bg-yellow-300'; break;
                                            case 'maintenance': baseColor = 'bg-orange-400 hover:bg-orange-300'; break;
                                            case 'bad': baseColor = 'bg-red-600 hover:bg-red-500'; break;
                                            case 'refeed': baseColor = 'bg-blue-500 hover:bg-blue-400'; break;
                                            case 'fasting': baseColor = 'bg-purple-600 hover:bg-purple-500'; break;
                                            case 'future': baseColor = 'bg-slate-800/50 hover:bg-slate-700/50'; break;
                                            default: baseColor = 'bg-slate-700 hover:bg-slate-600';
                                        }
                                        
                                        // Adiciona borda branca pulsante para hoje
                                        if (isTodayDate) {
                                            baseColor += ' ring-2 ring-white ring-offset-2 ring-offset-slate-900';
                                        }
                                        
                                        return baseColor;
                                    };
                                    
                                    const getStatusLabel = (status, isFuture) => {
                                        if (isFuture) return 'Data futura';
                                        switch(status) {
                                            case 'excellent': return 'Excelente (500+ kcal deficit)';
                                            case 'good': return 'Bom (300-499 kcal deficit)';
                                            case 'ok': return 'OK (0-299 kcal deficit)';
                                            case 'maintenance': return 'Manuten√ß√£o (at√© 200 kcal super√°vit)';
                                            case 'bad': return 'Ruim (200+ kcal super√°vit)';
                                            case 'refeed': return 'Refeed Estrat√©gico';
                                            case 'fasting': return 'Jejum 24h üî•';
                                            default: return 'Sem registro';
                                        }
                                    };
                                    
                                    const calendarData = generateCalendarData();
                                    const isViewingToday = currentViewDate.toDateString() === today.toDateString();
                                    
                                    return (
                                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 shadow-2xl border-2 border-slate-600">
                                            {/* Header com T√≠tulo e Controles */}
                                            <div className="flex items-center justify-between mb-4">
                                                <div>
                                                    <h2 className="text-2xl font-bold flex items-center gap-2">
                                                        <Calendar className="h-7 w-7 text-purple-400" />
                                                        Calend√°rio de Atividades
                                                    </h2>
                                                    <p className="text-sm text-slate-400 mt-1">Sua consist√™ncia em cores - estilo GitHub</p>
                                                </div>
                                                <div className="flex gap-2 bg-slate-700/50 rounded-lg p-1">
                                                    <button
                                                        onClick={() => setCalendarView('weekly')}
                                                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                                            calendarView === 'weekly' 
                                                                ? 'bg-purple-600 text-white' 
                                                                : 'text-slate-400 hover:text-white'
                                                        }`}
                                                    >
                                                        7 Dias
                                                    </button>
                                                    <button
                                                        onClick={() => setCalendarView('monthly')}
                                                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                                            calendarView === 'monthly' 
                                                                ? 'bg-purple-600 text-white' 
                                                                : 'text-slate-400 hover:text-white'
                                                        }`}
                                                    >
                                                        30 Dias
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            {/* Navega√ß√£o Temporal */}
                                            <div className="flex items-center justify-between mb-4 bg-slate-700/30 rounded-lg p-3">
                                                <button
                                                    onClick={() => navigateCalendar(-1)}
                                                    className="bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-2"
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                                    </svg>
                                                    {calendarView === 'monthly' ? 'M√™s anterior' : 'Semana anterior'}
                                                </button>
                                                
                                                <div className="flex flex-col items-center">
                                                    <div className="text-lg font-bold text-white">
                                                        {getMonthYearLabel(currentViewDate)}
                                                    </div>
                                                    {!isViewingToday && (
                                                        <button
                                                            onClick={goToToday}
                                                            className="text-xs text-purple-400 hover:text-purple-300 underline mt-1"
                                                        >
                                                            Voltar para hoje
                                                        </button>
                                                    )}
                                                    {isViewingToday && (
                                                        <div className="text-xs text-green-400 mt-1 flex items-center gap-1">
                                                            <span className="inline-block w-2 h-2 bg-green-400 rounded-full"></span>
                                                            Visualizando hoje
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                {!isViewingToday && (
                                                    <button
                                                        onClick={() => navigateCalendar(1)}
                                                        className="bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-2"
                                                    >
                                                        {calendarView === 'monthly' ? 'Pr√≥ximo m√™s' : 'Pr√≥xima semana'}
                                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                        </svg>
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {/* Grid do Calend√°rio */}
                                            <div className={`flex ${calendarView === 'weekly' ? 'grid grid-cols-7 gap-2' : 'flex-wrap gap-1.5'} mb-4`}>
                                                {calendarData.map((day, idx) => {
                                                    const exerciseTotal = day.log ? ((day.log.exerciseCalories?.strength || 0) + (day.log.exerciseCalories?.cardio || 0)) : 0;
                                                    const deficit = day.log ? ((basalCalories + exerciseTotal) - day.log.calories) : 0;
                                                    
                                                    return (
                                                        <div
                                                            key={idx}
                                                            className={`${calendarView === 'weekly' ? 'w-full aspect-square' : 'w-6 h-6'} rounded ${getStatusColor(day.status, day.isToday, day.isFuture)} transition-all cursor-pointer group relative`}
                                                            title={`${new Date(day.date).toLocaleDateString('pt-BR')}${day.isToday ? ' (HOJE)' : ''} - ${getStatusLabel(day.status, day.isFuture)}`}
                                                        >
                                                            {calendarView === 'weekly' && (
                                                                <div className="absolute inset-0 flex flex-col items-center justify-center text-[10px] font-bold text-white">
                                                                    <div>{['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'][day.dayOfWeek]}</div>
                                                                    <div className="text-[8px] opacity-75">{day.dayOfMonth}</div>
                                                                </div>
                                                            )}
                                                            
                                                            {/* Tooltip on hover */}
                                                            <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-10">
                                                                <div className="bg-slate-900 text-white text-xs rounded-lg p-3 shadow-2xl border border-slate-700 whitespace-nowrap">
                                                                    <div className="font-bold mb-1 flex items-center gap-2">
                                                                        {new Date(day.date).toLocaleDateString('pt-BR')}
                                                                        {day.isToday && <span className="bg-green-500 text-white text-[10px] px-2 py-0.5 rounded-full">HOJE</span>}
                                                                        {day.isFuture && <span className="bg-slate-600 text-white text-[10px] px-2 py-0.5 rounded-full">FUTURO</span>}
                                                                    </div>
                                                                    <div className="text-slate-300">{getStatusLabel(day.status, day.isFuture)}</div>
                                                                    {day.log && !day.isFuture && (
                                                                        <>
                                                                            <div className="text-slate-400 mt-1">
                                                                                {day.log.isFasting ? 'üî• Jejum 24h' : `${day.log.calories} kcal`}
                                                                            </div>
                                                                            {!day.log.isFasting && (
                                                                                <div className={`mt-1 font-semibold ${deficit >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                                    {deficit >= 0 ? 'Deficit' : 'Super√°vit'}: {Math.abs(deficit).toFixed(0)} kcal
                                                                                </div>
                                                                            )}
                                                                        </>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                            
                                            {/* Stats r√°pidas do per√≠odo visualizado */}
                                            {(() => {
                                                const logsInView = calendarData.filter(d => d.log && !d.isFuture);
                                                const goodDaysInView = logsInView.filter(d => {
                                                    const exerciseTotal = (d.log.exerciseCalories?.strength || 0) + (d.log.exerciseCalories?.cardio || 0);
                                                    const deficit = (basalCalories + exerciseTotal) - d.log.calories;
                                                    return d.log.isFasting || deficit >= 300;
                                                }).length;
                                                
                                                const consistency = logsInView.length > 0 ? (goodDaysInView / logsInView.length) * 100 : 0;
                                                
                                                if (logsInView.length === 0) return null;
                                                
                                                return (
                                                    <div className="mb-4 p-3 bg-slate-700/30 rounded-lg border border-slate-600">
                                                        <div className="flex items-center justify-between text-sm">
                                                            <div className="text-slate-300">
                                                                <span className="font-semibold">{logsInView.length}</span> dias registrados neste per√≠odo
                                                            </div>
                                                            <div className={`font-bold ${consistency >= 70 ? 'text-green-400' : consistency >= 50 ? 'text-yellow-400' : 'text-red-400'}`}>
                                                                {consistency.toFixed(0)}% consist√™ncia
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })()}
                                            
                                            {/* Legenda */}
                                            <div className="flex flex-wrap gap-3 text-xs">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-green-600"></div>
                                                    <span className="text-slate-300">Excelente</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-green-400"></div>
                                                    <span className="text-slate-300">Bom</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-yellow-400"></div>
                                                    <span className="text-slate-300">OK</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-orange-400"></div>
                                                    <span className="text-slate-300">Manuten√ß√£o</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-red-600"></div>
                                                    <span className="text-slate-300">Ruim</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-blue-500"></div>
                                                    <span className="text-slate-300">Refeed</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-purple-600"></div>
                                                    <span className="text-slate-300">Jejum 24h</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-slate-700"></div>
                                                    <span className="text-slate-300">Sem registro</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-slate-800/50 border border-slate-600"></div>
                                                    <span className="text-slate-300">Futuro</span>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-4 h-4 rounded bg-purple-500 ring-2 ring-white ring-offset-2 ring-offset-slate-900"></div>
                                                    <span className="text-slate-300">Hoje</span>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Performance Alert Banner */}
                                {(() => {
                                    const alert = getPerformanceAlert();
                                    if (!alert) return null;
                                    
                                    // Se √© um alerta bom e foi dispensado, n√£o mostra
                                    if (alert.canDismiss && dismissedGoodAlert) return null;
                                    
                                    return (
                                        <div className={`${alert.color} rounded-2xl p-6 shadow-2xl border-4 ${alert.border} ${alert.canDismiss ? '' : ''} relative`}>
                                            {/* Bot√£o de fechar apenas para alertas bons */}
                                            {alert.canDismiss && (
                                                <button
                                                    onClick={() => setDismissedGoodAlert(true)}
                                                    className="absolute top-4 right-4 text-white/70 hover:text-white hover:bg-white/20 rounded-full p-2 transition-all"
                                                    title="Dispensar celebra√ß√£o"
                                                >
                                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                    </svg>
                                                </button>
                                            )}
                                            
                                            <div className="text-center">
                                                <h2 className="text-3xl font-black mb-2">{alert.title}</h2>
                                                <p className="text-lg font-semibold text-white/90 mb-4">{alert.message}</p>
                                                {(alert.type === 'critical' || alert.type === 'warning') && (
                                                    <a 
                                                        href="https://youtu.be/UEY35Dgx4Oo" 
                                                        target="_blank" 
                                                        rel="noopener noreferrer"
                                                        className="inline-flex items-center gap-2 bg-white/20 hover:bg-white/30 text-white font-bold py-3 px-6 rounded-lg transition-all"
                                                    >
                                                        <span>üé•</span>
                                                        <span>ASSISTA AGORA - Cole Robinson te motiva!</span>
                                                        <span>‚Üí</span>
                                                    </a>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Main Calories Display with Tabs */}
                                <div className="bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl shadow-2xl overflow-hidden">
                                    {/* Tabs Header */}
                                    <div className="flex border-b border-white/20">
                                        <button
                                            onClick={() => setDeficitViewMode('real')}
                                            className={`flex-1 py-4 px-6 font-semibold transition-all ${
                                                deficitViewMode === 'real' 
                                                    ? 'bg-white/20 text-white' 
                                                    : 'bg-transparent text-blue-100 hover:bg-white/10'
                                            }`}
                                        >
                                            üìä D√©ficit Real (BF%)
                                        </button>
                                        <button
                                            onClick={() => setDeficitViewMode('simulado')}
                                            className={`flex-1 py-4 px-6 font-semibold transition-all ${
                                                deficitViewMode === 'simulado' 
                                                    ? 'bg-white/20 text-white' 
                                                    : 'bg-transparent text-blue-100 hover:bg-white/10'
                                            }`}
                                        >
                                            üî• Contador Simulado
                                        </button>
                                    </div>

                                    {/* Tab Content */}
                                    <div className="p-8 text-center">
                                        {deficitViewMode === 'real' ? (
                                            // Aba Real - baseado no BF% atual
                                            <>
                                                <div className="flex items-center justify-center mb-4">
                                                    <Flame className="h-12 w-12 mr-3 text-orange-300" />
                                                    <h2 className="text-2xl font-bold">D√©ficit Cal√≥rico Real</h2>
                                                </div>
                                                <div className="text-7xl font-bold mb-2">
                                                    {Math.round(stats.deficit).toLocaleString()}
                                                </div>
                                                <div className="text-2xl text-blue-100">kcal restantes at√© {targetBodyFat}% gordura</div>
                                                <div className="mt-6 text-lg text-blue-100">
                                                    ~{stats.daysNeeded} dias para atingir a meta
                                                </div>
                                                <div className="text-xs text-blue-200 mt-3">
                                                    {caloriesStats.daysLogged > 0 
                                                        ? `Baseado na sua m√©dia de ${stats.avgDailyDeficit} kcal/dia de deficit` 
                                                        : 'Estimativa baseada em 500 kcal/dia de deficit'}
                                                </div>
                                                <div className="text-xs text-blue-100/70 mt-1">
                                                    Calculado com base no seu BF% atual da √∫ltima avalia√ß√£o f√≠sica
                                                </div>
                                            </>
                                        ) : (
                                            // Aba Simulado - baseado nos logs di√°rios
                                            <>
                                                <div className="flex items-center justify-center mb-4">
                                                    <Flame className="h-12 w-12 mr-3 text-orange-300" />
                                                    <h2 className="text-2xl font-bold">Contador Simulado</h2>
                                                </div>
                                                <div className="text-7xl font-bold mb-2">
                                                    {Math.round(simulatedDeficit.remaining).toLocaleString()}
                                                </div>
                                                <div className="text-2xl text-blue-100">kcal restantes (simulado)</div>
                                                <div className="mt-6 grid grid-cols-2 gap-4 text-center">
                                                    <div className="bg-white/10 rounded-lg p-4">
                                                        <div className="text-sm text-blue-200 mb-1">D√©ficit Inicial</div>
                                                        <div className="text-2xl font-bold">{Math.round(simulatedDeficit.initial).toLocaleString()}</div>
                                                    </div>
                                                    <div className="bg-white/10 rounded-lg p-4">
                                                        <div className="text-sm text-blue-200 mb-1">J√° Queimado</div>
                                                        <div className="text-2xl font-bold text-green-300">{Math.round(simulatedDeficit.accumulated).toLocaleString()}</div>
                                                    </div>
                                                </div>
                                                <div className="text-xs text-blue-200 mt-4">
                                                    Soma de todos os d√©ficits di√°rios dos seus {dailyLogs.length} registros
                                                </div>
                                                <div className="text-xs text-blue-100/70 mt-1">
                                                    Este √© um contador simulado que desconta cada dia registrado
                                                </div>
                                            </>
                                        )}
                                    </div>
                                </div>

                                {/* Stats Grid - Row 1 */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {/* Current BF% */}
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-slate-300">BF% Atual</h3>
                                            <TrendingDown className="h-6 w-6 text-blue-400" />
                                        </div>
                                        <div className="text-4xl font-bold text-blue-400">
                                            {safeFixed(stats.currentBF, 1)}%
                                        </div>
                                        <div className="text-sm text-slate-400 mt-2">Meta: {targetBodyFat}%</div>
                                        <div className="text-sm text-slate-400">Diferen√ßa: {safeFixed(stats.currentBF - targetBodyFat, 1)}%</div>
                                    </div>

                                    {/* Fat to Lose */}
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-slate-300">Gordura a Perder</h3>
                                            <Scale className="h-6 w-6 text-purple-400" />
                                        </div>
                                        <div className="text-4xl font-bold text-purple-400">
                                            {safeFixed(stats.fatToLose, 1)} kg
                                        </div>
                                        <div className="text-sm text-slate-400 mt-2">
                                            Peso atual: {evaluations.length > 0 ? evaluations[evaluations.length - 1].weight : 0} kg
                                        </div>
                                        <div className="text-sm text-slate-400">
                                            Peso alvo: {safeFixed(stats.targetWeight, 1)} kg
                                        </div>
                                    </div>

                                    {/* Total Skinfolds */}
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-slate-300">Soma das 7 Dobras</h3>
                                            <Ruler className="h-6 w-6 text-cyan-400" />
                                        </div>
                                        <div className="text-4xl font-bold text-cyan-400">
                                            {stats.totalSkinfolds} mm
                                        </div>
                                        <div className="text-sm text-slate-400 mt-2">Medidas atuais</div>
                                        <div className="text-sm text-slate-400">7 pontos somados</div>
                                    </div>
                                </div>

                                {/* Progresso Alcan√ßado - Mostra apenas se houver m√∫ltiplas avalia√ß√µes */}
                                {evaluations.length > 1 && stats.deficitAccomplished > 0 && (
                                    <div className="bg-gradient-to-br from-green-600 to-emerald-600 rounded-2xl p-6 shadow-2xl">
                                        <div className="flex items-center justify-center mb-4">
                                            <TrendingDown className="h-10 w-10 mr-3 text-green-200" />
                                            <h2 className="text-xl font-bold">D√©ficit J√° Alcan√ßado</h2>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-5xl font-bold mb-2">
                                                {Math.round(stats.deficitAccomplished).toLocaleString()}
                                            </div>
                                            <div className="text-lg text-green-100">kcal queimados desde o in√≠cio</div>
                                            <div className="mt-4 text-sm text-green-100/80">
                                                {safeFixed((evaluations[0].weight - evaluations[evaluations.length - 1].weight), 1)} kg perdidos √ó 7.700 kcal/kg
                                            </div>
                                            <div className="mt-2 text-xs text-green-100/70">
                                                Progresso: {Math.round((stats.deficitAccomplished / (stats.deficit + stats.deficitAccomplished)) * 100)}% da jornada completa
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Stats Grid - Row 2 */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {/* Weekly Deficit */}
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-slate-300">Deficit √öltimos 7 Dias</h3>
                                            <Flame className="h-6 w-6 text-orange-400" />
                                        </div>
                                        <div className="text-4xl font-bold text-orange-400">
                                            {Math.round(caloriesStats.actualDeficit).toLocaleString()} kcal
                                        </div>
                                        <div className="text-sm text-slate-400 mt-2">
                                            {caloriesStats.daysLogged} dias registrados
                                        </div>
                                        <div className="text-sm text-slate-400">
                                            M√©dia: {caloriesStats.daysLogged > 0 ? Math.round(caloriesStats.actualDeficit / caloriesStats.daysLogged) : 0} kcal/dia
                                        </div>
                                    </div>

                                    {/* Progress Percentage */}
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-slate-300">Progresso Semanal</h3>
                                            <Award className="h-6 w-6 text-yellow-400" />
                                        </div>
                                        <div className="text-4xl font-bold text-yellow-400">
                                            {caloriesStats.daysLogged > 0 ? 
                                                ((caloriesStats.actualDeficit / (500 * 7)) * 100).toFixed(0) : 0}%
                                        </div>
                                        <div className="text-sm text-slate-400 mt-2">
                                            Do deficit ideal de 3.500 kcal/semana
                                        </div>
                                        <div className="text-sm text-slate-400">
                                            Basal: {basalCalories} kcal/dia
                                        </div>
                                    </div>

                                    {/* Fasting Days */}
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="text-lg font-semibold text-slate-300">Dias de Jejum</h3>
                                            <Flame className="h-6 w-6 text-indigo-400" />
                                        </div>
                                        <div className="text-4xl font-bold text-indigo-400">
                                            {caloriesStats.fastingDays}
                                        </div>
                                        <div className="text-sm text-slate-400 mt-2">
                                            Total de jejuns de 24h
                                        </div>
                                        <div className="text-sm text-slate-400">
                                            Disciplina m√°xima! üî•
                                        </div>
                                    </div>

                                    {/* Lean Mass */}
                                    {evaluations.length > 0 && (() => {
                                        const latestEval = evaluations[evaluations.length - 1];
                                        const latestBF = calculateBodyFat(latestEval);
                                        const leanMass = latestEval.weight * (1 - latestBF / 100);
                                        
                                        return (
                                            <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="text-lg font-semibold text-slate-300">Massa Magra</h3>
                                                    <Activity className="h-6 w-6 text-purple-400" />
                                                </div>
                                                <div className="text-4xl font-bold text-purple-400">
                                                    {safeFixed(leanMass, 2)} kg
                                                </div>
                                                <div className="text-sm text-slate-400 mt-2">
                                                    {safeFixed((leanMass / latestEval.weight) * 100, 1)}% do peso total
                                                </div>
                                                <div className="text-sm text-slate-400">
                                                    Base para c√°lculo de prote√≠na
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>

                                {/* Latest Evaluation */}
                                {evaluations.length > 0 && (
                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                        <h3 className="text-xl font-bold mb-4 flex items-center">
                                            <Award className="mr-2 h-6 w-6 text-yellow-400" />
                                            √öltima Avalia√ß√£o
                                        </h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div>
                                                <div className="text-sm text-slate-400">Data</div>
                                                <div className="text-lg font-semibold">
                                                    {new Date(evaluations[evaluations.length - 1].date).toLocaleDateString('pt-BR')}
                                                </div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-slate-400">Peso</div>
                                                <div className="text-lg font-semibold">
                                                    {evaluations[evaluations.length - 1].weight} kg
                                                </div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-slate-400">Soma Dobras</div>
                                                <div className="text-lg font-semibold">
                                                    {stats.totalSkinfolds} mm
                                                </div>
                                            </div>
                                            <div>
                                                <div className="text-sm text-slate-400">BF%</div>
                                                <div className="text-lg font-semibold text-blue-400">
                                                    {safeFixed(stats.currentBF, 1)}%
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Protein Requirements */}
                                {evaluations.length > 0 && (() => {
                                    const latestEval = evaluations[evaluations.length - 1];
                                    const latestBF = calculateBodyFat(latestEval);
                                    const leanMass = latestEval.weight * (1 - latestBF / 100);
                                    const protein = calculateProteinNeeds(leanMass);
                                    
                                    return (
                                        <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-4 flex items-center">
                                                <Beef className="mr-2 h-7 w-7 text-orange-400" />
                                                Necessidade de Prote√≠na Di√°ria
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div className="bg-red-600/20 rounded-lg p-4 border border-red-500/30">
                                                    <div className="text-sm text-red-300 mb-2 font-semibold">M√çNIMO (1.6g/kg massa magra)</div>
                                                    <div className="text-4xl font-bold text-red-400">{protein.minimum}g</div>
                                                    <div className="text-xs text-red-300/70 mt-2">Para evitar perda muscular</div>
                                                </div>
                                                <div className="bg-green-600/20 rounded-lg p-4 border border-green-500/30">
                                                    <div className="text-sm text-green-300 mb-2 font-semibold">IDEAL (2g/kg massa magra)</div>
                                                    <div className="text-4xl font-bold text-green-400">{protein.ideal}g</div>
                                                    <div className="text-xs text-green-300/70 mt-2">Para m√°xima preserva√ß√£o/ganho</div>
                                                </div>
                                            </div>
                                            <div className="mt-4 p-3 bg-yellow-600/20 rounded-lg border border-yellow-500/30">
                                                <p className="text-sm text-yellow-300">
                                                    üí™ <strong>Dica:</strong> Baseado em {safeFixed(leanMass, 1)} kg de massa magra. Mantenha a prote√≠na alta para preservar m√∫sculo!
                                                </p>
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Muscle Mass Tracking */}
                                {evaluations.length > 1 && (() => {
                                    const muscleData = calculateMuscleMassChange();
                                    const changeColor = muscleData.change > 0 ? 'text-green-400' : muscleData.change < 0 ? 'text-red-400' : 'text-yellow-400';
                                    const changeIcon = muscleData.change > 0 ? 'üìà' : muscleData.change < 0 ? 'üìâ' : '‚û°Ô∏è';
                                    
                                    return (
                                        <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-4 flex items-center">
                                                <TrendingUp className="mr-2 h-6 w-6 text-purple-400" />
                                                Mudan√ßa de Composi√ß√£o Corporal
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                                <div className="bg-purple-600/20 rounded-lg p-4 border border-purple-500/30">
                                                    <div className="text-sm text-purple-300 mb-2">Massa Muscular</div>
                                                    <div className={`text-3xl font-bold ${changeColor}`}>
                                                        {changeIcon} {muscleData.change > 0 ? '+' : ''}{safeFixed(muscleData.change, 2)} kg
                                                    </div>
                                                    {(() => {
                                                        const first = muscleData.history[0];
                                                        const latest = muscleData.history[muscleData.history.length - 1];
                                                        const weightChange = latest.weight - first.weight;
                                                        const leanChange = latest.leanMass - first.leanMass;
                                                        
                                                        // % de massa muscular em rela√ß√£o ao peso total mudado
                                                        const muscleLossPercent = weightChange !== 0 ? (leanChange / weightChange) * 100 : 0;
                                                        
                                                        let status, statusColor, icon;
                                                        
                                                        if (weightChange < 0) { // Cutting
                                                            if (muscleLossPercent > 50) {
                                                                status = 'EXCESSIVA';
                                                                statusColor = 'text-red-500';
                                                                icon = 'üö®';
                                                            } else if (muscleLossPercent > 30) {
                                                                status = 'MUITA';
                                                                statusColor = 'text-orange-500';
                                                                icon = '‚ö†Ô∏è';
                                                            } else if (muscleLossPercent > 15) {
                                                                status = 'Moderada';
                                                                statusColor = 'text-yellow-500';
                                                                icon = '‚ö°';
                                                            } else if (muscleLossPercent >= 0) {
                                                                status = 'Aceit√°vel';
                                                                statusColor = 'text-green-500';
                                                                icon = '‚úÖ';
                                                            } else {
                                                                status = 'Ganhando!';
                                                                statusColor = 'text-cyan-400';
                                                                icon = 'üí™';
                                                            }
                                                        } else if (weightChange > 0) { // Bulking
                                                            if (muscleLossPercent < 0) {
                                                                status = 'Perdendo';
                                                                statusColor = 'text-red-500';
                                                                icon = 'üìâ';
                                                            } else if (muscleLossPercent < 30) {
                                                                status = 'Pouco';
                                                                statusColor = 'text-orange-400';
                                                                icon = '‚ö†Ô∏è';
                                                            } else if (muscleLossPercent < 50) {
                                                                status = 'Razo√°vel';
                                                                statusColor = 'text-yellow-400';
                                                                icon = 'üìä';
                                                            } else {
                                                                status = 'Excelente';
                                                                statusColor = 'text-green-400';
                                                                icon = 'üî•';
                                                            }
                                                        } else {
                                                            status = muscleData.trend === 'gaining' ? 'Ganhando' : muscleData.trend === 'losing' ? 'Perdendo' : 'Mantendo';
                                                            statusColor = muscleData.trend === 'gaining' ? 'text-green-400' : muscleData.trend === 'losing' ? 'text-orange-400' : 'text-slate-400';
                                                            icon = muscleData.trend === 'gaining' ? '‚úÖ' : muscleData.trend === 'losing' ? '‚ö†Ô∏è' : '‚û°Ô∏è';
                                                        }
                                                        
                                                        return (
                                                            <div className="text-xs mt-2 space-y-1">
                                                                {weightChange !== 0 && (
                                                                    <div className={`font-bold ${statusColor}`}>
                                                                        {icon} {Math.abs(muscleLossPercent).toFixed(1)}% {status}
                                                                    </div>
                                                                )}
                                                                <div className="text-slate-400">
                                                                    {weightChange < 0 ? 'Perda de massa magra' : weightChange > 0 ? 'Ganho de massa magra' : 'Manuten√ß√£o'}
                                                                </div>
                                                            </div>
                                                        );
                                                    })()}
                                                </div>
                                                <div className="bg-blue-600/20 rounded-lg p-4 border border-blue-500/30">
                                                    <div className="text-sm text-blue-300 mb-2">Gordura Perdida</div>
                                                    <div className="text-3xl font-bold text-blue-400">
                                                        {(() => {
                                                            const first = muscleData.history[0];
                                                            const latest = muscleData.history[muscleData.history.length - 1];
                                                            const fatLost = first.fatMass - latest.fatMass;
                                                            return `üìâ ${fatLost > 0 ? '-' : ''}${safeFixed(Math.abs(fatLost), 2)} kg`;
                                                        })()}
                                                    </div>
                                                    <div className="text-xs text-slate-400 mt-2">
                                                        {muscleData.history[0].fatMass > muscleData.history[muscleData.history.length - 1].fatMass ? 
                                                            'üî• Queimando gordura!' : '‚ö†Ô∏è Foco no deficit!'}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Charts */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {/* Muscle Mass Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                                                        <Activity className="mr-2 h-4 w-4 text-purple-400" />
                                                        Evolu√ß√£o Massa Muscular
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {muscleData.history.map((point, idx) => {
                                                            const maxMuscle = Math.max(...muscleData.history.map(p => p.leanMass));
                                                            const width = (point.leanMass / maxMuscle) * 100;
                                                            return (
                                                                <div key={idx} className="flex items-center gap-2">
                                                                    <div className="text-xs text-slate-400 w-20">
                                                                        {new Date(point.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                    </div>
                                                                    <div className="flex-1 bg-slate-600/30 rounded-full h-6 overflow-hidden">
                                                                        <div 
                                                                            className="bg-gradient-to-r from-purple-500 to-pink-500 h-full rounded-full flex items-center justify-end pr-2"
                                                                            style={{ width: `${width}%` }}
                                                                        >
                                                                            <span className="text-xs font-bold text-white">{safeFixed(point.leanMass, 1)}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>

                                                {/* Fat Mass Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                                                        <Activity className="mr-2 h-4 w-4 text-blue-400" />
                                                        Evolu√ß√£o Gordura Corporal
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {muscleData.history.map((point, idx) => {
                                                            const maxFat = Math.max(...muscleData.history.map(p => p.fatMass));
                                                            const width = (point.fatMass / maxFat) * 100;
                                                            return (
                                                                <div key={idx} className="flex items-center gap-2">
                                                                    <div className="text-xs text-slate-400 w-20">
                                                                        {new Date(point.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                    </div>
                                                                    <div className="flex-1 bg-slate-600/30 rounded-full h-6 overflow-hidden">
                                                                        <div 
                                                                            className="bg-gradient-to-r from-blue-500 to-cyan-500 h-full rounded-full flex items-center justify-end pr-2"
                                                                            style={{ width: `${width}%` }}
                                                                        >
                                                                            <span className="text-xs font-bold text-white">{safeFixed(point.fatMass, 1)}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* AI-Powered Insights - FEATURE CRIATIVA */}
                                {dailyLogs.length >= 3 && evaluations.length >= 1 && (() => {
                                    // An√°lise inteligente de padr√µes
                                    const analyzePatterns = () => {
                                        const insights = [];
                                        
                                        // 1. PREVIS√ÉO DE META
                                        const last7Days = dailyLogs.slice(-7);
                                        const avgDeficit = last7Days.reduce((acc, log) => {
                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            const deficit = (basalCalories + exerciseTotal) - log.calories;
                                            return acc + deficit;
                                        }, 0) / last7Days.length;
                                        
                                        const daysToGoal = Math.ceil(stats.deficit / avgDeficit);
                                        const goalDate = new Date();
                                        goalDate.setDate(goalDate.getDate() + daysToGoal);
                                        
                                        if (avgDeficit > 0) {
                                            insights.push({
                                                icon: 'üéØ',
                                                type: 'prediction',
                                                title: 'Previs√£o de Meta',
                                                message: `Se manter esse ritmo (${Math.round(avgDeficit)} kcal/dia), voc√™ atinge ${targetBodyFat}% gordura em ${goalDate.toLocaleDateString('pt-BR')}`,
                                                color: 'bg-green-600/20 border-green-500/30',
                                                textColor: 'text-green-300'
                                            });
                                        }
                                        
                                        // 2. DETEC√á√ÉO DE PADR√ïES DE DIA DA SEMANA
                                        const dayStats = {};
                                        dailyLogs.forEach(log => {
                                            const dayOfWeek = new Date(log.date).getDay();
                                            if (!dayStats[dayOfWeek]) dayStats[dayOfWeek] = { deficits: [], count: 0 };
                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            const deficit = (basalCalories + exerciseTotal) - log.calories;
                                            dayStats[dayOfWeek].deficits.push(deficit);
                                            dayStats[dayOfWeek].count++;
                                        });
                                        
                                        let worstDay = -1;
                                        let worstAvg = Infinity;
                                        const dayNames = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
                                        
                                        Object.entries(dayStats).forEach(([day, data]) => {
                                            if (data.count >= 2) {
                                                const avg = data.deficits.reduce((a, b) => a + b, 0) / data.count;
                                                if (avg < worstAvg) {
                                                    worstAvg = avg;
                                                    worstDay = parseInt(day);
                                                }
                                            }
                                        });
                                        
                                        if (worstDay !== -1 && worstAvg < 200) {
                                            insights.push({
                                                icon: 'üìä',
                                                type: 'pattern',
                                                title: 'Padr√£o Detectado',
                                                message: `${dayNames[worstDay]} √© seu dia mais dif√≠cil (m√©dia de ${worstAvg >= 0 ? '+' : ''}${Math.round(worstAvg)} kcal). Planeje refei√ß√µes estrat√©gicas!`,
                                                color: 'bg-yellow-600/20 border-yellow-500/30',
                                                textColor: 'text-yellow-300'
                                            });
                                        }
                                        
                                        // 3. AN√ÅLISE DE CONSIST√äNCIA
                                        const last30Days = dailyLogs.slice(-30);
                                        const goodDays = last30Days.filter(log => {
                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            const deficit = (basalCalories + exerciseTotal) - log.calories;
                                            return log.isFasting || deficit >= 300;
                                        }).length;
                                        
                                        const consistency = (goodDays / last30Days.length) * 100;
                                        
                                        if (consistency >= 80) {
                                            insights.push({
                                                icon: 'üî•',
                                                type: 'achievement',
                                                title: 'Consist√™ncia Elite',
                                                message: `${consistency.toFixed(0)}% de dias excelentes nos √∫ltimos ${last30Days.length} dias! Voc√™ √© impar√°vel!`,
                                                color: 'bg-purple-600/20 border-purple-500/30',
                                                textColor: 'text-purple-300'
                                            });
                                        } else if (consistency < 50) {
                                            insights.push({
                                                icon: '‚ö†Ô∏è',
                                                type: 'warning',
                                                title: 'Aten√ß√£o √† Consist√™ncia',
                                                message: `Apenas ${consistency.toFixed(0)}% de dias bons. Pequenas vit√≥rias di√°rias = grandes resultados!`,
                                                color: 'bg-red-600/20 border-red-500/30',
                                                textColor: 'text-red-300'
                                            });
                                        }
                                        
                                        // 4. CORRELA√á√ÉO EXERC√çCIO vs DEFICIT
                                        const logsWithExercise = dailyLogs.filter(log => {
                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            return exerciseTotal > 0;
                                        });
                                        
                                        if (logsWithExercise.length >= 3) {
                                            const avgDeficitWithExercise = logsWithExercise.reduce((acc, log) => {
                                                const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                const deficit = (basalCalories + exerciseTotal) - log.calories;
                                                return acc + deficit;
                                            }, 0) / logsWithExercise.length;
                                            
                                            const logsWithoutExercise = dailyLogs.filter(log => {
                                                const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                return exerciseTotal === 0;
                                            });
                                            
                                            if (logsWithoutExercise.length >= 3) {
                                                const avgDeficitWithoutExercise = logsWithoutExercise.reduce((acc, log) => {
                                                    const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                    const deficit = (basalCalories + exerciseTotal) - log.calories;
                                                    return acc + deficit;
                                                }, 0) / logsWithoutExercise.length;
                                                
                                                if (avgDeficitWithExercise > avgDeficitWithoutExercise + 100) {
                                                    insights.push({
                                                        icon: 'üí™',
                                                        type: 'insight',
                                                        title: 'Exerc√≠cio = Sucesso',
                                                        message: `Seu deficit √© ${Math.round(avgDeficitWithExercise - avgDeficitWithoutExercise)} kcal maior nos dias de treino. Continue!`,
                                                        color: 'bg-blue-600/20 border-blue-500/30',
                                                        textColor: 'text-blue-300'
                                                    });
                                                }
                                            }
                                        }
                                        
                                        // 5. WELLNESS INSIGHTS (se tiver dados)
                                        const logsWithWellness = dailyLogs.filter(log => log.hungerLevel || log.energyLevel);
                                        if (logsWithWellness.length >= 5) {
                                            const avgHunger = logsWithWellness.reduce((a, l) => a + (l.hungerLevel || 5), 0) / logsWithWellness.length;
                                            const avgEnergy = logsWithWellness.reduce((a, l) => a + (l.energyLevel || 5), 0) / logsWithWellness.length;
                                            
                                            if (avgHunger > 7 && avgEnergy < 4) {
                                                insights.push({
                                                    icon: 'üß†',
                                                    type: 'wellness',
                                                    title: 'Sinal de Overreaching',
                                                    message: `Fome alta (${avgHunger.toFixed(1)}/10) + energia baixa (${avgEnergy.toFixed(1)}/10). Considere um refeed ou reduzir o deficit temporariamente.`,
                                                    color: 'bg-orange-600/20 border-orange-500/30',
                                                    textColor: 'text-orange-300'
                                                });
                                            } else if (avgEnergy >= 7) {
                                                insights.push({
                                                    icon: '‚ö°',
                                                    type: 'wellness',
                                                    title: 'Energia Excelente',
                                                    message: `M√©dia de ${avgEnergy.toFixed(1)}/10 de energia! Seu corpo est√° respondendo bem ao protocolo.`,
                                                    color: 'bg-cyan-600/20 border-cyan-500/30',
                                                    textColor: 'text-cyan-300'
                                                });
                                            }
                                        }
                                        
                                        // 6. VELOCIDADE DE PROGRESSO (se tiver m√∫ltiplas avalia√ß√µes)
                                        if (evaluations.length >= 2) {
                                            const firstEval = evaluations[0];
                                            const latestEval = evaluations[evaluations.length - 1];
                                            const firstBF = calculateBodyFat(firstEval);
                                            const latestBF = calculateBodyFat(latestEval);
                                            const bfLost = firstBF - latestBF;
                                            
                                            const daysBetween = Math.ceil((new Date(latestEval.date) - new Date(firstEval.date)) / (1000 * 60 * 60 * 24));
                                            
                                            if (daysBetween > 0 && bfLost > 0) {
                                                const bfPerWeek = (bfLost / daysBetween) * 7;
                                                insights.push({
                                                    icon: 'üìà',
                                                    type: 'progress',
                                                    title: 'Velocidade de Progresso',
                                                    message: `Voc√™ est√° perdendo ${bfPerWeek.toFixed(2)}% gordura por semana. ${bfPerWeek > 0.5 ? 'Ritmo excelente!' : bfPerWeek > 0.2 ? 'Progresso saud√°vel!' : 'Considere aumentar o deficit.'}`,
                                                    color: 'bg-teal-600/20 border-teal-500/30',
                                                    textColor: 'text-teal-300'
                                                });
                                            }
                                        }
                                        
                                        return insights;
                                    };
                                    
                                    const insights = analyzePatterns();
                                    
                                    if (insights.length === 0) return null;
                                    
                                    return (
                                        <div className="bg-gradient-to-br from-indigo-900/50 to-purple-900/50 rounded-2xl p-6 shadow-2xl border-2 border-indigo-500/50">
                                            <div className="flex items-center gap-3 mb-6">
                                                <div className="text-4xl">üß†</div>
                                                <div>
                                                    <h2 className="text-2xl font-bold bg-gradient-to-r from-indigo-300 to-purple-300 bg-clip-text text-transparent">
                                                        An√°lise Inteligente
                                                    </h2>
                                                    <p className="text-sm text-indigo-300">IA detectou padr√µes nos seus dados</p>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {insights.map((insight, idx) => (
                                                    <div 
                                                        key={idx}
                                                        className={`${insight.color} rounded-xl p-4 border-2 transition-all hover:scale-[1.02]`}
                                                    >
                                                        <div className="flex items-start gap-3">
                                                            <div className="text-3xl">{insight.icon}</div>
                                                            <div className="flex-1">
                                                                <h3 className={`font-bold mb-1 ${insight.textColor}`}>
                                                                    {insight.title}
                                                                </h3>
                                                                <p className="text-sm text-slate-200">
                                                                    {insight.message}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            
                                            <div className="mt-4 p-3 bg-indigo-950/50 rounded-lg border border-indigo-700/30">
                                                <p className="text-xs text-indigo-300">
                                                    üí° Esses insights s√£o gerados automaticamente baseados em machine learning simples aplicado aos seus dados. Quanto mais voc√™ registrar, mais preciso fica!
                                                </p>
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Monthly Report - An√°lise Avan√ßada de Padr√µes */}
                                {dailyLogs.length >= 10 && (() => {
                                    const analyzeMonthlyPatterns = () => {
                                        const issues = [];
                                        const last30Days = dailyLogs.slice(-30);
                                        
                                        // AN√ÅLISE 1: YO-YO FASTING (altern√¢ncia radical entre jejum e excesso)
                                        let fastingDays = 0;
                                        let bingeDays = 0;
                                        let previousWasFasting = false;
                                        let yoyoCount = 0;
                                        
                                        last30Days.forEach((log, idx) => {
                                            if (log.isFasting) {
                                                fastingDays++;
                                                if (idx > 0 && !previousWasFasting) {
                                                    const prevLog = last30Days[idx - 1];
                                                    const prevExercise = (prevLog.exerciseCalories?.strength || 0) + (prevLog.exerciseCalories?.cardio || 0);
                                                    const prevDeficit = (basalCalories + prevExercise) - prevLog.calories;
                                                    if (prevDeficit < -300) { // dia anterior foi excesso
                                                        yoyoCount++;
                                                    }
                                                }
                                                previousWasFasting = true;
                                            } else {
                                                const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                const deficit = (basalCalories + exerciseTotal) - log.calories;
                                                if (deficit < -300) {
                                                    bingeDays++;
                                                    if (previousWasFasting) {
                                                        yoyoCount++;
                                                    }
                                                }
                                                previousWasFasting = false;
                                            }
                                        });
                                        
                                        if (yoyoCount >= 3 && fastingDays >= 5) {
                                            issues.push({
                                                icon: 'üé≠',
                                                severity: 'critical',
                                                title: 'YO-YO FASTING DETECTADO',
                                                problem: `Voc√™ est√° alternando entre jejum extremo (${fastingDays} dias) e excessos (${bingeDays} dias). Isso desregula horm√¥nios e metabolismo.`,
                                                solution: 'Pare o ciclo vicioso: Fa√ßa 5-7 dias de deficit moderado (400-600 kcal) SEM jejum. Depois introduza jejuns de forma gradual (16h ‚Üí 20h ‚Üí 24h).',
                                                color: 'bg-red-900/40 border-red-500',
                                                icon2: '‚ö†Ô∏è'
                                            });
                                        }
                                        
                                        // AN√ÅLISE 2: YO-YO DIETING (oscila√ß√µes constantes no deficit)
                                        const deficitVariance = [];
                                        last30Days.forEach(log => {
                                            if (!log.isFasting) {
                                                const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                const deficit = (basalCalories + exerciseTotal) - log.calories;
                                                deficitVariance.push(deficit);
                                            }
                                        });
                                        
                                        if (deficitVariance.length >= 10) {
                                            const avgDeficit = deficitVariance.reduce((a, b) => a + b, 0) / deficitVariance.length;
                                            const variance = deficitVariance.reduce((acc, val) => acc + Math.pow(val - avgDeficit, 2), 0) / deficitVariance.length;
                                            const stdDev = Math.sqrt(variance);
                                            
                                            // Alta varia√ß√£o = inconsist√™ncia
                                            if (stdDev > 400 && avgDeficit < 300) {
                                                issues.push({
                                                    icon: 'üìä',
                                                    severity: 'warning',
                                                    title: 'INCONSIST√äNCIA EXTREMA',
                                                    problem: `Seus deficits variam MUITO (desvio padr√£o: ${stdDev.toFixed(0)} kcal). Alguns dias 800 kcal deficit, outros 500 kcal super√°vit. Corpo n√£o sabe o que esperar.`,
                                                    solution: 'Estabele√ßa um TARGET fixo: 500 kcal deficit TODOS os dias por 14 dias. Permite 1 refeed estrat√©gico no dia 8. Consist√™ncia > Perfei√ß√£o.',
                                                    color: 'bg-orange-900/40 border-orange-500',
                                                    icon2: 'üéØ'
                                                });
                                            }
                                        }
                                        
                                        // AN√ÅLISE 3: WEEKEND WARRIOR (destr√≥i progresso nos fins de semana)
                                        const weekendStats = { bad: 0, total: 0 };
                                        const weekdayStats = { bad: 0, total: 0 };
                                        
                                        last30Days.forEach(log => {
                                            const dayOfWeek = new Date(log.date).getDay();
                                            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            const deficit = (basalCalories + exerciseTotal) - log.calories;
                                            
                                            if (isWeekend) {
                                                weekendStats.total++;
                                                if (deficit < -200) weekendStats.bad++;
                                            } else {
                                                weekdayStats.total++;
                                                if (deficit < -200) weekdayStats.bad++;
                                            }
                                        });
                                        
                                        const weekendFailRate = weekendStats.total > 0 ? (weekendStats.bad / weekendStats.total) : 0;
                                        const weekdayFailRate = weekdayStats.total > 0 ? (weekdayStats.bad / weekdayStats.total) : 0;
                                        
                                        if (weekendFailRate > 0.6 && weekdayFailRate < 0.3 && weekendStats.total >= 4) {
                                            issues.push({
                                                icon: 'üìÖ',
                                                severity: 'warning',
                                                title: 'S√çNDROME DO FIM DE SEMANA',
                                                problem: `Voc√™ √© bom durante a semana mas ${(weekendFailRate * 100).toFixed(0)}% dos fins de semana destroem seu progresso. 2 dias ruins anulam 5 dias bons.`,
                                                solution: 'S√°bado: Planeje refei√ß√µes ANTES do dia come√ßar. Domingo: Jejum de 24h (Snake Juice apenas). Ou fa√ßa refeeds estrat√©gicos ao inv√©s de "dia livre".',
                                                color: 'bg-yellow-900/40 border-yellow-500',
                                                icon2: 'üõ°Ô∏è'
                                            });
                                        }
                                        
                                        // AN√ÅLISE 4: FALTA DE EXERC√çCIO = FALTA DE MARGEM
                                        const logsWithExercise = last30Days.filter(log => {
                                            const total = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            return total >= 200;
                                        });
                                        
                                        const exerciseRate = logsWithExercise.length / last30Days.length;
                                        
                                        if (exerciseRate < 0.3 && bingeDays > 5) {
                                            issues.push({
                                                icon: 'üí™',
                                                severity: 'info',
                                                title: 'EXERC√çCIO = MARGEM DE ERRO',
                                                problem: `Apenas ${(exerciseRate * 100).toFixed(0)}% dos dias t√™m exerc√≠cio. Sem treino/cardio, voc√™ n√£o tem "margem de seguran√ßa" para erros alimentares.`,
                                                solution: '30min de caminhada = 200 kcal queimadas = 1 fatia de pizza a mais que voc√™ pode comer. Exerc√≠cio n√£o √© opcional, √© SEGURO alimentar.',
                                                color: 'bg-blue-900/40 border-blue-500',
                                                icon2: 'üèÉ'
                                            });
                                        }
                                        
                                        // AN√ÅLISE 5: DEFICIT MUITO PEQUENO (progresso lento demais)
                                        const avgDeficit = deficitVariance.length > 0 ? 
                                            deficitVariance.reduce((a, b) => a + b, 0) / deficitVariance.length : 0;
                                        
                                        if (avgDeficit > 0 && avgDeficit < 200 && bingeDays < 3) {
                                            issues.push({
                                                icon: 'üêå',
                                                severity: 'info',
                                                title: 'DEFICIT MUITO CONSERVADOR',
                                                problem: `M√©dia de apenas ${avgDeficit.toFixed(0)} kcal/dia de deficit. Nesse ritmo, levar√° MESES para resultados vis√≠veis.`,
                                                solution: 'Aumente para 500 kcal/dia (Snake Diet recomenda mais agressivo). Se tiver medo de perder m√∫sculo, aumente prote√≠na para 2g/kg massa magra.',
                                                color: 'bg-indigo-900/40 border-indigo-500',
                                                icon2: '‚ö°'
                                            });
                                        }
                                        
                                        // AN√ÅLISE 6: REFEEDS EXCESSIVOS (desculpa para exagerar)
                                        const refeedDays = last30Days.filter(log => log.isRefeed).length;
                                        
                                        if (refeedDays > 4) {
                                            issues.push({
                                                icon: 'üçï',
                                                severity: 'warning',
                                                title: 'ABUSO DE REFEEDS',
                                                problem: `${refeedDays} refeeds em 30 dias √© DEMAIS. Refeed √© estrat√©gico (a cada 12-14 dias), n√£o uma desculpa para comer.`,
                                                solution: 'Regra: 1 refeed a cada 10-14 dias de deficit REAL. E refeed = basal + 300 kcal, N√ÉO uma festa gastron√¥mica.',
                                                color: 'bg-pink-900/40 border-pink-500',
                                                icon2: '‚öñÔ∏è'
                                            });
                                        }
                                        
                                        // AN√ÅLISE 7: PROGRESSO BOM (feedback positivo!)
                                        const goodDays = last30Days.filter(log => {
                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                            const deficit = (basalCalories + exerciseTotal) - log.calories;
                                            return log.isFasting || deficit >= 300;
                                        }).length;
                                        
                                        const consistency = (goodDays / last30Days.length) * 100;
                                        
                                        if (consistency >= 70 && issues.length === 0) {
                                            issues.push({
                                                icon: 'üèÜ',
                                                severity: 'success',
                                                title: 'EXECU√á√ÉO EXEMPLAR',
                                                problem: `${consistency.toFixed(0)}% de dias excelentes/bons. Voc√™ est√° na zona ideal. Continue assim!`,
                                                solution: 'Mantenha o ritmo. Ajuste apenas se estagnar por 2+ semanas. Tire fotos semanais para rastrear mudan√ßas visuais que a balan√ßa n√£o mostra.',
                                                color: 'bg-green-900/40 border-green-500',
                                                icon2: '‚ú®'
                                            });
                                        }
                                        
                                        return issues;
                                    };
                                    
                                    const monthlyIssues = analyzeMonthlyPatterns();
                                    
                                    if (monthlyIssues.length === 0) return null;
                                    
                                    const getSeverityColor = (severity) => {
                                        switch(severity) {
                                            case 'critical': return 'border-l-red-500';
                                            case 'warning': return 'border-l-orange-500';
                                            case 'success': return 'border-l-green-500';
                                            default: return 'border-l-blue-500';
                                        }
                                    };
                                    
                                    return (
                                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 shadow-2xl border-2 border-slate-600">
                                            <div className="flex items-center gap-3 mb-6">
                                                <div className="text-4xl">üìã</div>
                                                <div>
                                                    <h2 className="text-2xl font-bold text-white">
                                                        Relat√≥rio Mensal Avan√ßado
                                                    </h2>
                                                    <p className="text-sm text-slate-400">Detec√ß√£o autom√°tica de padr√µes problem√°ticos</p>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-4">
                                                {monthlyIssues.map((issue, idx) => (
                                                    <div 
                                                        key={idx}
                                                        className={`${issue.color} rounded-xl p-5 border-l-4 ${getSeverityColor(issue.severity)}`}
                                                    >
                                                        <div className="flex items-start gap-4">
                                                            <div className="text-4xl flex-shrink-0">{issue.icon}</div>
                                                            <div className="flex-1">
                                                                <h3 className="text-xl font-bold text-white mb-2 flex items-center gap-2">
                                                                    {issue.title}
                                                                    {issue.severity === 'critical' && <span className="text-red-400">{issue.icon2}</span>}
                                                                    {issue.severity === 'warning' && <span className="text-orange-400">{issue.icon2}</span>}
                                                                    {issue.severity === 'success' && <span className="text-green-400">{issue.icon2}</span>}
                                                                </h3>
                                                                
                                                                <div className="bg-black/30 rounded-lg p-3 mb-3 border border-white/10">
                                                                    <p className="text-sm font-semibold text-red-300 mb-1">‚ùå PROBLEMA:</p>
                                                                    <p className="text-sm text-slate-200">{issue.problem}</p>
                                                                </div>
                                                                
                                                                <div className="bg-black/30 rounded-lg p-3 border border-white/10">
                                                                    <p className="text-sm font-semibold text-green-300 mb-1">‚úÖ SOLU√á√ÉO:</p>
                                                                    <p className="text-sm text-slate-200">{issue.solution}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            
                                            <div className="mt-6 p-4 bg-slate-950/50 rounded-lg border border-slate-700">
                                                <p className="text-xs text-slate-400">
                                                    üí° <strong>Sobre este relat√≥rio:</strong> Analisamos os √∫ltimos {Math.min(dailyLogs.length, 30)} dias usando 
                                                    algoritmos de detec√ß√£o de padr√µes. Quanto mais dados, mais preciso fica. S√≥ aparecem problemas REAIS detectados 
                                                    nos seus registros.
                                                </p>
                                            </div>
                                        </div>
                                    );
                                })()}


                            </div>
                        )}

                        {/* Evaluations Tab */}
                        {activeTab === 'evaluations' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">Avalia√ß√µes F√≠sicas</h2>
                                    <button
                                        onClick={() => setShowAddEval(true)}
                                        className="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-all"
                                    >
                                        <Plus className="h-5 w-5" />
                                        Nova Avalia√ß√£o
                                    </button>
                                </div>

                                {/* Add Evaluation Form */}
                                {showAddEval && (
                                    <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                                        <h3 className="text-xl font-bold mb-4">{editingEval ? 'Editar Avalia√ß√£o' : 'Nova Avalia√ß√£o'}</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Data</label>
                                                <input
                                                    type="date"
                                                    value={newEval.date}
                                                    onChange={(e) => setNewEval({...newEval, date: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Peso (kg)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.weight}
                                                    onChange={(e) => setNewEval({...newEval, weight: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                    placeholder="80.5"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Triceps (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.triceps}
                                                    onChange={(e) => setNewEval({...newEval, triceps: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Subscapular (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.subscapular}
                                                    onChange={(e) => setNewEval({...newEval, subscapular: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Peitoral (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.chest}
                                                    onChange={(e) => setNewEval({...newEval, chest: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Axilar M√©dia (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.midaxillary}
                                                    onChange={(e) => setNewEval({...newEval, midaxillary: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Abdominal (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.abdominal}
                                                    onChange={(e) => setNewEval({...newEval, abdominal: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Suprailiac (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.suprailiac}
                                                    onChange={(e) => setNewEval({...newEval, suprailiac: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm text-slate-400 mb-2">Coxa (mm)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={newEval.thigh}
                                                    onChange={(e) => setNewEval({...newEval, thigh: e.target.value})}
                                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                />
                                            </div>
                                        </div>

                                        <div className="flex gap-3">
                                            <button
                                                onClick={handleSaveEvaluation}
                                                className="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg font-semibold transition-all"
                                            >
                                                Salvar
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setShowAddEval(false);
                                                    setEditingEval(null);
                                                    setNewEval({
                                                        date: new Date().toISOString().split('T')[0],
                                                        weight: '', triceps: '', subscapular: '', chest: '',
                                                        midaxillary: '', abdominal: '', suprailiac: '', thigh: ''
                                                    });
                                                }}
                                                className="bg-slate-600 hover:bg-slate-700 px-6 py-2 rounded-lg font-semibold transition-all"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Evaluations List */}
                                <div className="space-y-3">
                                    {evaluations.sort((a, b) => new Date(b.date) - new Date(a.date)).map((eval_item) => (
                                        <div key={eval_item.id} className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                                            <div className="flex justify-between items-start mb-4">
                                                <div>
                                                    <div className="text-2xl font-bold text-blue-400">
                                                        {calculateBodyFat(eval_item).toFixed(1)}% gordura
                                                    </div>
                                                    <div className="text-slate-400">
                                                        {new Date(eval_item.date).toLocaleDateString('pt-BR')} ‚Ä¢ {eval_item.weight} kg
                                                    </div>
                                                    <div className="text-slate-400 text-sm mt-1">
                                                        Soma: {(eval_item.triceps + eval_item.subscapular + eval_item.chest + 
                                                              eval_item.midaxillary + eval_item.abdominal + eval_item.suprailiac + eval_item.thigh).toFixed(1)} mm
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => handleEditEvaluation(eval_item)}
                                                        className="text-blue-400 hover:text-blue-300 p-2"
                                                        title="Editar avalia√ß√£o"
                                                    >
                                                        <svg className="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                        </svg>
                                                    </button>
                                                    <button
                                                        onClick={() => deleteEvaluation(eval_item.id)}
                                                        className="text-red-400 hover:text-red-300 p-2"
                                                        title="Deletar avalia√ß√£o"
                                                    >
                                                        <Trash2 className="h-5 w-5" />
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div className="grid grid-cols-4 md:grid-cols-7 gap-3 text-sm">
                                                <div>
                                                    <div className="text-slate-500">Tr√≠ceps</div>
                                                    <div className="font-semibold">{eval_item.triceps}mm</div>
                                                </div>
                                                <div>
                                                    <div className="text-slate-500">Subescapular</div>
                                                    <div className="font-semibold">{eval_item.subscapular}mm</div>
                                                </div>
                                                <div>
                                                    <div className="text-slate-500">Peitoral</div>
                                                    <div className="font-semibold">{eval_item.chest}mm</div>
                                                </div>
                                                <div>
                                                    <div className="text-slate-500">Axilar M√©dia</div>
                                                    <div className="font-semibold">{eval_item.midaxillary}mm</div>
                                                </div>
                                                <div>
                                                    <div className="text-slate-500">Abdominal</div>
                                                    <div className="font-semibold">{eval_item.abdominal}mm</div>
                                                </div>
                                                <div>
                                                    <div className="text-slate-500">Suprail√≠aca</div>
                                                    <div className="font-semibold">{eval_item.suprailiac}mm</div>
                                                </div>
                                                <div>
                                                    <div className="text-slate-500">Coxa</div>
                                                    <div className="font-semibold">{eval_item.thigh}mm</div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Daily Logs Tab */}
                        {activeTab === 'logs' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold">Registro Di√°rio</h2>
                                    <button
                                        onClick={() => setShowAddLog(true)}
                                        className="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition-all"
                                    >
                                        <Plus className="h-5 w-5" />
                                        Novo Registro
                                    </button>
                                </div>

                                {/* Navega√ß√£o de M√™s/Ano */}
                                <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
                                    <div className="flex items-center justify-between">
                                        <button
                                            onClick={() => {
                                                const newDate = new Date(dailyLogViewDate);
                                                newDate.setMonth(newDate.getMonth() - 1);
                                                setDailyLogViewDate(newDate);
                                            }}
                                            className="bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-2"
                                        >
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                            </svg>
                                            M√™s anterior
                                        </button>
                                        
                                        <div className="text-center">
                                            <div className="text-lg font-bold text-white">
                                                {dailyLogViewDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }).replace(/^\w/, c => c.toUpperCase())}
                                            </div>
                                            <div className="text-xs text-slate-400 mt-1">
                                                {(() => {
                                                    const year = dailyLogViewDate.getFullYear();
                                                    const month = dailyLogViewDate.getMonth();
                                                    const filtered = dailyLogs.filter(log => {
                                                        const logDate = new Date(log.date);
                                                        return logDate.getFullYear() === year && logDate.getMonth() === month;
                                                    });
                                                    return `${filtered.length} registro${filtered.length !== 1 ? 's' : ''}`;
                                                })()}
                                            </div>
                                        </div>
                                        
                                        {dailyLogViewDate.getMonth() !== new Date().getMonth() || dailyLogViewDate.getFullYear() !== new Date().getFullYear() ? (
                                            <button
                                                onClick={() => {
                                                    const newDate = new Date(dailyLogViewDate);
                                                    newDate.setMonth(newDate.getMonth() + 1);
                                                    if (newDate <= new Date()) {
                                                        setDailyLogViewDate(newDate);
                                                    }
                                                }}
                                                className="bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-2"
                                            >
                                                Pr√≥ximo m√™s
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                </svg>
                                            </button>
                                        ) : (
                                            <button
                                                onClick={() => setDailyLogViewDate(new Date())}
                                                className="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm"
                                            >
                                                üìÖ M√™s atual
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* Add Log Form */}
                                {showAddLog && (
                                    <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                                        <div className="flex items-center justify-between mb-6">
                                            <h3 className="text-xl font-bold">{editingLog ? 'Editar Registro' : 'Novo Registro'}</h3>
                                            <div className="flex items-center gap-2">
                                                <label className="block text-sm text-slate-400">Data:</label>
                                                <input
                                                    type="date"
                                                    value={newLog.date}
                                                    onChange={(e) => setNewLog({...newLog, date: e.target.value})}
                                                    className="bg-slate-700 border border-slate-600 rounded-lg px-3 py-1.5 text-white text-sm"
                                                />
                                            </div>
                                        </div>

                                        {/* ========== SE√á√ÉO FITNESS: NUTRI√á√ÉO & EXERC√çCIOS ========== */}
                                        <div className="mb-4 border-2 border-blue-500/40 rounded-xl overflow-hidden">
                                            <div className="bg-gradient-to-r from-blue-900/50 to-cyan-900/50 p-4 border-b border-blue-500/30">
                                                <h4 className="text-lg font-bold text-blue-300 flex items-center gap-2">
                                                    üçΩÔ∏è Nutri√ß√£o & Exerc√≠cios
                                                </h4>
                                                <p className="text-xs text-slate-400 mt-1">Calorias, jejum, refeed e treinos</p>
                                            </div>
                                            
                                            <div className="p-4 bg-slate-900/30 space-y-4">
                                                {/* Calorias */}
                                                <div>
                                                    <label className="block text-sm text-slate-400 mb-2">Calorias Consumidas</label>
                                                    <input
                                                        type="number"
                                                        value={newLog.calories}
                                                        onChange={(e) => setNewLog({...newLog, calories: e.target.value})}
                                                        disabled={newLog.isFasting}
                                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white disabled:opacity-50 disabled:cursor-not-allowed"
                                                        placeholder="1800"
                                                    />
                                                </div>

                                                {/* Fasting & Refeed Checkboxes */}
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className="p-4 bg-indigo-900/20 border border-indigo-700/30 rounded-lg">
                                                <label className="flex items-center gap-3 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={newLog.isFasting}
                                                        onChange={(e) => setNewLog({...newLog, isFasting: e.target.checked, isRefeed: false, calories: e.target.checked ? '0' : newLog.calories})}
                                                        className="w-5 h-5 rounded border-slate-600 text-indigo-600 focus:ring-indigo-500"
                                                    />
                                                    <div>
                                                        <span className="text-white font-semibold">üî• Dia de Jejum (24h)</span>
                                                        <p className="text-xs text-slate-400 mt-1">Jejum completo - calorias zeradas</p>
                                                    </div>
                                                </label>
                                                    </div>
                                                    
                                                    <div className={`p-4 rounded-lg border ${getRefeedStatus().needsRefeed ? 'bg-green-900/30 border-green-700/50' : 'bg-green-900/10 border-green-700/20'}`}>
                                                <label className="flex items-center gap-3 cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={newLog.isRefeed}
                                                        onChange={(e) => {
                                                            const refeedCals = getRefeedStatus().refeedRecommendation;
                                                            setNewLog({
                                                                ...newLog, 
                                                                isRefeed: e.target.checked, 
                                                                isFasting: false,
                                                                calories: e.target.checked ? refeedCals.toString() : newLog.calories
                                                            });
                                                        }}
                                                        className="w-5 h-5 rounded border-slate-600 text-green-600 focus:ring-green-500"
                                                    />
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-white font-semibold">üí™ Dia de Refeed</span>
                                                            {getRefeedStatus().needsRefeed && (
                                                                <span className="bg-green-600 text-xs px-2 py-0.5 rounded-full font-bold">RECOMENDADO!</span>
                                                            )}
                                                        </div>
                                                        <p className="text-xs text-slate-400 mt-1">
                                                            {getRefeedStatus().refeedRecommendation} kcal (manuten√ß√£o + 300)
                                                        </p>
                                                    </div>
                                                </label>
                                                    </div>
                                                </div>

                                                {/* Refeed Alert */}
                                                {getRefeedStatus().needsRefeed && !newLog.isRefeed && (
                                            <div className="mb-4 p-4 bg-green-600/20 border-2 border-green-500 rounded-lg">
                                                <h4 className="text-green-300 font-bold mb-2 flex items-center">
                                                    üîî HORA DO REFEED!
                                                </h4>
                                                <p className="text-sm text-green-200 mb-2">
                                                    Voc√™ j√° tem <strong>{getRefeedStatus().deficitDays} dias em deficit</strong> 
                                                    {getRefeedStatus().lastRefeedDate && ` e ${getRefeedStatus().daysSinceRefeed} dias desde o √∫ltimo refeed`}. 
                                                    √â hora de fazer um refeed estrat√©gico para manter o metabolismo ativo!
                                                </p>
                                                <p className="text-xs text-green-300">
                                                    üí° Marque "Dia de Refeed" e coma {getRefeedStatus().refeedRecommendation} kcal hoje. 
                                                    Foque em carboidratos limpos (arroz, batata-doce, aveia).
                                                </p>
                                                    </div>
                                                )}

                                                {/* Exercise Calories */}
                                                <div>
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center">
                                                <Activity className="mr-2 h-4 w-4" />
                                                Calorias Queimadas em Exerc√≠cios
                                            </h4>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2 flex items-center justify-between">
                                                        <span>üí™ Muscula√ß√£o (kcal)</span>
                                                        <span className="text-yellow-400 cursor-help" title="Dif√≠cil de estimar. Conservador: 150-300/hora. Intenso: 300-500/hora">‚ÑπÔ∏è</span>
                                                    </label>
                                                    <input
                                                        type="number"
                                                        value={newLog.exerciseCalories?.strength || ''}
                                                        onChange={(e) => setNewLog({
                                                            ...newLog, 
                                                            exerciseCalories: {
                                                                ...newLog.exerciseCalories,
                                                                strength: e.target.value
                                                            }
                                                        })}
                                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                        placeholder="200"
                                                        min="0"
                                                    />
                                                    <p className="text-xs text-slate-500 mt-1">
                                                        ~200-400 kcal/treino t√≠pico
                                                    </p>
                                                </div>
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2 flex items-center justify-between">
                                                        <span>üèÉ Aer√≥bico (kcal)</span>
                                                        <span className="text-yellow-400 cursor-help" title="Mais f√°cil de estimar. Corrida: ~100 kcal/km. Bike: 400-600/hora">‚ÑπÔ∏è</span>
                                                    </label>
                                                    <input
                                                        type="number"
                                                        value={newLog.exerciseCalories?.cardio || ''}
                                                        onChange={(e) => setNewLog({
                                                            ...newLog, 
                                                            exerciseCalories: {
                                                                ...newLog.exerciseCalories,
                                                                cardio: e.target.value
                                                            }
                                                        })}
                                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white"
                                                        placeholder="300"
                                                        min="0"
                                                    />
                                                    <p className="text-xs text-slate-500 mt-1">
                                                        Corrida: ~100 kcal/km
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="mt-3 p-3 bg-yellow-600/10 border border-yellow-600/20 rounded-lg">
                                                <p className="text-xs text-yellow-300">
                                                    üí° <strong>Dica:</strong> Seja conservador nas estimativas! √â melhor subestimar do que superestimar o gasto cal√≥rico. Use apps de fitness, rel√≥gios ou calculadoras online como refer√™ncia.
                                                </p>
                                            </div>
                                            {(newLog.exerciseCalories?.strength || newLog.exerciseCalories?.cardio) && (
                                                <div className="mt-3 p-3 bg-green-600/20 border border-green-600/30 rounded-lg">
                                                    <div className="flex items-center justify-between">
                                                        <span className="text-sm text-green-300 font-semibold">Total queimado em exerc√≠cios:</span>
                                                        <span className="text-lg text-green-400 font-bold">
                                                            {(parseInt(newLog.exerciseCalories?.strength || 0) + parseInt(newLog.exerciseCalories?.cardio || 0))} kcal üî•
                                                        </span>
                                                    </div>
                                                    <div className="text-xs text-green-300/70 mt-1">
                                                        Deficit real hoje: {basalCalories + (parseInt(newLog.exerciseCalories?.strength || 0) + parseInt(newLog.exerciseCalories?.cardio || 0)) - (newLog.isFasting ? 0 : parseInt(newLog.calories || 0))} kcal
                                                    </div>
                                                    </div>
                                                )}
                                                </div>
                                            </div>
                                        </div>

                                        {/* ========== SE√á√ÉO WELLNESS: BEM-ESTAR ========== */}
                                        <div className="mb-4 border-2 border-purple-500/40 rounded-xl overflow-hidden">
                                            <div className="bg-gradient-to-r from-purple-900/50 to-pink-900/50 p-4 border-b border-purple-500/30">
                                                <h4 className="text-lg font-bold text-purple-300 flex items-center gap-2">
                                                    ‚ù§Ô∏è Bem-Estar
                                                </h4>
                                                <p className="text-xs text-slate-400 mt-1">Como voc√™ se sentiu hoje</p>
                                            </div>
                                            
                                            <div className="p-4 bg-slate-900/30 space-y-4">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                {/* Hunger Level */}
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2">
                                                        üòã N√≠vel de Fome (1 = sem fome, 10 = faminto)
                                                    </label>
                                                    <input
                                                        type="range"
                                                        min="1"
                                                        max="10"
                                                        value={newLog.hungerLevel}
                                                        onChange={(e) => setNewLog({...newLog, hungerLevel: e.target.value})}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between text-xs text-slate-500 mt-1">
                                                        <span>Sem fome</span>
                                                        <span className="text-white font-bold text-lg">{newLog.hungerLevel}</span>
                                                        <span>Muito fome</span>
                                                    </div>
                                                </div>

                                                {/* Energy Level */}
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2">
                                                        ‚ö° N√≠vel de Energia (1 = exausto, 10 = cheio de energia)
                                                    </label>
                                                    <input
                                                        type="range"
                                                        min="1"
                                                        max="10"
                                                        value={newLog.energyLevel}
                                                        onChange={(e) => setNewLog({...newLog, energyLevel: e.target.value})}
                                                        className="w-full"
                                                    />
                                                    <div className="flex justify-between text-xs text-slate-500 mt-1">
                                                        <span>Exausto</span>
                                                        <span className="text-white font-bold text-lg">{newLog.energyLevel}</span>
                                                        <span>Energizado</span>
                                                    </div>
                                                </div>
                                            </div>

                                                {/* Notes */}
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2">
                                                        üìù Observa√ß√µes (opcional)
                                                    </label>
                                                    <textarea
                                                        value={newLog.notes}
                                                        onChange={(e) => setNewLog({...newLog, notes: e.target.value})}
                                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm"
                                                        placeholder="Como foi o dia? Alguma dificuldade? Sentiu vontade de comer algo espec√≠fico?"
                                                        rows="2"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* ========== SE√á√ÉO SPIRITUAL: JORNADA ESPIRITUAL ========== */}
                                        {spiritualModeEnabled && (
                                            <div className="mb-4 border-2 border-indigo-500/40 rounded-xl overflow-hidden">
                                                <div className="bg-gradient-to-r from-indigo-900/50 to-purple-900/50 p-4 border-b border-indigo-500/30">
                                                    <h4 className="text-lg font-bold text-indigo-300 flex items-center gap-2">
                                                        üßò Jornada Espiritual
                                                    </h4>
                                                    <p className="text-xs text-slate-400 mt-1">Filhos das Estrelas ‚ú®</p>
                                                </div>
                                                
                                                <div className="p-4 bg-slate-900/30 space-y-4">
                                                
                                                {/* Meta Di√°ria Sugerida */}
                                                {(() => {
                                                    const hasLimpeza = newLog.meditations.some(m => m.type === 'limpeza-propria');
                                                    const hasProtecao = newLog.meditations.some(m => m.type === 'protecao');
                                                    const hasConexao = newLog.meditations.some(m => m.type === 'conexao');
                                                    const hasLimpezaAmbiente = newLog.meditations.some(m => m.type === 'limpeza-ambiente');
                                                    const hasConsagracao = newLog.meditations.some(m => m.type === 'consagracao-cristais');
                                                    
                                                    const isComplete = hasLimpeza && hasProtecao && hasConexao;
                                                    const dayOfWeek = new Date(newLog.date).getDay();
                                                    const isSunday = dayOfWeek === 0; // Domingo = dia de limpeza ambiente
                                                    
                                                    // Verifica se √© primeiro domingo do m√™s (consagra√ß√£o cristais)
                                                    const currentDate = new Date(newLog.date);
                                                    const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                                                    const firstSunday = new Date(firstDayOfMonth);
                                                    while (firstSunday.getDay() !== 0) {
                                                        firstSunday.setDate(firstSunday.getDate() + 1);
                                                    }
                                                    const isFirstSunday = isSunday && currentDate.getDate() === firstSunday.getDate();
                                                    
                                                    return (
                                                        <div className="mb-4 p-4 bg-gradient-to-br from-indigo-900/50 to-purple-900/50 rounded-lg border-2 border-indigo-400/40">
                                                            <div className="flex items-center justify-between mb-3">
                                                                <h5 className="text-sm font-bold text-indigo-200">üéØ Protocolo Di√°rio Sugerido</h5>
                                                                {isComplete && <span className="text-green-400 font-bold text-xs">‚úÖ COMPLETO</span>}
                                                            </div>
                                                            <div className="space-y-2 text-xs">
                                                                <div className={`flex items-center gap-2 p-2 rounded ${hasLimpeza ? 'bg-green-900/30 border border-green-500/30' : 'bg-slate-700/30'}`}>
                                                                    <span>{hasLimpeza ? '‚úÖ' : '‚≠ï'}</span>
                                                                    <span className="text-white">üßº Limpeza Pr√≥pria (di√°ria)</span>
                                                                </div>
                                                                <div className={`flex items-center gap-2 p-2 rounded ${hasProtecao ? 'bg-green-900/30 border border-green-500/30' : 'bg-slate-700/30'}`}>
                                                                    <span>{hasProtecao ? '‚úÖ' : '‚≠ï'}</span>
                                                                    <span className="text-white">üõ°Ô∏è Prote√ß√£o (di√°ria)</span>
                                                                </div>
                                                                <div className={`flex items-center gap-2 p-2 rounded ${hasConexao ? 'bg-green-900/30 border border-green-500/30' : 'bg-slate-700/30'}`}>
                                                                    <span>{hasConexao ? '‚úÖ' : '‚≠ï'}</span>
                                                                    <span className="text-white">‚ú® Conex√£o (di√°ria)</span>
                                                                </div>
                                                                {isSunday && !isFirstSunday && (
                                                                    <div className={`flex items-center gap-2 p-2 rounded ${hasLimpezaAmbiente ? 'bg-yellow-900/30 border border-yellow-500/30' : 'bg-slate-700/30'}`}>
                                                                        <span>{hasLimpezaAmbiente ? '‚úÖ' : '‚≠ï'}</span>
                                                                        <span className="text-yellow-200">ÔøΩ Domingo: Limpeza do Ambiente (semanal)</span>
                                                                    </div>
                                                                )}
                                                                {isFirstSunday && (
                                                                    <div className={`flex items-center gap-2 p-2 rounded ${hasConsagracao ? 'bg-pink-900/30 border border-pink-500/30' : 'bg-slate-700/30'}`}>
                                                                        <span>{hasConsagracao ? '‚úÖ' : '‚≠ï'}</span>
                                                                        <span className="text-pink-200">üíé Primeiro Domingo: Consagra√ß√£o de Cristais (mensal)</span>
                                                                    </div>
                                                                )}
                                                                {(newLog.feltAnger || newLog.gossiped || newLog.judgedOthers) && (
                                                                    <div className="p-3 bg-red-900/40 border-2 border-red-500/50 rounded-lg mt-2">
                                                                        <div className="font-bold text-red-200 mb-1">‚ö†Ô∏è Limpeza Extra Recomendada!</div>
                                                                        <div className="text-xs text-red-300">
                                                                            {newLog.feltAnger && '‚Ä¢ Raiva/Ira detectada - fa√ßa limpeza para transmutar a energia\n'}
                                                                            {newLog.gossiped && '‚Ä¢ Fofoca detectada - limpe a energia da palavra\n'}
                                                                            {newLog.judgedOthers && '‚Ä¢ Julgamento detectado - reconecte-se com a compaix√£o'}
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    );
                                                })()}
                                                
                                                {/* Medita√ß√µes do Dia */}
                                                <div className="mb-4 p-4 bg-slate-800/40 rounded-lg border border-purple-500/20">
                                                    <div className="flex items-center justify-between mb-3">
                                                        <h5 className="text-sm font-bold text-purple-200">üßò‚Äç‚ôÇÔ∏è Medita√ß√µes do Dia ({newLog.meditations.length})</h5>
                                                    </div>
                                                    
                                                    {/* Lista de medita√ß√µes adicionadas */}
                                                    {newLog.meditations.length > 0 && (
                                                        <div className="space-y-2 mb-3">
                                                            {newLog.meditations.map((med, idx) => (
                                                                <div key={idx} className="flex items-center justify-between p-2 bg-slate-700/50 rounded-lg">
                                                                    <span className="text-sm text-white">
                                                                        {med.type === 'limpeza-propria' && 'üßº Limpeza Pr√≥pria'}
                                                                        {med.type === 'limpeza-ambiente' && 'üè† Limpeza do Ambiente'}
                                                                        {med.type === 'protecao' && 'üõ°Ô∏è Prote√ß√£o'}
                                                                        {med.type === 'conexao' && '‚ú® Conex√£o'}
                                                                        {med.type === 'consagracao-cristais' && 'üíé Consagra√ß√£o de Cristais'}
                                                                        {' ‚Ä¢ '}
                                                                        <span className="text-purple-300 font-semibold">{med.minutes} min</span>
                                                                    </span>
                                                                    <button
                                                                        onClick={() => {
                                                                            const newMeditations = newLog.meditations.filter((_, i) => i !== idx);
                                                                            setNewLog({...newLog, meditations: newMeditations});
                                                                        }}
                                                                        className="text-red-400 hover:text-red-300 text-xs px-2 py-1"
                                                                    >
                                                                        ‚úï
                                                                    </button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    )}
                                                    
                                                    {/* Adicionar nova medita√ß√£o */}
                                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2">
                                                        <select
                                                            value={newMeditation.type}
                                                            onChange={(e) => setNewMeditation({...newMeditation, type: e.target.value})}
                                                            className="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm"
                                                        >
                                                            <option value="limpeza-propria">üßº Limpeza Pr√≥pria</option>
                                                            <option value="limpeza-ambiente">üè† Limpeza Ambiente</option>
                                                            <option value="protecao">üõ°Ô∏è Prote√ß√£o</option>
                                                            <option value="conexao">‚ú® Conex√£o</option>
                                                            <option value="consagracao-cristais">üíé Consagra√ß√£o Cristais</option>
                                                        </select>
                                                        <input
                                                            type="number"
                                                            value={newMeditation.minutes}
                                                            onChange={(e) => setNewMeditation({...newMeditation, minutes: e.target.value})}
                                                            className="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm"
                                                            placeholder="Minutos"
                                                            min="1"
                                                        />
                                                        <button
                                                            onClick={() => {
                                                                if (newMeditation.minutes && parseInt(newMeditation.minutes) > 0) {
                                                                    setNewLog({
                                                                        ...newLog,
                                                                        meditations: [...newLog.meditations, {
                                                                            type: newMeditation.type,
                                                                            minutes: parseInt(newMeditation.minutes)
                                                                        }]
                                                                    });
                                                                    setNewMeditation({type: 'limpeza-propria', minutes: ''});
                                                                }
                                                            }}
                                                            className="bg-purple-600 hover:bg-purple-700 rounded-lg px-4 py-2 text-white text-sm font-semibold transition-all"
                                                        >
                                                            + Adicionar
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                    
                                                    <label className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                                                        <input
                                                            type="checkbox"
                                                            checked={newLog.gratitude}
                                                            onChange={(e) => setNewLog({...newLog, gratitude: e.target.checked})}
                                                            className="w-5 h-5 rounded border-slate-600 text-green-600"
                                                        />
                                                        <span className="text-white font-semibold">üôè Pratiquei gratid√£o</span>
                                                    </label>
                                                    
                                                    <label className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                                                        <input
                                                            type="checkbox"
                                                            checked={newLog.judgedOthers}
                                                            onChange={(e) => setNewLog({...newLog, judgedOthers: e.target.checked})}
                                                            className="w-5 h-5 rounded border-slate-600 text-red-600"
                                                        />
                                                        <span className="text-white font-semibold">‚öñÔ∏è Julguei outras pessoas</span>
                                                    </label>
                                                    
                                                    <label className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                                                        <input
                                                            type="checkbox"
                                                            checked={newLog.charity}
                                                            onChange={(e) => setNewLog({...newLog, charity: e.target.checked})}
                                                            className="w-5 h-5 rounded border-slate-600 text-yellow-600"
                                                        />
                                                        <span className="text-white font-semibold">üíù Pratiquei caridade</span>
                                                    </label>
                                                    
                                                    <label className="flex items-center gap-3 p-3 bg-red-900/30 rounded-lg cursor-pointer hover:bg-red-800/40 transition-all border border-red-600/30">
                                                        <input
                                                            type="checkbox"
                                                            checked={newLog.feltAnger}
                                                            onChange={(e) => setNewLog({...newLog, feltAnger: e.target.checked})}
                                                            className="w-5 h-5 rounded border-slate-600 text-red-600"
                                                        />
                                                        <span className="text-white font-semibold">üò§ Senti raiva/ira</span>
                                                    </label>
                                                    
                                                    <label className="flex items-center gap-3 p-3 bg-orange-900/30 rounded-lg cursor-pointer hover:bg-orange-800/40 transition-all border border-orange-600/30">
                                                        <input
                                                            type="checkbox"
                                                            checked={newLog.gossiped}
                                                            onChange={(e) => setNewLog({...newLog, gossiped: e.target.checked})}
                                                            className="w-5 h-5 rounded border-slate-600 text-orange-600"
                                                        />
                                                        <span className="text-white font-semibold">üó£Ô∏è Fofoquei</span>
                                                    </label>
                                                </div>
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2">
                                                        üìñ Journal espiritual (opcional)
                                                    </label>
                                                    <textarea
                                                        value={newLog.spiritualNotes}
                                                        onChange={(e) => setNewLog({...newLog, spiritualNotes: e.target.value})}
                                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm"
                                                        placeholder="Reflex√µes do dia, insights espirituais, ora√ß√µes, etc."
                                                        rows="2"
                                                    />
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* ========== SE√á√ÉO NOFAP: JORNADA NOFAP ========== */}
                                        {nofapModeEnabled && (
                                            <div className="mb-4 border-2 border-cyan-500/40 rounded-xl overflow-hidden">
                                                <div className="bg-gradient-to-r from-cyan-900/50 to-blue-900/50 p-4 border-b border-cyan-500/30">
                                                    <h4 className="text-lg font-bold text-cyan-300 flex items-center gap-2">
                                                        üí™ Jornada NoFap
                                                    </h4>
                                                    <p className="text-xs text-slate-400 mt-1">Controle e disciplina</p>
                                                </div>
                                                
                                                <div className="p-4 bg-slate-900/30 space-y-4">
                                                <div className="mb-4">
                                                    <label className="flex items-center gap-3 p-4 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-700/50 transition-all">
                                                        <input
                                                            type="checkbox"
                                                            checked={!newLog.cleanDay}
                                                            onChange={(e) => setNewLog({...newLog, cleanDay: !e.target.checked})}
                                                            className="w-6 h-6 rounded border-slate-600 text-red-600"
                                                        />
                                                        <div>
                                                            <span className="text-white font-bold text-lg">‚ö†Ô∏è Tive uma reca√≠da hoje (PMO)</span>
                                                            <p className="text-xs text-slate-400 mt-1">Marque apenas se houve pornografia, masturba√ß√£o ou orgasmo</p>
                                                        </div>
                                                    </label>
                                                </div>
                                                
                                                {newLog.cleanDay && (
                                                    <div className="mb-4">
                                                        <label className="block text-xs text-slate-400 mb-2">
                                                            üåä Como foi o dia? (0 = tranquilo, 10 = muito dif√≠cil)
                                                        </label>
                                                        <p className="text-xs text-slate-500 mb-2">
                                                            Avalie o n√≠vel de dificuldade/tenta√ß√£o que voc√™ enfrentou hoje
                                                        </p>
                                                        <input
                                                            type="range"
                                                            min="0"
                                                            max="10"
                                                            value={newLog.urgeLevel}
                                                            onChange={(e) => setNewLog({...newLog, urgeLevel: e.target.value})}
                                                            className="w-full"
                                                        />
                                                        <div className="flex justify-between text-xs text-slate-500 mt-1">
                                                            <span>Tranquilo</span>
                                                            <span className={`font-bold text-lg ${newLog.urgeLevel >= 7 ? 'text-red-400' : newLog.urgeLevel >= 4 ? 'text-yellow-400' : 'text-green-400'}`}>
                                                                {newLog.urgeLevel}
                                                            </span>
                                                            <span>Muito dif√≠cil</span>
                                                        </div>
                                                        {newLog.urgeLevel >= 7 && (
                                                            <div className="mt-2 p-2 bg-orange-600/20 border border-orange-500 rounded-lg text-xs text-orange-300">
                                                                üí™ <strong>Dia desafiador!</strong> Isso mostra que voc√™ est√° resistindo. Continue forte! Use o protocolo de emerg√™ncia sempre que precisar.
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                                
                                                <div>
                                                    <label className="block text-xs text-slate-400 mb-2">
                                                        üìù Notas da jornada (opcional)
                                                    </label>
                                                    <textarea
                                                        value={newLog.nofapNotes}
                                                        onChange={(e) => setNewLog({...newLog, nofapNotes: e.target.value})}
                                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm"
                                                        placeholder="Gatilhos enfrentados, estrat√©gias que funcionaram, pensamentos, etc."
                                                        rows="2"
                                                    />
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Bot√µes de a√ß√£o */}
                                        <div className="flex gap-3 mt-6">
                                            <button
                                                onClick={handleSaveLog}
                                                className="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg font-semibold transition-all"
                                            >
                                                üíæ Salvar Registro
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setShowAddLog(false);
                                                    setEditingLog(null);
                                                    setNewLog({
                                                        date: new Date().toISOString().split('T')[0],
                                                        calories: '',
                                                        isFasting: false,
                                                        isRefeed: false,
                                                        exerciseCalories: { strength: '', cardio: '' },
                                                        hungerLevel: 5,
                                                        energyLevel: 5,
                                                        notes: '',
                                                        meditations: [],
                                                        gratitude: false,
                                                        judgedOthers: false,
                                                        charity: false,
                                                        feltAnger: false,
                                                        gossiped: false,
                                                        spiritualNotes: '',
                                                        cleanDay: true,
                                                        urgeLevel: 0,
                                                        nofapNotes: ''
                                                    });
                                                }}
                                                className="bg-slate-600 hover:bg-slate-700 px-6 py-2 rounded-lg font-semibold transition-all"
                                            >
                                                ‚úñÔ∏è Cancelar
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Daily Logs List */}
                                <div className="space-y-3">
                                    {dailyLogs
                                        .filter(log => {
                                            const logDate = new Date(log.date);
                                            const viewYear = dailyLogViewDate.getFullYear();
                                            const viewMonth = dailyLogViewDate.getMonth();
                                            return logDate.getFullYear() === viewYear && logDate.getMonth() === viewMonth;
                                        })
                                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                                        .map((log) => {
                                        const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                        const totalExpenditure = basalCalories + exerciseTotal;
                                        const deficit = totalExpenditure - log.calories;
                                        const status = getLogStatus(log.calories);
                                        const StatusIcon = status.icon;
                                        
                                        return (
                                            <div 
                                                key={log.id} 
                                                className={`${log.isFasting ? 'border-indigo-500 bg-indigo-500/10 text-indigo-400' : status.color} rounded-xl p-6 border-2 shadow-lg ${
                                                    log.isRefeed ? '' : ''
                                                }`}
                                            >
                                                <div className="flex justify-between items-center">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <StatusIcon className="h-8 w-8" />
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-2 flex-wrap">
                                                                    <div className="text-2xl font-bold">{log.isFasting ? 'PARAB√âNS, VOC√ä √â UM VENCEDOR' : status.label}</div>
                                                                    {log.isFasting && (
                                                                        <span className="bg-indigo-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                                                                            üî• JEJUM 24H
                                                                        </span>
                                                                    )}
                                                                    {log.isRefeed && (
                                                                        <span className="bg-green-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                                                                            üí™ REFEED
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                <div className="text-sm opacity-90">
                                                                    {new Date(log.date).toLocaleDateString('pt-BR', { 
                                                                        weekday: 'long', 
                                                                        year: 'numeric', 
                                                                        month: 'long', 
                                                                        day: 'numeric' 
                                                                    })}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm opacity-90 mt-3">
                                                            <div>
                                                                <span className="font-semibold">Consumido:</span> {log.calories} kcal
                                                            </div>
                                                            <div>
                                                                <span className="font-semibold">Basal:</span> {basalCalories} kcal
                                                            </div>
                                                            {exerciseTotal > 0 && (
                                                                <div className="flex items-center gap-1">
                                                                    <Activity className="h-4 w-4" />
                                                                    <span>
                                                                        <span className="font-semibold">Exerc√≠cio:</span> +{exerciseTotal} kcal
                                                                    </span>
                                                                </div>
                                                            )}
                                                            <div className={`font-bold ${deficit > 0 ? 'text-green-300' : 'text-red-300'}`}>
                                                                <span className="font-semibold">{deficit > 0 ? 'Deficit:' : 'Super√°vit:'}</span> {deficit > 0 ? '' : '+'}{Math.abs(deficit)} kcal
                                                            </div>
                                                        </div>
                                                        {exerciseTotal > 0 && (
                                                            <div className="flex gap-4 text-xs opacity-80 mt-2 pl-1">
                                                                {log.exerciseCalories?.strength > 0 && (
                                                                    <span className="bg-white/10 px-2 py-1 rounded">üí™ Muscula√ß√£o: {log.exerciseCalories.strength} kcal</span>
                                                                )}
                                                                {log.exerciseCalories?.cardio > 0 && (
                                                                    <span className="bg-white/10 px-2 py-1 rounded">üèÉ Aer√≥bico: {log.exerciseCalories.cardio} kcal</span>
                                                                )}
                                                            </div>
                                                        )}
                                                        
                                                        {/* Wellness Metrics */}
                                                        {(log.hungerLevel || log.energyLevel || log.notes) && (
                                                            <div className="mt-3 pt-3 border-t border-white/20">
                                                                <div className="flex gap-6 text-xs mb-2">
                                                                    {log.hungerLevel && (
                                                                        <div className="flex items-center gap-2">
                                                                            <span className="opacity-70">üòã Fome:</span>
                                                                            <span className="font-bold">{log.hungerLevel}/10</span>
                                                                        </div>
                                                                    )}
                                                                    {log.energyLevel && (
                                                                        <div className="flex items-center gap-2">
                                                                            <span className="opacity-70">‚ö° Energia:</span>
                                                                            <span className="font-bold">{log.energyLevel}/10</span>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                {log.notes && (
                                                                    <div className="text-xs bg-white/10 p-2 rounded mt-2">
                                                                        <span className="opacity-70">üìù </span>
                                                                        <span>{log.notes}</span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                        
                                                        {/* Spiritual Metrics */}
                                                        {spiritualModeEnabled && log.meditations && (
                                                            <div className="mt-3 pt-3 border-t border-indigo-500/30">
                                                                <div className="flex items-center gap-2 mb-2">
                                                                    <span className="text-sm font-bold text-indigo-300">üßò Espiritual</span>
                                                                </div>
                                                                
                                                                {log.meditations.length > 0 && (
                                                                    <div className="flex flex-wrap gap-2 mb-2">
                                                                        {log.meditations.map((med, idx) => {
                                                                            const labels = {
                                                                                'limpeza-propria': 'üßò Limpeza',
                                                                                'protecao': 'üõ°Ô∏è Prote√ß√£o',
                                                                                'conexao': '‚ú® Conex√£o',
                                                                                'limpeza-ambiente': 'üè† Ambiente',
                                                                                'consagracao-cristais': 'üíé Cristais'
                                                                            };
                                                                            return (
                                                                                <span key={idx} className="text-xs bg-indigo-600/30 px-2 py-1 rounded border border-indigo-500/50">
                                                                                    {labels[med.type]} ({med.minutes}min)
                                                                                </span>
                                                                            );
                                                                        })}
                                                                        <span className="text-xs text-indigo-300 font-bold">
                                                                            Total: {log.meditations.reduce((sum, m) => sum + m.minutes, 0)}min
                                                                        </span>
                                                                    </div>
                                                                )}
                                                                
                                                                <div className="flex flex-wrap gap-2 text-xs">
                                                                    {log.gratitude && <span className="bg-green-600/30 px-2 py-1 rounded">‚úÖ Gratid√£o</span>}
                                                                    {log.charity && <span className="bg-blue-600/30 px-2 py-1 rounded">‚ù§Ô∏è Caridade</span>}
                                                                    {log.judgedOthers && <span className="bg-orange-600/30 px-2 py-1 rounded">‚ö†Ô∏è Julgou</span>}
                                                                    {log.feltAnger && <span className="bg-red-600/30 px-2 py-1 rounded">üò§ Raiva</span>}
                                                                    {log.gossiped && <span className="bg-red-600/30 px-2 py-1 rounded">üó£Ô∏è Fofoca</span>}
                                                                </div>
                                                                
                                                                {log.spiritualNotes && (
                                                                    <div className="text-xs bg-indigo-600/20 p-2 rounded mt-2 border border-indigo-500/30">
                                                                        <span className="opacity-70">üßò </span>
                                                                        <span>{log.spiritualNotes}</span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                        
                                                        {/* NoFap Metrics */}
                                                        {nofapModeEnabled && log.cleanDay !== undefined && (
                                                            <div className="mt-3 pt-3 border-t border-cyan-500/30">
                                                                <div className="flex items-center gap-2 mb-2">
                                                                    <span className="text-sm font-bold text-cyan-300">üí™ NoFap</span>
                                                                </div>
                                                                
                                                                <div className="flex gap-3 text-xs mb-2">
                                                                    <div className={`px-3 py-1 rounded font-bold ${log.cleanDay ? 'bg-green-600/30 text-green-300' : 'bg-red-600/30 text-red-300'}`}>
                                                                        {log.cleanDay ? '‚úÖ Dia Limpo' : '‚ùå Reca√≠da'}
                                                                    </div>
                                                                    {log.cleanDay && log.urgeLevel !== undefined && (
                                                                        <div className="flex items-center gap-2">
                                                                            <span className="opacity-70">üî• Urges:</span>
                                                                            <span className={`font-bold ${
                                                                                log.urgeLevel >= 7 ? 'text-red-400' :
                                                                                log.urgeLevel >= 4 ? 'text-orange-400' :
                                                                                'text-green-400'
                                                                            }`}>
                                                                                {log.urgeLevel}/10
                                                                            </span>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                
                                                                {log.nofapNotes && (
                                                                    <div className="text-xs bg-cyan-600/20 p-2 rounded mt-2 border border-cyan-500/30">
                                                                        <span className="opacity-70">üí™ </span>
                                                                        <span>{log.nofapNotes}</span>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className="flex gap-2 ml-4">
                                                        <button
                                                            onClick={() => handleEditLog(log)}
                                                            className="text-blue-400 hover:text-blue-300 p-2"
                                                            title="Editar registro"
                                                        >
                                                            <svg className="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                            </svg>
                                                        </button>
                                                        <button
                                                            onClick={() => deleteLog(log.id)}
                                                            className="text-red-400 hover:text-red-300 p-2"
                                                            title="Deletar registro"
                                                        >
                                                            <Trash2 className="h-5 w-5" />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {dailyLogs.filter(log => {
                                    const logDate = new Date(log.date);
                                    const viewYear = dailyLogViewDate.getFullYear();
                                    const viewMonth = dailyLogViewDate.getMonth();
                                    return logDate.getFullYear() === viewYear && logDate.getMonth() === viewMonth;
                                }).length === 0 && (
                                    <div className="text-center py-12 text-slate-400">
                                        <Calendar className="h-16 w-16 mx-auto mb-4 opacity-50" />
                                        <p>Nenhum registro em {dailyLogViewDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}.</p>
                                        <p className="text-sm mt-2">Use a navega√ß√£o acima para ver outros meses ou adicione um novo registro!</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Charts Tab */}
                        {activeTab === 'charts' && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold flex items-center">
                                    <TrendingUp className="mr-3 h-8 w-8 text-blue-400" />
                                    An√°lise Gr√°fica de Progresso
                                </h2>

                                {evaluations.length < 2 ? (
                                    <div className="text-center py-12 text-slate-400 bg-slate-800/50 rounded-xl p-8 border border-slate-700">
                                        <TrendingUp className="h-16 w-16 mx-auto mb-4 opacity-50" />
                                        <p className="text-lg mb-2">Gr√°ficos dispon√≠veis ap√≥s 2+ avalia√ß√µes</p>
                                        <p className="text-sm">Continue registrando suas avalia√ß√µes para ver o progresso visual!</p>
                                    </div>
                                ) : (
                                    <>
                                        {/* Body Composition Evolution */}
                                        <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-6 flex items-center">
                                                <Scale className="mr-2 h-6 w-6 text-purple-400" />
                                                Evolu√ß√£o da Composi√ß√£o Corporal
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                {/* Weight Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-4 flex items-center justify-between">
                                                        <span className="flex items-center">
                                                            <TrendingDown className="mr-2 h-4 w-4 text-blue-400" />
                                                            Peso Total (kg)
                                                        </span>
                                                        <span className="text-blue-400">
                                                            {evaluations[0].weight.toFixed(1)} ‚Üí {evaluations[evaluations.length - 1].weight.toFixed(1)}
                                                        </span>
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {evaluations.map((evaluation, idx) => {
                                                            const maxWeight = Math.max(...evaluations.map(e => e.weight));
                                                            const width = (evaluation.weight / maxWeight) * 100;
                                                            const weightChange = idx > 0 ? evaluation.weight - evaluations[idx - 1].weight : 0;
                                                            
                                                            return (
                                                                <div key={evaluation.id}>
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <div className="text-xs text-slate-400 w-24">
                                                                            {new Date(evaluation.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                        </div>
                                                                        <div className="flex-1 bg-slate-600/30 rounded-full h-8 overflow-hidden relative">
                                                                            <div 
                                                                                className="bg-gradient-to-r from-blue-500 to-cyan-500 h-full rounded-full flex items-center justify-end pr-3 transition-all duration-500"
                                                                                style={{ width: `${width}%` }}
                                                                            >
                                                                                <span className="text-xs font-bold text-white">{evaluation.weight.toFixed(1)}</span>
                                                                            </div>
                                                                        </div>
                                                                        {idx > 0 && (
                                                                            <div className={`text-xs font-semibold w-16 text-right ${weightChange < 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                                {weightChange > 0 ? '+' : ''}{weightChange.toFixed(2)}
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                    <div className="mt-4 pt-4 border-t border-slate-600">
                                                        <div className="flex justify-between text-sm">
                                                            {(() => {
                                                                const change = evaluations[0].weight - evaluations[evaluations.length - 1].weight;
                                                                return (
                                                                    <>
                                                                        <span className="text-slate-400">{change >= 0 ? 'Total perdido:' : 'Total ganho:'}</span>
                                                                        <span className={`font-bold ${change >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                            {Math.abs(change).toFixed(2)} kg {change >= 0 ? '‚úì' : '‚ö†Ô∏è'}
                                                                        </span>
                                                                    </>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Body Fat % Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-4 flex items-center justify-between">
                                                        <span className="flex items-center">
                                                            <Flame className="mr-2 h-4 w-4 text-orange-400" />
                                                            Percentual de Gordura (%)
                                                        </span>
                                                        <span className="text-orange-400">
                                                            {calculateBodyFat(evaluations[0]).toFixed(1)}% ‚Üí {calculateBodyFat(evaluations[evaluations.length - 1]).toFixed(1)}%
                                                        </span>
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {evaluations.map((evaluation, idx) => {
                                                            const bf = calculateBodyFat(evaluation);
                                                            const maxBF = Math.max(...evaluations.map(e => calculateBodyFat(e)));
                                                            const width = (bf / maxBF) * 100;
                                                            const bfChange = idx > 0 ? bf - calculateBodyFat(evaluations[idx - 1]) : 0;
                                                            
                                                            return (
                                                                <div key={evaluation.id}>
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <div className="text-xs text-slate-400 w-24">
                                                                            {new Date(evaluation.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                        </div>
                                                                        <div className="flex-1 bg-slate-600/30 rounded-full h-8 overflow-hidden">
                                                                            <div 
                                                                                className="bg-gradient-to-r from-orange-500 to-red-500 h-full rounded-full flex items-center justify-end pr-3 transition-all duration-500"
                                                                                style={{ width: `${width}%` }}
                                                                            >
                                                                                <span className="text-xs font-bold text-white">{bf.toFixed(1)}%</span>
                                                                            </div>
                                                                        </div>
                                                                        {idx > 0 && (
                                                                            <div className={`text-xs font-semibold w-16 text-right ${bfChange < 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                                {bfChange > 0 ? '+' : ''}{bfChange.toFixed(2)}%
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                    <div className="mt-4 pt-4 border-t border-slate-600">
                                                        <div className="flex justify-between text-sm">
                                                            {(() => {
                                                                const change = calculateBodyFat(evaluations[0]) - calculateBodyFat(evaluations[evaluations.length - 1]);
                                                                return (
                                                                    <>
                                                                        <span className="text-slate-400">{change >= 0 ? 'Total reduzido:' : 'Total aumentado:'}</span>
                                                                        <span className={`font-bold ${change >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                            {Math.abs(change).toFixed(2)}% {change >= 0 ? '‚úì' : '‚ö†Ô∏è'}
                                                                        </span>
                                                                    </>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Line Charts - Weight & BF% Evolution */}
                                        <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-6 flex items-center">
                                                <TrendingDown className="mr-2 h-6 w-6 text-blue-400" />
                                                Evolu√ß√£o ao Longo do Tempo
                                            </h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                {/* Weight Line Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-4">Peso (kg)</h4>
                                                    <div className="relative h-48">
                                                        <svg className="w-full h-full" viewBox="0 0 400 150" preserveAspectRatio="none">
                                                            {/* Grid lines */}
                                                            <line x1="0" y1="0" x2="0" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                            <line x1="0" y1="150" x2="400" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                            <line x1="0" y1="75" x2="400" y2="75" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                            <line x1="0" y1="37.5" x2="400" y2="37.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                            <line x1="0" y1="112.5" x2="400" y2="112.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                            
                                                            {/* Line path */}
                                                            {(() => {
                                                                const weights = evaluations.map(e => e.weight);
                                                                const minWeight = Math.min(...weights);
                                                                const maxWeight = Math.max(...weights);
                                                                const range = maxWeight - minWeight || 1;
                                                                
                                                                const points = weights.map((w, i) => {
                                                                    const x = (i / (weights.length - 1)) * 400;
                                                                    const y = 150 - ((w - minWeight) / range) * 140 - 5;
                                                                    return `${x},${y}`;
                                                                }).join(' ');
                                                                
                                                                return (
                                                                    <>
                                                                        <polyline
                                                                            points={points}
                                                                            fill="none"
                                                                            stroke="rgb(59 130 246)"
                                                                            strokeWidth="3"
                                                                            strokeLinecap="round"
                                                                            strokeLinejoin="round"
                                                                        />
                                                                        {weights.map((w, i) => {
                                                                            const x = (i / (weights.length - 1)) * 400;
                                                                            const y = 150 - ((w - minWeight) / range) * 140 - 5;
                                                                            return (
                                                                                <circle
                                                                                    key={i}
                                                                                    cx={x}
                                                                                    cy={y}
                                                                                    r="4"
                                                                                    fill="rgb(59 130 246)"
                                                                                    stroke="white"
                                                                                    strokeWidth="2"
                                                                                />
                                                                            );
                                                                        })}
                                                                    </>
                                                                );
                                                            })()}
                                                        </svg>
                                                        <div className="absolute top-0 left-0 text-xs text-slate-400">
                                                            {Math.max(...evaluations.map(e => e.weight)).toFixed(1)} kg
                                                        </div>
                                                        <div className="absolute bottom-0 left-0 text-xs text-slate-400">
                                                            {Math.min(...evaluations.map(e => e.weight)).toFixed(1)} kg
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Body Fat Line Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-4">Gordura Corporal (%)</h4>
                                                    <div className="relative h-48">
                                                        <svg className="w-full h-full" viewBox="0 0 400 150" preserveAspectRatio="none">
                                                            {/* Grid lines */}
                                                            <line x1="0" y1="0" x2="0" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                            <line x1="0" y1="150" x2="400" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                            <line x1="0" y1="75" x2="400" y2="75" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                            <line x1="0" y1="37.5" x2="400" y2="37.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                            <line x1="0" y1="112.5" x2="400" y2="112.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                            
                                                            {/* Line path with color based on trend */}
                                                            {(() => {
                                                                const bfValues = evaluations.map(e => calculateBodyFat(e));
                                                                const minBF = Math.min(...bfValues);
                                                                const maxBF = Math.max(...bfValues);
                                                                const range = maxBF - minBF || 1;
                                                                const isDescending = bfValues[0] >= bfValues[bfValues.length - 1];
                                                                const lineColor = isDescending ? 'rgb(34 197 94)' : 'rgb(239 68 68)'; // green if descending, red if ascending
                                                                
                                                                return (
                                                                    <>
                                                                        {/* Draw segments between points with colors */}
                                                                        {bfValues.map((bf, i) => {
                                                                            if (i === 0) return null;
                                                                            const prevBf = bfValues[i - 1];
                                                                            const segmentColor = bf <= prevBf ? 'rgb(34 197 94)' : 'rgb(239 68 68)';
                                                                            
                                                                            const x1 = ((i - 1) / (bfValues.length - 1)) * 400;
                                                                            const y1 = 150 - ((prevBf - minBF) / range) * 140 - 5;
                                                                            const x2 = (i / (bfValues.length - 1)) * 400;
                                                                            const y2 = 150 - ((bf - minBF) / range) * 140 - 5;
                                                                            
                                                                            return (
                                                                                <line
                                                                                    key={`segment-${i}`}
                                                                                    x1={x1}
                                                                                    y1={y1}
                                                                                    x2={x2}
                                                                                    y2={y2}
                                                                                    stroke={segmentColor}
                                                                                    strokeWidth="3"
                                                                                    strokeLinecap="round"
                                                                                />
                                                                            );
                                                                        })}
                                                                        {bfValues.map((bf, i) => {
                                                                            const x = (i / (bfValues.length - 1)) * 400;
                                                                            const y = 150 - ((bf - minBF) / range) * 140 - 5;
                                                                            const pointColor = i === 0 || bf <= bfValues[i - 1] ? 'rgb(34 197 94)' : 'rgb(239 68 68)';
                                                                            return (
                                                                                <circle
                                                                                    key={i}
                                                                                    cx={x}
                                                                                    cy={y}
                                                                                    r="4"
                                                                                    fill={pointColor}
                                                                                    stroke="white"
                                                                                    strokeWidth="2"
                                                                                />
                                                                            );
                                                                        })}
                                                                    </>
                                                                );
                                                            })()}
                                                        </svg>
                                                        <div className="absolute top-0 left-0 text-xs text-slate-400">
                                                            {Math.max(...evaluations.map(e => calculateBodyFat(e))).toFixed(1)}%
                                                        </div>
                                                        <div className="absolute bottom-0 left-0 text-xs text-slate-400">
                                                            {Math.min(...evaluations.map(e => calculateBodyFat(e))).toFixed(1)}%
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Muscle vs Fat Mass */}
                                        <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-6 flex items-center">
                                                <Activity className="mr-2 h-6 w-6 text-green-400" />
                                                Massa Muscular vs Gordura Corporal
                                            </h3>
                                            
                                            {/* Combined Line Chart - Muscle vs Fat */}
                                            <div className="bg-slate-700/30 rounded-lg p-4 mb-6">
                                                <h4 className="text-sm font-semibold text-slate-300 mb-4">Composi√ß√£o Corporal ao Longo do Tempo</h4>
                                                <div className="relative h-48">
                                                    <svg className="w-full h-full" viewBox="0 0 500 150">
                                                        {/* Grid lines */}
                                                        <line x1="0" y1="0" x2="0" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                        <line x1="0" y1="150" x2="500" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                        <line x1="0" y1="75" x2="500" y2="75" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                        <line x1="0" y1="37.5" x2="500" y2="37.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                        <line x1="0" y1="112.5" x2="500" y2="112.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                        
                                                        {/* Calculate ranges */}
                                                        {(() => {
                                                            const leanValues = evaluations.map(e => e.weight * (1 - calculateBodyFat(e) / 100));
                                                            const fatValues = evaluations.map(e => e.weight * (calculateBodyFat(e) / 100));
                                                            const allValues = [...leanValues, ...fatValues];
                                                            const minVal = Math.min(...allValues);
                                                            const maxVal = Math.max(...allValues);
                                                            const range = maxVal - minVal || 1;
                                                            
                                                            // Lean mass line (purple)
                                                            const leanPoints = leanValues.map((val, i) => {
                                                                const x = (i / (leanValues.length - 1)) * 500;
                                                                const y = 150 - ((val - minVal) / range) * 140 - 5;
                                                                return `${x},${y}`;
                                                            }).join(' ');
                                                            
                                                            // Fat mass line (blue)
                                                            const fatPoints = fatValues.map((val, i) => {
                                                                const x = (i / (fatValues.length - 1)) * 500;
                                                                const y = 150 - ((val - minVal) / range) * 140 - 5;
                                                                return `${x},${y}`;
                                                            }).join(' ');
                                                            
                                                            return (
                                                                <>
                                                                    {/* Lean mass line */}
                                                                    <polyline
                                                                        points={leanPoints}
                                                                        fill="none"
                                                                        stroke="rgb(168 85 247)"
                                                                        strokeWidth="3"
                                                                        strokeLinecap="round"
                                                                        strokeLinejoin="round"
                                                                    />
                                                                    {leanValues.map((val, i) => {
                                                                        const x = (i / (leanValues.length - 1)) * 500;
                                                                        const y = 150 - ((val - minVal) / range) * 140 - 5;
                                                                        return (
                                                                            <circle
                                                                                key={`lean-${i}`}
                                                                                cx={x}
                                                                                cy={y}
                                                                                r="4"
                                                                                fill="rgb(168 85 247)"
                                                                                stroke="white"
                                                                                strokeWidth="2"
                                                                            />
                                                                        );
                                                                    })}
                                                                    
                                                                    {/* Fat mass line */}
                                                                    <polyline
                                                                        points={fatPoints}
                                                                        fill="none"
                                                                        stroke="rgb(59 130 246)"
                                                                        strokeWidth="3"
                                                                        strokeLinecap="round"
                                                                        strokeLinejoin="round"
                                                                    />
                                                                    {fatValues.map((val, i) => {
                                                                        const x = (i / (fatValues.length - 1)) * 500;
                                                                        const y = 150 - ((val - minVal) / range) * 140 - 5;
                                                                        return (
                                                                            <circle
                                                                                key={`fat-${i}`}
                                                                                cx={x}
                                                                                cy={y}
                                                                                r="4"
                                                                                fill="rgb(59 130 246)"
                                                                                stroke="white"
                                                                                strokeWidth="2"
                                                                            />
                                                                        );
                                                                    })}
                                                                </>
                                                            );
                                                        })()}
                                                    </svg>
                                                    <div className="absolute top-0 left-0 text-xs text-slate-400">
                                                        {(() => {
                                                            const leanValues = evaluations.map(e => e.weight * (1 - calculateBodyFat(e) / 100));
                                                            const fatValues = evaluations.map(e => e.weight * (calculateBodyFat(e) / 100));
                                                            return Math.max(...leanValues, ...fatValues).toFixed(1);
                                                        })()} kg
                                                    </div>
                                                    <div className="absolute bottom-0 left-0 text-xs text-slate-400">
                                                        {(() => {
                                                            const leanValues = evaluations.map(e => e.weight * (1 - calculateBodyFat(e) / 100));
                                                            const fatValues = evaluations.map(e => e.weight * (calculateBodyFat(e) / 100));
                                                            return Math.min(...leanValues, ...fatValues).toFixed(1);
                                                        })()} kg
                                                    </div>
                                                </div>
                                                {/* Legend */}
                                                <div className="flex gap-6 mt-4 text-xs justify-center">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-purple-500"></div>
                                                        <span className="text-slate-300">Massa Muscular</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                                                        <span className="text-slate-300">Massa de Gordura</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Individual Bar Charts */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                {/* Lean Mass Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-4 flex items-center justify-between">
                                                        <span className="flex items-center">
                                                            <TrendingUp className="mr-2 h-4 w-4 text-purple-400" />
                                                            Massa Muscular (kg)
                                                        </span>
                                                        {(() => {
                                                            const firstLean = evaluations[0].weight * (1 - calculateBodyFat(evaluations[0]) / 100);
                                                            const lastLean = evaluations[evaluations.length - 1].weight * (1 - calculateBodyFat(evaluations[evaluations.length - 1]) / 100);
                                                            const change = lastLean - firstLean;
                                                            return (
                                                                <span className={change >= 0 ? 'text-green-400' : 'text-red-400'}>
                                                                    {firstLean.toFixed(1)} ‚Üí {lastLean.toFixed(1)}
                                                                </span>
                                                            );
                                                        })()}
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {evaluations.map((evaluation, idx) => {
                                                            const bf = calculateBodyFat(evaluation);
                                                            const leanMass = evaluation.weight * (1 - bf / 100);
                                                            const maxLean = Math.max(...evaluations.map(e => e.weight * (1 - calculateBodyFat(e) / 100)));
                                                            const width = (leanMass / maxLean) * 100;
                                                            const leanChange = idx > 0 ? leanMass - (evaluations[idx - 1].weight * (1 - calculateBodyFat(evaluations[idx - 1]) / 100)) : 0;
                                                            
                                                            return (
                                                                <div key={evaluation.id}>
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <div className="text-xs text-slate-400 w-24">
                                                                            {new Date(evaluation.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                        </div>
                                                                        <div className="flex-1 bg-slate-600/30 rounded-full h-8 overflow-hidden">
                                                                            <div 
                                                                                className="bg-gradient-to-r from-purple-500 to-pink-500 h-full rounded-full flex items-center justify-end pr-3 transition-all duration-500"
                                                                                style={{ width: `${width}%` }}
                                                                            >
                                                                                <span className="text-xs font-bold text-white">{leanMass.toFixed(1)}</span>
                                                                            </div>
                                                                        </div>
                                                                        {idx > 0 && (
                                                                            <div className={`text-xs font-semibold w-16 text-right ${leanChange >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                                {leanChange > 0 ? '+' : ''}{leanChange.toFixed(2)}
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                    <div className="mt-4 pt-4 border-t border-slate-600">
                                                        <div className="flex justify-between text-sm">
                                                            <span className="text-slate-400">Mudan√ßa total:</span>
                                                            {(() => {
                                                                const firstLean = evaluations[0].weight * (1 - calculateBodyFat(evaluations[0]) / 100);
                                                                const lastLean = evaluations[evaluations.length - 1].weight * (1 - calculateBodyFat(evaluations[evaluations.length - 1]) / 100);
                                                                const change = lastLean - firstLean;
                                                                return (
                                                                    <span className={`font-bold ${change >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                        {change >= 0 ? '+' : ''}{change.toFixed(2)} kg {change >= 0 ? 'üí™' : '‚ö†Ô∏è'}
                                                                    </span>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Fat Mass Chart */}
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-slate-300 mb-4 flex items-center justify-between">
                                                        <span className="flex items-center">
                                                            <TrendingDown className="mr-2 h-4 w-4 text-blue-400" />
                                                            Massa de Gordura (kg)
                                                        </span>
                                                        <span className="text-blue-400">
                                                            {(() => {
                                                                const firstFat = evaluations[0].weight * (calculateBodyFat(evaluations[0]) / 100);
                                                                const lastFat = evaluations[evaluations.length - 1].weight * (calculateBodyFat(evaluations[evaluations.length - 1]) / 100);
                                                                return `${firstFat.toFixed(1)} ‚Üí ${lastFat.toFixed(1)}`;
                                                            })()}
                                                        </span>
                                                    </h4>
                                                    <div className="space-y-3">
                                                        {evaluations.map((evaluation, idx) => {
                                                            const bf = calculateBodyFat(evaluation);
                                                            const fatMass = evaluation.weight * (bf / 100);
                                                            const maxFat = Math.max(...evaluations.map(e => e.weight * (calculateBodyFat(e) / 100)));
                                                            const width = (fatMass / maxFat) * 100;
                                                            const fatChange = idx > 0 ? fatMass - (evaluations[idx - 1].weight * (calculateBodyFat(evaluations[idx - 1]) / 100)) : 0;
                                                            
                                                            return (
                                                                <div key={evaluation.id}>
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <div className="text-xs text-slate-400 w-24">
                                                                            {new Date(evaluation.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                        </div>
                                                                        <div className="flex-1 bg-slate-600/30 rounded-full h-8 overflow-hidden">
                                                                            <div 
                                                                                className="bg-gradient-to-r from-blue-500 to-cyan-500 h-full rounded-full flex items-center justify-end pr-3 transition-all duration-500"
                                                                                style={{ width: `${width}%` }}
                                                                            >
                                                                                <span className="text-xs font-bold text-white">{fatMass.toFixed(1)}</span>
                                                                            </div>
                                                                        </div>
                                                                        {idx > 0 && (
                                                                            <div className={`text-xs font-semibold w-16 text-right ${fatChange < 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                                {fatChange > 0 ? '+' : ''}{fatChange.toFixed(2)}
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                    <div className="mt-4 pt-4 border-t border-slate-600">
                                                        <div className="flex justify-between text-sm">
                                                            {(() => {
                                                                const firstFat = evaluations[0].weight * (calculateBodyFat(evaluations[0]) / 100);
                                                                const lastFat = evaluations[evaluations.length - 1].weight * (calculateBodyFat(evaluations[evaluations.length - 1]) / 100);
                                                                const change = firstFat - lastFat;
                                                                return (
                                                                    <>
                                                                        <span className="text-slate-400">{change >= 0 ? 'Total queimado:' : 'Total ganho:'}</span>
                                                                        <span className={`font-bold ${change >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                            {Math.abs(change).toFixed(2)} kg {change >= 0 ? 'üî•' : '‚ö†Ô∏è'}
                                                                        </span>
                                                                    </>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Skinfold Measurements Tracking */}
                                        <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                            <h3 className="text-xl font-bold mb-6 flex items-center">
                                                <Ruler className="mr-2 h-6 w-6 text-yellow-400" />
                                                Evolu√ß√£o das Dobras Cut√¢neas (mm)
                                            </h3>
                                            
                                            {/* Combined Line Chart for All Skinfolds */}
                                            <div className="bg-slate-700/30 rounded-lg p-4 mb-6">
                                                <h4 className="text-sm font-semibold text-slate-300 mb-4">Compara√ß√£o de Todas as Dobras</h4>
                                                <div className="relative h-48">
                                                    <svg className="w-full h-full" viewBox="0 0 500 150">
                                                        {/* Grid lines */}
                                                        <line x1="0" y1="0" x2="0" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                        <line x1="0" y1="150" x2="500" y2="150" stroke="rgb(71 85 105)" strokeWidth="1"/>
                                                        <line x1="0" y1="75" x2="500" y2="75" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                        <line x1="0" y1="37.5" x2="500" y2="37.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                        <line x1="0" y1="112.5" x2="500" y2="112.5" stroke="rgb(51 65 85)" strokeWidth="0.5" strokeDasharray="5,5"/>
                                                        
                                                        {/* Lines for each skinfold site */}
                                                        {['chest', 'abdominal', 'thigh', 'triceps', 'subscapular', 'suprailiac', 'midaxillary'].map((site, siteIdx) => {
                                                            const colors = [
                                                                'rgb(239 68 68)',    // red - chest
                                                                'rgb(249 115 22)',   // orange - abdominal
                                                                'rgb(234 179 8)',    // yellow - thigh
                                                                'rgb(34 197 94)',    // green - triceps
                                                                'rgb(59 130 246)',   // blue - subscapular
                                                                'rgb(168 85 247)',   // purple - suprailiac
                                                                'rgb(236 72 153)'    // pink - midaxillary
                                                            ];
                                                            
                                                            const siteValues = evaluations.map(e => e[site] || 0);
                                                            const allValues = evaluations.flatMap(e => 
                                                                ['chest', 'abdominal', 'thigh', 'triceps', 'subscapular', 'suprailiac', 'midaxillary'].map(s => e[s] || 0)
                                                            );
                                                            const minVal = Math.min(...allValues);
                                                            const maxVal = Math.max(...allValues);
                                                            const range = maxVal - minVal || 1;
                                                            
                                                            const points = siteValues.map((val, i) => {
                                                                const x = (i / (siteValues.length - 1)) * 500;
                                                                const y = 150 - ((val - minVal) / range) * 140 - 5;
                                                                return `${x},${y}`;
                                                            }).join(' ');
                                                            
                                                            return (
                                                                <g key={site}>
                                                                    <polyline
                                                                        points={points}
                                                                        fill="none"
                                                                        stroke={colors[siteIdx]}
                                                                        strokeWidth="2"
                                                                        strokeLinecap="round"
                                                                        strokeLinejoin="round"
                                                                        opacity="0.7"
                                                                    />
                                                                    {siteValues.map((val, i) => {
                                                                        const x = (i / (siteValues.length - 1)) * 500;
                                                                        const y = 150 - ((val - minVal) / range) * 140 - 5;
                                                                        return (
                                                                            <circle
                                                                                key={i}
                                                                                cx={x}
                                                                                cy={y}
                                                                                r="3"
                                                                                fill={colors[siteIdx]}
                                                                                stroke="white"
                                                                                strokeWidth="1"
                                                                            />
                                                                        );
                                                                    })}
                                                                </g>
                                                            );
                                                        })}
                                                    </svg>
                                                    <div className="absolute top-0 left-0 text-xs text-slate-400">
                                                        {Math.max(...evaluations.flatMap(e => 
                                                            ['chest', 'abdominal', 'thigh', 'triceps', 'subscapular', 'suprailiac', 'midaxillary'].map(s => e[s] || 0)
                                                        )).toFixed(1)} mm
                                                    </div>
                                                    <div className="absolute bottom-0 left-0 text-xs text-slate-400">
                                                        {Math.min(...evaluations.flatMap(e => 
                                                            ['chest', 'abdominal', 'thigh', 'triceps', 'subscapular', 'suprailiac', 'midaxillary'].map(s => e[s] || 0)
                                                        )).toFixed(1)} mm
                                                    </div>
                                                </div>
                                                {/* Legend */}
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mt-4 text-xs">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                                        <span className="text-slate-300">Peitoral</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                                                        <span className="text-slate-300">Abdominal</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                                        <span className="text-slate-300">Coxa</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-green-500"></div>
                                                        <span className="text-slate-300">Tr√≠ceps</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                                                        <span className="text-slate-300">Subescapular</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-purple-500"></div>
                                                        <span className="text-slate-300">Supra-il√≠aca</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-3 h-3 rounded-full bg-pink-500"></div>
                                                        <span className="text-slate-300">Axilar M√©dia</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Individual Bar Charts */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                {['chest', 'abdominal', 'thigh', 'triceps', 'subscapular', 'suprailiac', 'midaxillary'].map((site) => {
                                                    const siteNames = {
                                                        chest: 'Peitoral',
                                                        abdominal: 'Abdominal',
                                                        thigh: 'Coxa',
                                                        triceps: 'Tr√≠ceps',
                                                        subscapular: 'Subescapular',
                                                        suprailiac: 'Supra-il√≠aca',
                                                        midaxillary: 'Axilar M√©dia'
                                                    };
                                                    
                                                    return (
                                                        <div key={site} className="bg-slate-700/30 rounded-lg p-4">
                                                            <h4 className="text-sm font-semibold text-slate-300 mb-3">
                                                                {siteNames[site]}
                                                            </h4>
                                                            <div className="space-y-2">
                                                                {evaluations.map((evaluation, idx) => {
                                                                    const value = evaluation[site];
                                                                    const maxValue = Math.max(...evaluations.map(e => e[site]));
                                                                    const width = (value / maxValue) * 100;
                                                                    
                                                                    return (
                                                                        <div key={evaluation.id} className="flex items-center gap-2">
                                                                            <div className="text-xs text-slate-400 w-16">
                                                                                {new Date(evaluation.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })}
                                                                            </div>
                                                                            <div className="flex-1 bg-slate-600/30 rounded-full h-6 overflow-hidden">
                                                                                <div 
                                                                                    className="bg-gradient-to-r from-yellow-500 to-amber-500 h-full rounded-full flex items-center justify-end pr-2 transition-all duration-500"
                                                                                    style={{ width: `${width}%` }}
                                                                                >
                                                                                    <span className="text-xs font-bold text-white">{value}</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                            <div className="mt-3 pt-3 border-t border-slate-600 flex justify-between text-xs">
                                                                {(() => {
                                                                    const change = evaluations[0][site] - evaluations[evaluations.length - 1][site];
                                                                    return (
                                                                        <>
                                                                            <span className="text-slate-400">{change >= 0 ? 'Redu√ß√£o:' : 'Aumento:'}</span>
                                                                            <span className={`font-bold ${change >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                                                {Math.abs(change).toFixed(1)} mm {change >= 0 ? '‚úì' : '‚ö†Ô∏è'}
                                                                            </span>
                                                                        </>
                                                                    );
                                                                })()}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>

                                        {/* Calories Deficit Tracking */}
                                        {dailyLogs.length > 0 && (
                                            <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                <h3 className="text-xl font-bold mb-6 flex items-center">
                                                    <Flame className="mr-2 h-6 w-6 text-orange-400" />
                                                    Hist√≥rico de Deficit Cal√≥rico (√∫ltimos 14 dias)
                                                </h3>
                                                <div className="bg-slate-700/30 rounded-lg p-4">
                                                    <div className="space-y-3">
                                                        {dailyLogs
                                                            .sort((a, b) => new Date(b.date) - new Date(a.date))
                                                            .slice(0, 14)
                                                            .reverse()
                                                            .map((log) => {
                                                                const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                                const totalExpenditure = basalCalories + exerciseTotal;
                                                                const deficit = totalExpenditure - log.calories;
                                                                const isGood = deficit >= 500;
                                                                const isFasting = log.isFasting;
                                                                const maxDeficit = basalCalories + 1000; // account for exercise
                                                                const width = Math.max(Math.min((Math.abs(deficit) / maxDeficit) * 100, 100), 8); // min 8% para n√£o quebrar o layout
                                                                
                                                                return (
                                                                    <div key={log.id}>
                                                                        <div className="flex items-center gap-2 mb-1">
                                                                            <div className="text-xs text-slate-400 w-24">
                                                                                {new Date(log.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric', weekday: 'short' })}
                                                                            </div>
                                                                            <div className="flex-1 bg-slate-600/30 rounded-full h-8 overflow-hidden">
                                                                                <div 
                                                                                    className={`h-full rounded-full flex items-center ${width > 15 ? 'justify-end pr-3' : 'justify-center'} transition-all duration-500 ${
                                                                                        isFasting ? 'bg-gradient-to-r from-purple-500 to-indigo-500' :
                                                                                        deficit > 0 ? 'bg-gradient-to-r from-green-500 to-emerald-500' : 
                                                                                        'bg-gradient-to-r from-red-500 to-pink-500'
                                                                                    }`}
                                                                                    style={{ width: `${width}%` }}
                                                                                >
                                                                                    <span className="text-xs font-bold text-white whitespace-nowrap">
                                                                                        {isFasting ? 'üî• JEJUM' : 
                                                                                         exerciseTotal > 0 ? `${deficit > 0 ? '-' : '+'}${Math.abs(deficit)} (+${exerciseTotal})` :
                                                                                         `${deficit > 0 ? '-' : '+'}${Math.abs(deficit)} kcal`}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                            <div className="text-xs w-16 text-right">
                                                                                {isFasting ? 'üíú' : isGood ? '‚úÖ' : deficit > 0 ? '‚ö†Ô∏è' : '‚ùå'}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                    </div>
                                                    <div className="mt-4 pt-4 border-t border-slate-600">
                                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                                            <div>
                                                                <span className="text-slate-400">Deficit m√©dio:</span>
                                                                <span className="ml-2 text-green-400 font-bold">
                                                                    {(() => {
                                                                        const recent = dailyLogs.slice(-14);
                                                                        const avgDeficit = recent.reduce((acc, log) => {
                                                                            const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                                            return acc + ((basalCalories + exerciseTotal) - log.calories);
                                                                        }, 0) / recent.length;
                                                                        return `${Math.round(avgDeficit)} kcal/dia`;
                                                                    })()}
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <span className="text-slate-400">Dias em deficit:</span>
                                                                <span className="ml-2 text-blue-400 font-bold">
                                                                    {dailyLogs.slice(-14).filter(log => {
                                                                        const exerciseTotal = (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                                        return ((basalCalories + exerciseTotal) - log.calories) >= 500;
                                                                    }).length}/14
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <span className="text-slate-400">Exerc√≠cio total:</span>
                                                                <span className="ml-2 text-purple-400 font-bold">
                                                                    {(() => {
                                                                        const recent = dailyLogs.slice(-14);
                                                                        const totalExercise = recent.reduce((acc, log) => {
                                                                            return acc + (log.exerciseCalories?.strength || 0) + (log.exerciseCalories?.cardio || 0);
                                                                        }, 0);
                                                                        return `${totalExercise} kcal`;
                                                                    })()}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Summary Stats */}
                                        <div className="bg-gradient-to-br from-blue-900/50 to-purple-900/50 backdrop-blur rounded-xl p-6 border border-blue-700/50">
                                            <h3 className="text-xl font-bold mb-6 flex items-center">
                                                <Award className="mr-2 h-6 w-6 text-yellow-400" />
                                                Resumo do Progresso
                                            </h3>
                                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                                                <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                                                    {(() => {
                                                        const change = evaluations[0].weight - evaluations[evaluations.length - 1].weight;
                                                        return (
                                                            <>
                                                                <div className={`text-3xl font-bold ${change >= 0 ? 'text-blue-400' : 'text-red-400'}`}>
                                                                    {change >= 0 ? '-' : '+'}{Math.abs(change).toFixed(2)}
                                                                </div>
                                                                <div className="text-sm text-slate-400 mt-1">kg de peso</div>
                                                            </>
                                                        );
                                                    })()}
                                                </div>
                                                <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                                                    {(() => {
                                                        const change = calculateBodyFat(evaluations[0]) - calculateBodyFat(evaluations[evaluations.length - 1]);
                                                        return (
                                                            <>
                                                                <div className={`text-3xl font-bold ${change >= 0 ? 'text-orange-400' : 'text-red-400'}`}>
                                                                    {change >= 0 ? '-' : '+'}{Math.abs(change).toFixed(2)}%
                                                                </div>
                                                                <div className="text-sm text-slate-400 mt-1">% de gordura</div>
                                                            </>
                                                        );
                                                    })()}
                                                </div>
                                                <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                                                    <div className="text-3xl font-bold text-purple-400">
                                                        {(() => {
                                                            const firstLean = evaluations[0].weight * (1 - calculateBodyFat(evaluations[0]) / 100);
                                                            const lastLean = evaluations[evaluations.length - 1].weight * (1 - calculateBodyFat(evaluations[evaluations.length - 1]) / 100);
                                                            const change = lastLean - firstLean;
                                                            return `${change >= 0 ? '+' : ''}${change.toFixed(2)}`;
                                                        })()}
                                                    </div>
                                                    <div className="text-sm text-slate-400 mt-1">kg massa magra</div>
                                                </div>
                                                
                                                {/* Tracking de % massa muscular */}
                                                <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                                                    {(() => {
                                                        const firstWeight = evaluations[evaluations.length - 1].weight;
                                                        const lastWeight = evaluations[0].weight;
                                                        const firstLean = firstWeight * (1 - calculateBodyFat(evaluations[evaluations.length - 1]) / 100);
                                                        const lastLean = lastWeight * (1 - calculateBodyFat(evaluations[0]) / 100);
                                                        
                                                        const weightChange = lastWeight - firstWeight;
                                                        const leanChange = lastLean - firstLean;
                                                        
                                                        // % de massa muscular perdida em rela√ß√£o ao peso total perdido/ganho
                                                        const muscleLossPercent = weightChange !== 0 ? (leanChange / weightChange) * 100 : 0;
                                                        
                                                        // Classifica√ß√£o (baseado em cutting/bulking)
                                                        let status, color, icon;
                                                        
                                                        if (weightChange < 0) { // Perdendo peso (cutting)
                                                            if (muscleLossPercent > 50) {
                                                                status = 'EXCESSIVA';
                                                                color = 'text-red-500';
                                                                icon = 'üö®';
                                                            } else if (muscleLossPercent > 30) {
                                                                status = 'MUITA';
                                                                color = 'text-orange-500';
                                                                icon = '‚ö†Ô∏è';
                                                            } else if (muscleLossPercent > 15) {
                                                                status = 'Moderada';
                                                                color = 'text-yellow-500';
                                                                icon = '‚ö°';
                                                            } else if (muscleLossPercent >= 0) {
                                                                status = 'Aceit√°vel';
                                                                color = 'text-green-500';
                                                                icon = '‚úÖ';
                                                            } else {
                                                                status = 'GANHANDO!';
                                                                color = 'text-cyan-400';
                                                                icon = 'üí™';
                                                            }
                                                        } else { // Ganhando peso (bulking)
                                                            if (muscleLossPercent < 0) {
                                                                status = 'Perdendo';
                                                                color = 'text-red-500';
                                                                icon = 'üìâ';
                                                            } else if (muscleLossPercent < 30) {
                                                                status = 'Pouco';
                                                                color = 'text-orange-400';
                                                                icon = '‚ö†Ô∏è';
                                                            } else if (muscleLossPercent < 50) {
                                                                status = 'Razo√°vel';
                                                                color = 'text-yellow-400';
                                                                icon = 'üìä';
                                                            } else {
                                                                status = 'EXCELENTE';
                                                                color = 'text-green-400';
                                                                icon = 'üî•';
                                                            }
                                                        }
                                                        
                                                        return (
                                                            <>
                                                                <div className={`text-2xl font-bold ${color}`}>
                                                                    {icon} {Math.abs(muscleLossPercent).toFixed(1)}%
                                                                </div>
                                                                <div className={`text-xs font-bold mt-1 ${color}`}>
                                                                    {status}
                                                                </div>
                                                                <div className="text-xs text-slate-400 mt-1">
                                                                    {weightChange < 0 ? 'Perda de massa' : 'Ganho de massa'}
                                                                </div>
                                                            </>
                                                        );
                                                    })()}
                                                </div>
                                                
                                                <div className="bg-slate-800/50 rounded-lg p-4 text-center">
                                                    <div className="text-3xl font-bold text-green-400">
                                                        {Math.abs(Math.round(((new Date(evaluations[0].date) - new Date(evaluations[evaluations.length - 1].date)) / (1000 * 60 * 60 * 24))))}
                                                    </div>
                                                    <div className="text-sm text-slate-400 mt-1">dias acompanhados</div>
                                                </div>
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {/* Spiritual Tab */}
                        {activeTab === 'spiritual' && spiritualModeEnabled && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold flex items-center">
                                    <span className="mr-3 text-3xl">üßò</span>
                                    Jornada Espiritual
                                </h2>

                                {/* Avisos e Lembretes Importantes */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {/* Lembrete Noturno */}
                                    <div className="bg-gradient-to-br from-indigo-900/50 to-purple-900/50 backdrop-blur rounded-xl p-6 border-2 border-indigo-500/50">
                                        <h3 className="text-lg font-bold text-indigo-200 mb-3 flex items-center gap-2">
                                            üåô Antes de Dormir
                                        </h3>
                                        <div className="space-y-3 text-sm text-slate-200">
                                            <p className="leading-relaxed">
                                                Reserve um tempo para:
                                            </p>
                                            <ul className="space-y-2 ml-4">
                                                <li className="flex items-start gap-2">
                                                    <span className="text-purple-400 mt-1">‚ú®</span>
                                                    <span><strong>Conversar com seu EU Superior</strong> - Fale sobre seu dia, seus desafios</span>
                                                </li>
                                                <li className="flex items-start gap-2">
                                                    <span className="text-cyan-400 mt-1">üåå</span>
                                                    <span><strong>Conectar com seu EU Maior</strong> - Ele precisa de voc√™!</span>
                                                </li>
                                                <li className="flex items-start gap-2">
                                                    <span className="text-pink-400 mt-1">üë•</span>
                                                    <span><strong>Agradecer aos Aliados Astrais</strong> - Seus amigos espirituais e das estrelas!</span>
                                                </li>
                                                <li className="flex items-start gap-2">
                                                    <span className="text-yellow-400 mt-1">üåå</span>
                                                    <span><strong>Honrar sua Fam√≠lia C√≥smica</strong> - De onde voc√™ veio</span>
                                                </li>
                                            </ul>
                                            <div className="mt-4 p-3 bg-slate-800/50 rounded-lg border-l-4 border-purple-400">
                                                <p className="text-xs text-purple-200 italic">
                                                    "Esta conversa noturna fortalece sua conex√£o com o cosmos e prepara seu campo energ√©tico para o sono reparador e as lutas do outro lado."
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Frase do Marcelo Marins */}
                                    <div className="bg-gradient-to-br from-purple-900/50 to-pink-900/50 backdrop-blur rounded-xl p-6 border-2 border-purple-500/50">
                                        <h3 className="text-lg font-bold text-purple-200 mb-3 flex items-center gap-2">
                                            üí≠ Nunca se esque√ßa
                                        </h3>
                                        <div className="space-y-4">
                                            <div className="text-center py-4">
                                                <div className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-pink-300 leading-tight">
                                                    PARE, PENSE,
                                                    <br />
                                                    REFLITA E ANALISE
                                                </div>
                                                <div className="text-sm text-slate-300 mt-3 italic">
                                                    - Marcelo Marins
                                                </div>
                                            </div>
                                            <div className="p-3 bg-slate-800/50 rounded-lg border-l-4 border-pink-400">
                                                <p className="text-xs text-slate-200">
                                                    Use este token antes de tomar decis√µes importantes, reagir a situa√ß√µes ou quando sentir energias densas.
                                                    √â uma ferramenta poderosa de autoconsci√™ncia e discernimento espiritual.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Canal do Marcelo Marins */}
                                <div className="bg-gradient-to-r from-purple-900/30 to-pink-900/30 backdrop-blur rounded-xl p-6 border border-purple-700/50">
                                    <div className="flex items-center justify-between flex-wrap gap-4">
                                        <div className="flex items-center gap-4">
                                            <div className="text-5xl">üåå</div>
                                            <div>
                                                <h3 className="text-xl font-bold text-white">Os Filhos das Estrelas</h3>
                                                <p className="text-sm text-slate-300 mt-1">Canal do Marcelo Marins</p>
                                                <p className="text-xs text-slate-400 mt-1">Ensinamentos para conex√£o com o Cosmos e despertar espiritual</p>
                                            </div>
                                        </div>
                                        <a
                                            href="https://www.youtube.com/@OSFILHOSDASESTRELASMDM"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-lg transition-all hover:scale-105 shadow-lg flex items-center gap-2"
                                        >
                                            <span className="text-xl">‚ñ∂Ô∏è</span>
                                            <span>Assistir no YouTube</span>
                                        </a>
                                    </div>
                                </div>

                                {/* Spiritual Dashboard */}
                                {(() => {
                                    const spiritualData = dailyLogs.filter(log => log.meditations && log.meditations.length > 0);
                                    const currentMonth = new Date().getMonth();
                                    const currentYear = new Date().getFullYear();
                                    const thisMonthData = spiritualData.filter(log => {
                                        const logDate = new Date(log.date);
                                        return logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear;
                                    });

                                    const totalMeditations = thisMonthData.reduce((acc, log) => acc + (log.meditations?.length || 0), 0);
                                    const totalMinutes = thisMonthData.reduce((acc, log) => 
                                        acc + (log.meditations?.reduce((sum, med) => sum + med.minutes, 0) || 0), 0
                                    );
                                    
                                    // Conta por tipo
                                    const meditationsByType = {
                                        'limpeza-propria': 0,
                                        'limpeza-ambiente': 0,
                                        'protecao': 0,
                                        'conexao': 0,
                                        'consagracao-cristais': 0
                                    };
                                    
                                    thisMonthData.forEach(log => {
                                        log.meditations?.forEach(med => {
                                            meditationsByType[med.type] = (meditationsByType[med.type] || 0) + 1;
                                        });
                                    });

                                    const gratitudeDays = thisMonthData.filter(log => log.gratitude).length;
                                    const charityDays = thisMonthData.filter(log => log.charity).length;
                                    const judgmentDays = thisMonthData.filter(log => log.judgedOthers).length;
                                    const angerDays = dailyLogs.filter(log => {
                                        const logDate = new Date(log.date);
                                        return logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear && log.feltAnger;
                                    }).length;
                                    const gossipDays = dailyLogs.filter(log => {
                                        const logDate = new Date(log.date);
                                        return logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear && log.gossiped;
                                    }).length;
                                    
                                    // Calcula dias com protocolo completo (3 medita√ß√µes essenciais)
                                    const completeDays = dailyLogs.filter(log => {
                                        const logDate = new Date(log.date);
                                        if (logDate.getMonth() !== currentMonth || logDate.getFullYear() !== currentYear) return false;
                                        const hasLimpeza = log.meditations?.some(m => m.type === 'limpeza-propria');
                                        const hasProtecao = log.meditations?.some(m => m.type === 'protecao');
                                        const hasConexao = log.meditations?.some(m => m.type === 'conexao');
                                        return hasLimpeza && hasProtecao && hasConexao;
                                    }).length;
                                    
                                    // M√âTRICAS HIST√ìRICAS (ALL TIME)
                                    const allTimeMeditations = dailyLogs.reduce((acc, log) => acc + (log.meditations?.length || 0), 0);
                                    const allTimeMinutes = dailyLogs.reduce((acc, log) => 
                                        acc + (log.meditations?.reduce((sum, med) => sum + med.minutes, 0) || 0), 0
                                    );
                                    const allTimeCompleteProtocols = dailyLogs.filter(log => {
                                        const hasLimpeza = log.meditations?.some(m => m.type === 'limpeza-propria');
                                        const hasProtecao = log.meditations?.some(m => m.type === 'protecao');
                                        const hasConexao = log.meditations?.some(m => m.type === 'conexao');
                                        return hasLimpeza && hasProtecao && hasConexao;
                                    }).length;
                                    const allTimeDaysWithMeditation = spiritualData.length;
                                    const firstMeditationDate = spiritualData.length > 0 ? new Date(spiritualData[0].date) : null;
                                    const daysSinceStart = firstMeditationDate ? 
                                        Math.round((new Date() - firstMeditationDate) / (1000 * 60 * 60 * 24)) : 0;
                                    
                                    // Conta por tipo (ALL TIME)
                                    const allTimeMeditationsByType = {
                                        'limpeza-propria': 0,
                                        'limpeza-ambiente': 0,
                                        'protecao': 0,
                                        'conexao': 0,
                                        'consagracao-cristais': 0
                                    };
                                    
                                    dailyLogs.forEach(log => {
                                        log.meditations?.forEach(med => {
                                            allTimeMeditationsByType[med.type] = (allTimeMeditationsByType[med.type] || 0) + 1;
                                        });
                                    });

                                    return (
                                        <>
                                            {/* Protocolo dos Filhos das Estrelas */}
                                            <div className="bg-gradient-to-br from-indigo-900/70 to-purple-900/70 backdrop-blur rounded-2xl p-6 border-4 border-indigo-400/50 shadow-2xl">
                                                <div className="text-center">
                                                    <h3 className="text-2xl font-bold text-indigo-200 mb-2 flex items-center justify-center gap-2">
                                                        ‚ú® Protocolo Filhos das Estrelas ‚ú®
                                                    </h3>
                                                    <p className="text-slate-300 text-sm mb-4">Conex√£o di√°ria com o Cosmos e o Universo</p>
                                                    <div className="text-6xl font-black text-cyan-300 mb-2">
                                                        {completeDays}
                                                    </div>
                                                    <div className="text-lg text-white font-bold">
                                                        Dias com Protocolo Completo este m√™s üéØ
                                                    </div>
                                                    <div className="text-sm text-slate-400 mt-2">
                                                        (Limpeza Pr√≥pria + Prote√ß√£o + Conex√£o)
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Menu de Visualiza√ß√£o de M√©tricas */}
                                            <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                                                <div className="flex items-center gap-4 flex-wrap">
                                                    <span className="text-slate-300 font-semibold">üìä Visualizar:</span>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => setSpiritualMetricsView('monthly')}
                                                            className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                                                spiritualMetricsView === 'monthly'
                                                                    ? 'bg-blue-600 text-white shadow-lg'
                                                                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                            }`}
                                                        >
                                                            üìÖ Este M√™s
                                                        </button>
                                                        <button
                                                            onClick={() => setSpiritualMetricsView('alltime')}
                                                            className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                                                spiritualMetricsView === 'alltime'
                                                                    ? 'bg-purple-600 text-white shadow-lg'
                                                                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                            }`}
                                                        >
                                                            üèÜ Todos os Tempos
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* M√©tricas do M√™s Atual */}
                                            {spiritualMetricsView === 'monthly' && (
                                                <div className="bg-gradient-to-br from-blue-900/50 to-cyan-900/50 backdrop-blur rounded-xl p-6 border border-blue-700/50">
                                                    <h3 className="text-xl font-bold mb-6 flex items-center">
                                                        <span className="mr-2 text-2xl">üìÖ</span>
                                                        Progresso deste M√™s
                                                    </h3>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                        <div className="bg-purple-800/30 rounded-lg p-4 text-center border border-purple-500/30">
                                                            <div className="text-4xl font-bold text-purple-300">
                                                                {totalMeditations}
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">üßò Medita√ß√µes</div>
                                                            <div className="text-xs text-slate-400 mt-1">Este m√™s</div>
                                                        </div>
                                                        <div className="bg-indigo-800/30 rounded-lg p-4 text-center border border-indigo-500/30">
                                                            <div className="text-4xl font-bold text-indigo-300">
                                                                {totalMinutes}
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">‚è±Ô∏è Minutos</div>
                                                            <div className="text-xs text-slate-400 mt-1">Este m√™s</div>
                                                        </div>
                                                        <div className="bg-green-800/30 rounded-lg p-4 text-center border border-green-500/30">
                                                            <div className="text-4xl font-bold text-green-300">
                                                                {gratitudeDays}
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">üôè Gratid√£o</div>
                                                            <div className="text-xs text-slate-400 mt-1">Dias este m√™s</div>
                                                        </div>
                                                        <div className="bg-yellow-800/30 rounded-lg p-4 text-center border border-yellow-500/30">
                                                            <div className="text-4xl font-bold text-yellow-300">
                                                                {charityDays}
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">üíù Caridade</div>
                                                            <div className="text-xs text-slate-400 mt-1">Dias este m√™s</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* M√©tricas Hist√≥ricas ALL TIME */}
                                            {spiritualMetricsView === 'alltime' && allTimeMeditations > 0 && (
                                                <div className="bg-gradient-to-br from-purple-900/50 to-pink-900/50 backdrop-blur rounded-xl p-6 border-2 border-purple-500/50 shadow-xl">
                                                    <h3 className="text-2xl font-bold mb-6 flex items-center">
                                                        <span className="mr-2 text-3xl">üèÜ</span>
                                                        Legado Espiritual - TOTAIS (Desde o In√≠cio)
                                                    </h3>
                                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                                                        <div className="bg-purple-800/40 rounded-lg p-4 text-center border-2 border-purple-400/40">
                                                            <div className="text-5xl font-black text-purple-300 mb-2">
                                                                {allTimeMeditations}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">‚ú® Medita√ß√µes</div>
                                                            <div className="text-xs text-purple-200 mt-1">TOTAL HIST√ìRICO</div>
                                                        </div>
                                                        <div className="bg-indigo-800/40 rounded-lg p-4 text-center border-2 border-indigo-400/40">
                                                            <div className="text-5xl font-black text-indigo-300 mb-2">
                                                                {allTimeCompleteProtocols}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">üéØ Protocolos</div>
                                                            <div className="text-xs text-indigo-200 mt-1">TOTAL HIST√ìRICO</div>
                                                        </div>
                                                        <div className="bg-cyan-800/40 rounded-lg p-4 text-center border-2 border-cyan-400/40">
                                                            <div className="text-5xl font-black text-cyan-300 mb-2">
                                                                {Math.floor(allTimeMinutes / 60)}h
                                                            </div>
                                                            <div className="text-sm font-bold text-white">‚è±Ô∏è Tempo</div>
                                                            <div className="text-xs text-cyan-200 mt-1">TOTAL: {allTimeMinutes} min</div>
                                                        </div>
                                                        <div className="bg-blue-800/40 rounded-lg p-4 text-center border-2 border-blue-400/40">
                                                            <div className="text-5xl font-black text-blue-300 mb-2">
                                                                {allTimeDaysWithMeditation}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">üìÖ Dias</div>
                                                            <div className="text-xs text-blue-200 mt-1">PRATICADOS</div>
                                                        </div>
                                                        <div className="bg-pink-800/40 rounded-lg p-4 text-center border-2 border-pink-400/40">
                                                            <div className="text-5xl font-black text-pink-300 mb-2">
                                                                {daysSinceStart}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">üåü Jornada</div>
                                                            <div className="text-xs text-pink-200 mt-1">DIAS TOTAIS</div>
                                                        </div>
                                                    </div>
                                                    <div className="mt-4 text-center p-3 bg-gradient-to-r from-purple-900/50 to-pink-900/50 rounded-lg border border-purple-400/30">
                                                        <p className="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-pink-300">
                                                            {allTimeMinutes >= 10000 ? 'üåå Voc√™ est√° alcan√ßando a consci√™ncia c√≥smica!' : 
                                                             allTimeMinutes >= 5000 ? '‚ú® Sua conex√£o com o universo √© PROFUNDA!' :
                                                             allTimeMinutes >= 1000 ? 'üßò Voc√™ est√° no CAMINHO PARA CASA!' :
                                                             allTimeMinutes >= 500 ? 'üåü Continue sua jornada espiritual!' :
                                                             'üí´ Todos aqueles que voltaram para casa come√ßaram como voc√™!'}
                                                        </p>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Meditation Types Breakdown */}
                                            {(() => {
                                                const displayTypes = spiritualMetricsView === 'monthly' ? meditationsByType : allTimeMeditationsByType;
                                                const displayTotal = spiritualMetricsView === 'monthly' ? totalMeditations : allTimeMeditations;
                                                
                                                return (
                                                    <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                        <h3 className="text-xl font-bold mb-6 flex items-center">
                                                            <span className="mr-2 text-2xl">üìä</span>
                                                            Tipos de Medita√ß√£o ({spiritualMetricsView === 'monthly' ? 'Este M√™s' : 'Todos os Tempos'})
                                                        </h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div className="bg-blue-900/30 rounded-lg p-4 border border-blue-500/30">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex flex-col">
                                                                        <span className="text-blue-200 font-semibold">üßº Limpeza Pr√≥pria</span>
                                                                        <span className="text-xs text-blue-300 mt-1">‚≠ê Di√°ria - Essencial do Protocolo</span>
                                                                    </div>
                                                                    <span className="text-2xl font-bold text-blue-300">{displayTypes['limpeza-propria']}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-gradient-to-r from-blue-500 to-cyan-400 h-2 rounded-full transition-all"
                                                                        style={{width: `${(displayTypes['limpeza-propria'] / displayTotal * 100) || 0}%`}}
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div className="bg-amber-900/30 rounded-lg p-4 border border-amber-500/30">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex flex-col">
                                                                        <span className="text-amber-200 font-semibold">üõ°Ô∏è Prote√ß√£o</span>
                                                                        <span className="text-xs text-amber-300 mt-1">‚≠ê Di√°ria - Essencial do Protocolo</span>
                                                                    </div>
                                                                    <span className="text-2xl font-bold text-amber-300">{displayTypes['protecao']}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-gradient-to-r from-amber-500 to-yellow-400 h-2 rounded-full transition-all"
                                                                        style={{width: `${(displayTypes['protecao'] / displayTotal * 100) || 0}%`}}
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div className="bg-purple-900/30 rounded-lg p-4 border border-purple-500/30">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex flex-col">
                                                                        <span className="text-purple-200 font-semibold">‚ú® Conex√£o</span>
                                                                        <span className="text-xs text-purple-300 mt-1">‚≠ê Di√°ria - Essencial do Protocolo</span>
                                                                    </div>
                                                                    <span className="text-2xl font-bold text-purple-300">{displayTypes['conexao']}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-gradient-to-r from-purple-500 to-pink-400 h-2 rounded-full transition-all"
                                                                        style={{width: `${(displayTypes['conexao'] / displayTotal * 100) || 0}%`}}
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div className="bg-green-900/30 rounded-lg p-4 border border-green-500/30">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex flex-col">
                                                                        <span className="text-green-200 font-semibold">üè† Limpeza de Ambiente</span>
                                                                        <span className="text-xs text-green-300 mt-1">üìÖ 1x por semana (Domingos)</span>
                                                                    </div>
                                                                    <span className="text-2xl font-bold text-green-300">{displayTypes['limpeza-ambiente']}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-gradient-to-r from-green-500 to-emerald-400 h-2 rounded-full transition-all"
                                                                        style={{width: `${(displayTypes['limpeza-ambiente'] / displayTotal * 100) || 0}%`}}
                                                                    />
                                                                </div>
                                                            </div>
                                                            <div className="bg-pink-900/30 rounded-lg p-4 border border-pink-500/30 md:col-span-2">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex flex-col">
                                                                        <span className="text-pink-200 font-semibold">üíé Consagra√ß√£o de Cristais</span>
                                                                        <span className="text-xs text-pink-300 mt-1">üåô Ritual Especial: 1x por m√™s (Primeiro Domingo)</span>
                                                                    </div>
                                                                    <span className="text-2xl font-bold text-pink-300">{displayTypes['consagracao-cristais']}</span>
                                                                </div>
                                                                <div className="w-full bg-slate-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-gradient-to-r from-pink-500 to-rose-400 h-2 rounded-full transition-all"
                                                                        style={{width: `${(displayTypes['consagracao-cristais'] / displayTotal * 100) || 0}%`}}
                                                                    />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })()}

                                            {/* Calend√°rio de Consist√™ncia */}
                                            <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                <h3 className="text-xl font-bold mb-6 flex items-center">
                                                    <span className="mr-2 text-2xl">üìÖ</span>
                                                    Calend√°rio de Consist√™ncia (√öltimos 30 dias)
                                                </h3>
                                                <div className="grid grid-cols-10 gap-1">
                                                    {(() => {
                                                        const last30Days = [];
                                                        for (let i = 29; i >= 0; i--) {
                                                            const date = new Date();
                                                            date.setDate(date.getDate() - i);
                                                            const dateStr = date.toISOString().split('T')[0];
                                                            const dayLog = dailyLogs.find(log => log.date === dateStr);
                                                            
                                                            const hasProtocol = dayLog && dayLog.meditations &&
                                                                dayLog.meditations.some(m => m.type === 'limpeza-propria') &&
                                                                dayLog.meditations.some(m => m.type === 'protecao') &&
                                                                dayLog.meditations.some(m => m.type === 'conexao');
                                                            
                                                            const hasSomeMeditation = dayLog && dayLog.meditations && dayLog.meditations.length > 0;
                                                            const hasNegativeEnergy = dayLog && (dayLog.feltAnger || dayLog.gossiped || dayLog.judgedOthers);
                                                            
                                                            let bgColor = 'bg-slate-700/30'; // Sem registro
                                                            let title = 'Sem registro';
                                                            
                                                            if (hasProtocol && !hasNegativeEnergy) {
                                                                bgColor = 'bg-green-500';
                                                                title = 'Protocolo completo + energia limpa';
                                                            } else if (hasProtocol && hasNegativeEnergy) {
                                                                bgColor = 'bg-yellow-500';
                                                                title = 'Protocolo completo mas com energia densa';
                                                            } else if (hasSomeMeditation && !hasNegativeEnergy) {
                                                                bgColor = 'bg-blue-500';
                                                                title = 'Algumas medita√ß√µes';
                                                            } else if (hasSomeMeditation && hasNegativeEnergy) {
                                                                bgColor = 'bg-orange-500';
                                                                title = 'Medita√ß√£o parcial + energia densa';
                                                            } else if (hasNegativeEnergy) {
                                                                bgColor = 'bg-red-500';
                                                                title = 'Energia densa sem pr√°ticas';
                                                            }
                                                            
                                                            last30Days.push(
                                                                <div
                                                                    key={dateStr}
                                                                    className={`w-full aspect-square rounded ${bgColor} transition-all hover:scale-110 cursor-pointer`}
                                                                    title={`${date.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'})} - ${title}`}
                                                                />
                                                            );
                                                        }
                                                        return last30Days;
                                                    })()}
                                                </div>
                                                <div className="mt-4 flex flex-wrap gap-3 text-xs">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded"></div>
                                                        <span className="text-slate-300">Protocolo completo</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-yellow-500 rounded"></div>
                                                        <span className="text-slate-300">Completo + energia densa</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-blue-500 rounded"></div>
                                                        <span className="text-slate-300">Parcial limpo</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-orange-500 rounded"></div>
                                                        <span className="text-slate-300">Parcial denso</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-red-500 rounded"></div>
                                                        <span className="text-slate-300">S√≥ energia densa</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-slate-700/30 rounded"></div>
                                                        <span className="text-slate-300">Sem registro</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* An√°lise de Consist√™ncia e For√ßa Espiritual */}
                                            {spiritualData.length >= 7 && (() => {
                                                const last7Days = dailyLogs.slice(0, 7);
                                                const protocolStreak = last7Days.filter(log => {
                                                    const hasLimpeza = log.meditations?.some(m => m.type === 'limpeza-propria');
                                                    const hasProtecao = log.meditations?.some(m => m.type === 'protecao');
                                                    const hasConexao = log.meditations?.some(m => m.type === 'conexao');
                                                    return hasLimpeza && hasProtecao && hasConexao;
                                                }).length;
                                                
                                                const avgMinutes = last7Days.reduce((acc, log) => 
                                                    acc + (log.meditations?.reduce((sum, med) => sum + med.minutes, 0) || 0), 0
                                                ) / 7;
                                                
                                                const consistency = (protocolStreak / 7) * 100;
                                                
                                                return (
                                                    <div className="bg-gradient-to-br from-cyan-900/50 to-blue-900/50 backdrop-blur rounded-xl p-6 border border-cyan-700/50">
                                                        <h3 className="text-xl font-bold mb-4 flex items-center text-cyan-200">
                                                            <span className="mr-2 text-2xl">üìà</span>
                                                            For√ßa Espiritual (√öltima Semana)
                                                        </h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                            <div className="bg-cyan-800/30 rounded-lg p-4 text-center border border-cyan-500/30">
                                                                <div className="text-4xl font-bold text-cyan-300">
                                                                    {consistency.toFixed(0)}%
                                                                </div>
                                                                <div className="text-xs text-slate-300 mt-2">Consist√™ncia</div>
                                                                <div className="text-xs text-slate-400 mt-1">{protocolStreak}/7 dias</div>
                                                            </div>
                                                            <div className="bg-blue-800/30 rounded-lg p-4 text-center border border-blue-500/30">
                                                                <div className="text-4xl font-bold text-blue-300">
                                                                    {avgMinutes.toFixed(0)}
                                                                </div>
                                                                <div className="text-xs text-slate-300 mt-2">Minutos/dia (m√©dia)</div>
                                                            </div>
                                                            <div className={`rounded-lg p-4 text-center border ${
                                                                consistency >= 85 ? 'bg-green-800/30 border-green-500/30' :
                                                                consistency >= 60 ? 'bg-yellow-800/30 border-yellow-500/30' :
                                                                'bg-red-800/30 border-red-500/30'
                                                            }`}>
                                                                <div className={`text-4xl font-bold ${
                                                                    consistency >= 85 ? 'text-green-300' :
                                                                    consistency >= 60 ? 'text-yellow-300' :
                                                                    'text-red-300'
                                                                }`}>
                                                                    {consistency >= 85 ? 'üí™ Forte' : consistency >= 60 ? 'üå± Crescendo' : '‚ö†Ô∏è Fraca'}
                                                                </div>
                                                                <div className="text-xs text-slate-300 mt-2">Prote√ß√£o Energ√©tica</div>
                                                            </div>
                                                        </div>
                                                        <div className="mt-4 p-3 bg-slate-800/50 rounded-lg border-l-4 border-cyan-400">
                                                            <p className="text-xs text-cyan-200">
                                                                {consistency >= 85 ? '‚ú® Excelente! Seu campo energ√©tico est√° muito protegido. Continue assim!' :
                                                                 consistency >= 60 ? 'üåü Bom trabalho! Mais alguns dias consistentes e voc√™ ter√° prote√ß√£o m√°xima.' :
                                                                 'üí´ Foque no protocolo di√°rio. Sua prote√ß√£o est√° fr√°gil e voc√™ pode estar vulner√°vel a energias densas.'}
                                                            </p>
                                                        </div>
                                                    </div>
                                                );
                                            })()}

                                            {/* Shadow Work & Energy Cleansing Alerts */}
                                            {(judgmentDays > 0 || angerDays > 0 || gossipDays > 0) && (
                                                <div className="bg-gradient-to-br from-red-900/50 to-orange-900/50 backdrop-blur rounded-xl p-6 border border-red-700/50">
                                                    <h3 className="text-xl font-bold mb-4 flex items-center text-red-300">
                                                        <span className="mr-2 text-2xl">‚ö†Ô∏è</span>
                                                        Limpeza Energ√©tica Necess√°ria
                                                    </h3>
                                                    <div className="space-y-3 text-slate-200">
                                                        {judgmentDays > 0 && (
                                                            <div className="p-3 bg-red-900/30 rounded-lg border border-red-500/30">
                                                                <div className="font-bold text-red-300">‚öñÔ∏è Julgamento</div>
                                                                <p className="text-sm mt-1">
                                                                    {judgmentDays} dia{judgmentDays > 1 ? 's' : ''} - A autoconsci√™ncia √© o primeiro passo. 
                                                                    Reconecte-se com a compaix√£o atrav√©s da medita√ß√£o de limpeza.
                                                                </p>
                                                            </div>
                                                        )}
                                                        {angerDays > 0 && (
                                                            <div className="p-3 bg-orange-900/30 rounded-lg border border-orange-500/30">
                                                                <div className="font-bold text-orange-300">üò§ Raiva/Ira</div>
                                                                <p className="text-sm mt-1">
                                                                    {angerDays} dia{angerDays > 1 ? 's' : ''} - Energia densa detectada. 
                                                                    Transmute atrav√©s de limpeza pr√≥pria e prote√ß√£o energ√©tica.
                                                                </p>
                                                            </div>
                                                        )}
                                                        {gossipDays > 0 && (
                                                            <div className="p-3 bg-yellow-900/30 rounded-lg border border-yellow-500/30">
                                                                <div className="font-bold text-yellow-300">üó£Ô∏è Fofoca</div>
                                                                <p className="text-sm mt-1">
                                                                    {gossipDays} dia{gossipDays > 1 ? 's' : ''} - A energia da palavra precisa ser limpa. 
                                                                    Pratique limpeza do ambiente e conex√£o com o cosmos.
                                                                </p>
                                                            </div>
                                                        )}
                                                        <div className="mt-4 p-3 bg-indigo-900/40 border border-indigo-500/40 rounded-lg">
                                                            <div className="font-bold text-indigo-200 mb-2">üí° Recomenda√ß√£o dos Filhos das Estrelas:</div>
                                                            <p className="text-xs">
                                                                Fa√ßa limpezas extras nos dias em que detectar essas energias. 
                                                                O protocolo di√°rio (Limpeza + Prote√ß√£o + Conex√£o) vai te ajudar a transmutar essas frequ√™ncias.
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Journal Espiritual - Calend√°rio Clic√°vel */}
                                            {spiritualData.length > 0 && (() => {
                                                const changeMonth = (delta) => {
                                                    const newDate = new Date(spiritualJournalDate.year, spiritualJournalDate.month + delta);
                                                    setSpiritualJournalDate({ year: newDate.getFullYear(), month: newDate.getMonth() });
                                                    setSelectedSpiritualDay(null);
                                                };
                                                
                                                const monthName = new Date(spiritualJournalDate.year, spiritualJournalDate.month).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                                                
                                                // Gerar dias do calend√°rio
                                                const firstDay = new Date(spiritualJournalDate.year, spiritualJournalDate.month, 1);
                                                const lastDay = new Date(spiritualJournalDate.year, spiritualJournalDate.month + 1, 0);
                                                const startDayOfWeek = firstDay.getDay();
                                                const daysInMonth = lastDay.getDate();
                                                
                                                // Criar array de dias (incluindo dias do m√™s anterior para preencher)
                                                const calendarDays = [];
                                                for (let i = 0; i < startDayOfWeek; i++) {
                                                    calendarDays.push(null);
                                                }
                                                for (let day = 1; day <= daysInMonth; day++) {
                                                    calendarDays.push(day);
                                                }
                                                
                                                // Mapear dados por data
                                                const dataByDate = {};
                                                spiritualData.forEach(log => {
                                                    dataByDate[log.date] = log;
                                                });
                                                
                                                // Obter log do dia selecionado
                                                const selectedLog = selectedSpiritualDay ? dataByDate[selectedSpiritualDay] : null;
                                                
                                                return (
                                                <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                    <div className="flex items-center justify-between mb-6">
                                                        <h3 className="text-xl font-bold flex items-center">
                                                            <span className="mr-2 text-2xl">üìñ</span>
                                                            Journal Espiritual
                                                        </h3>
                                                        
                                                        {/* Datepicker - Seletor de M√™s/Ano */}
                                                        <div className="flex items-center gap-3">
                                                            {/* Seletor de M√™s */}
                                                            <select
                                                                value={spiritualJournalDate.month}
                                                                onChange={(e) => {
                                                                    setSpiritualJournalDate({
                                                                        ...spiritualJournalDate,
                                                                        month: parseInt(e.target.value)
                                                                    });
                                                                    setSelectedSpiritualDay(null);
                                                                }}
                                                                className="bg-slate-700 border border-slate-600 text-slate-200 rounded-lg px-3 py-2 text-sm font-semibold cursor-pointer hover:bg-slate-600 transition-colors focus:ring-2 focus:ring-purple-500 focus:outline-none"
                                                            >
                                                                {[
                                                                    'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                                                                    'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
                                                                ].map((month, idx) => (
                                                                    <option key={idx} value={idx}>{month}</option>
                                                                ))}
                                                            </select>
                                                            
                                                            {/* Seletor de Ano */}
                                                            <select
                                                                value={spiritualJournalDate.year}
                                                                onChange={(e) => {
                                                                    setSpiritualJournalDate({
                                                                        ...spiritualJournalDate,
                                                                        year: parseInt(e.target.value)
                                                                    });
                                                                    setSelectedSpiritualDay(null);
                                                                }}
                                                                className="bg-slate-700 border border-slate-600 text-slate-200 rounded-lg px-3 py-2 text-sm font-semibold cursor-pointer hover:bg-slate-600 transition-colors focus:ring-2 focus:ring-purple-500 focus:outline-none"
                                                            >
                                                                {(() => {
                                                                    const currentYear = new Date().getFullYear();
                                                                    const years = [];
                                                                    for (let y = currentYear; y >= currentYear - 5; y--) {
                                                                        years.push(y);
                                                                    }
                                                                    return years.map(year => (
                                                                        <option key={year} value={year}>{year}</option>
                                                                    ));
                                                                })()}
                                                            </select>
                                                            
                                                            {/* Bot√£o Hoje */}
                                                            <button
                                                                onClick={() => {
                                                                    const now = new Date();
                                                                    setSpiritualJournalDate({ 
                                                                        year: now.getFullYear(), 
                                                                        month: now.getMonth() 
                                                                    });
                                                                    setSelectedSpiritualDay(null);
                                                                }}
                                                                className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
                                                                title="Voltar para o m√™s atual"
                                                            >
                                                                üìÖ Hoje
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Estat√≠sticas do Per√≠odo */}
                                                    {(() => {
                                                        const monthData = spiritualData.filter(log => {
                                                            const d = new Date(log.date);
                                                            return d.getFullYear() === spiritualJournalDate.year && 
                                                                   d.getMonth() === spiritualJournalDate.month;
                                                        });
                                                        
                                                        const daysWithProtocol = monthData.filter(log => 
                                                            log.meditations?.some(m => m.type === 'limpeza-propria') &&
                                                            log.meditations?.some(m => m.type === 'protecao') &&
                                                            log.meditations?.some(m => m.type === 'conexao')
                                                        ).length;
                                                        
                                                        const totalMinutes = monthData.reduce((sum, log) => 
                                                            sum + (log.meditations?.reduce((s, m) => s + m.minutes, 0) || 0), 0
                                                        );
                                                        
                                                        return monthData.length > 0 ? (
                                                            <div className="grid grid-cols-3 gap-3 mb-6">
                                                                <div className="bg-slate-700/30 rounded-lg p-3 border border-slate-600/50">
                                                                    <div className="text-xs text-slate-400 mb-1">Dias Registrados</div>
                                                                    <div className="text-2xl font-bold text-purple-400">{monthData.length}</div>
                                                                </div>
                                                                <div className="bg-slate-700/30 rounded-lg p-3 border border-slate-600/50">
                                                                    <div className="text-xs text-slate-400 mb-1">Protocolo Completo</div>
                                                                    <div className="text-2xl font-bold text-green-400">{daysWithProtocol}</div>
                                                                </div>
                                                                <div className="bg-slate-700/30 rounded-lg p-3 border border-slate-600/50">
                                                                    <div className="text-xs text-slate-400 mb-1">Minutos Totais</div>
                                                                    <div className="text-2xl font-bold text-cyan-400">{totalMinutes}</div>
                                                                </div>
                                                            </div>
                                                        ) : null;
                                                    })()}
                                                    
                                                    {/* Calend√°rio estilo GitHub */}
                                                    <div className="mb-6">
                                                        {/* Dias da semana */}
                                                        <div className="grid grid-cols-7 gap-2 mb-2">
                                                            {['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'].map(day => (
                                                                <div key={day} className="text-xs text-slate-400 text-center font-semibold">
                                                                    {day}
                                                                </div>
                                                            ))}
                                                        </div>
                                                        
                                                        {/* Grid de dias */}
                                                        <div className="grid grid-cols-7 gap-2">
                                                            {calendarDays.map((day, idx) => {
                                                                if (day === null) {
                                                                    return <div key={`empty-${idx}`} className="aspect-square"></div>;
                                                                }
                                                                
                                                                const dateStr = `${spiritualJournalDate.year}-${String(spiritualJournalDate.month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                                                const log = dataByDate[dateStr];
                                                                const isSelected = selectedSpiritualDay === dateStr;
                                                                const isToday = dateStr === new Date().toISOString().split('T')[0];
                                                                
                                                                // Calcular qualidade do dia baseado nas pr√°ticas
                                                                let quality = 'none';
                                                                if (log) {
                                                                    // Verificar se √© dia de jejum (prioridade m√°xima)
                                                                    if (log.isFasting) {
                                                                        quality = 'fasting'; // Roxo para jejum
                                                                    } else {
                                                                        const hasProtocol = log.meditations?.some(m => m.type === 'limpeza-propria') &&
                                                                                          log.meditations?.some(m => m.type === 'protecao') &&
                                                                                          log.meditations?.some(m => m.type === 'conexao');
                                                                        const totalMinutes = log.meditations?.reduce((sum, med) => sum + med.minutes, 0) || 0;
                                                                        const hasNegative = log.judgedOthers || log.feltAnger || log.gossiped;
                                                                        
                                                                        if (hasProtocol && totalMinutes >= 60 && !hasNegative && log.gratitude) {
                                                                            quality = 'excellent'; // Verde escuro
                                                                        } else if (hasProtocol && totalMinutes >= 40) {
                                                                            quality = 'good'; // Verde m√©dio
                                                                        } else if (log.meditations?.length > 0) {
                                                                            quality = 'ok'; // Verde claro
                                                                        } else {
                                                                            quality = 'poor'; // Vermelho
                                                                        }
                                                                    }
                                                                }
                                                                
                                                                const colorClasses = {
                                                                    none: 'bg-slate-700/30 border-slate-600/30',
                                                                    poor: 'bg-red-900/40 border-red-500/50',
                                                                    ok: 'bg-green-900/30 border-green-500/40',
                                                                    good: 'bg-green-700/50 border-green-400/60',
                                                                    excellent: 'bg-green-500/60 border-green-300/70',
                                                                    fasting: 'bg-purple-600/60 border-purple-400/70 ring-1 ring-purple-300'
                                                                };
                                                                
                                                                return (
                                                                    <button
                                                                        key={day}
                                                                        onClick={() => setSelectedSpiritualDay(log ? dateStr : null)}
                                                                        disabled={!log}
                                                                        className={`aspect-square rounded-lg border-2 transition-all flex items-center justify-center text-sm font-semibold
                                                                            ${colorClasses[quality]}
                                                                            ${isSelected ? 'ring-2 ring-purple-400 scale-110' : ''}
                                                                            ${isToday ? 'ring-2 ring-cyan-400' : ''}
                                                                            ${log ? 'hover:scale-110 cursor-pointer' : 'cursor-default opacity-40'}
                                                                        `}
                                                                        title={log ? `${day} - ${log.meditations?.length || 0} medita√ß√µes` : `${day} - Sem registro`}
                                                                    >
                                                                        {day}
                                                                    </button>
                                                                );
                                                            })}
                                                        </div>
                                                        
                                                        {/* Legenda */}
                                                        <div className="flex flex-wrap items-center gap-4 mt-4 text-xs">
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 rounded bg-purple-600/60 border-2 border-purple-400/70 ring-1 ring-purple-300"></div>
                                                                <span className="text-slate-300">üî• Jejum 24h</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 rounded bg-green-500/60 border-2 border-green-300/70"></div>
                                                                <span className="text-slate-300">Excelente (60+ min, protocolo completo)</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 rounded bg-green-700/50 border-2 border-green-400/60"></div>
                                                                <span className="text-slate-300">Bom (40+ min, protocolo)</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 rounded bg-green-900/30 border-2 border-green-500/40"></div>
                                                                <span className="text-slate-300">OK (alguma pr√°tica)</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 rounded bg-red-900/40 border-2 border-red-500/50"></div>
                                                                <span className="text-slate-300">Incompleto</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 rounded bg-slate-700/30 border-2 border-slate-600/30"></div>
                                                                <span className="text-slate-300">Sem registro</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Detalhes do dia selecionado */}
                                                    {selectedLog && (() => {
                                                        const log = selectedLog;
                                                        const hasProtocol = log.meditations?.some(m => m.type === 'limpeza-propria') &&
                                                                          log.meditations?.some(m => m.type === 'protecao') &&
                                                                          log.meditations?.some(m => m.type === 'conexao');
                                                        const totalMinutes = log.meditations?.reduce((sum, med) => sum + med.minutes, 0) || 0;
                                                        
                                                        return (
                                                            <div className="bg-slate-700/30 rounded-lg p-4 border border-slate-600/50 border-purple-500/70 shadow-lg"
                                                                key={log.id}>
                                                                    <div className="flex items-start justify-between mb-3">
                                                                        <div>
                                                                            <div className="font-bold text-white flex items-center gap-2">
                                                                                üìÖ {new Date(log.date).toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long' })}
                                                                                {hasProtocol && <span className="text-xs bg-green-500/20 text-green-300 px-2 py-1 rounded border border-green-500/30">Protocolo ‚úì</span>}
                                                                            </div>
                                                                            <div className="text-xs text-slate-400 mt-1">
                                                                                {log.meditations?.length || 0} medita√ß√µes ‚Ä¢ {totalMinutes} minutos
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {/* Medita√ß√µes do dia */}
                                                                    <div className="flex flex-wrap gap-2 mb-3">
                                                                        {log.meditations?.map((med, idx) => (
                                                                            <div key={idx} className="text-xs bg-purple-900/30 text-purple-200 px-3 py-1 rounded-full border border-purple-500/30">
                                                                                {med.type === 'limpeza-propria' && 'üßº Limpeza Pr√≥pria'}
                                                                                {med.type === 'limpeza-ambiente' && 'üè† Limpeza Ambiente'}
                                                                                {med.type === 'protecao' && 'üõ°Ô∏è Prote√ß√£o'}
                                                                                {med.type === 'conexao' && '‚ú® Conex√£o'}
                                                                                {med.type === 'consagracao-cristais' && 'üíé Consagra√ß√£o'}
                                                                                {' ‚Ä¢ '}
                                                                                <span className="font-semibold">{med.minutes}min</span>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                    
                                                                    {/* Pr√°ticas adicionais */}
                                                                    <div className="flex flex-wrap gap-2 mb-3 text-xs">
                                                                        {log.gratitude && <span className="bg-green-900/30 text-green-300 px-2 py-1 rounded border border-green-500/30">üôè Gratid√£o</span>}
                                                                        {log.charity && <span className="bg-yellow-900/30 text-yellow-300 px-2 py-1 rounded border border-yellow-500/30">üíù Caridade</span>}
                                                                        {log.judgedOthers && <span className="bg-red-900/30 text-red-300 px-2 py-1 rounded border border-red-500/30">‚öñÔ∏è Julgamento</span>}
                                                                        {log.feltAnger && <span className="bg-orange-900/30 text-orange-300 px-2 py-1 rounded border border-orange-500/30">üò§ Raiva</span>}
                                                                        {log.gossiped && <span className="bg-amber-900/30 text-amber-300 px-2 py-1 rounded border border-amber-500/30">üó£Ô∏è Fofoca</span>}
                                                                    </div>
                                                                    
                                                                    {/* Journal notes */}
                                                                    {log.spiritualNotes && (
                                                                        <div className="bg-slate-800/50 rounded p-3 border-l-4 border-purple-500">
                                                                            <div className="text-xs text-purple-300 font-semibold mb-1">Reflex√µes:</div>
                                                                            <div className="text-sm text-slate-300 italic">{log.spiritualNotes}</div>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            );
                                                        })()}
                                                    
                                                    {!selectedLog && (
                                                        <div className="text-center py-8 text-slate-400 bg-slate-700/20 rounded-lg border border-slate-600/30">
                                                            <p className="text-sm">Clique em um dia do calend√°rio para ver os detalhes</p>
                                                        </div>
                                                    )}
                                                </div>
                                                );
                                            })()}

                                            {spiritualMetricsView === 'monthly' && totalMeditations === 0 && (
                                                <div className="text-center py-12 text-slate-400 bg-slate-800/50 rounded-xl p-8 border border-slate-700">
                                                    <span className="text-6xl mb-4 block">üßò</span>
                                                    <p className="text-lg mb-2">Nenhuma medita√ß√£o registrada este m√™s</p>
                                                    <p className="text-sm">Comece sua jornada espiritual registrando suas pr√°ticas di√°rias!</p>
                                                </div>
                                            )}
                                            
                                            {spiritualMetricsView === 'alltime' && allTimeMeditations === 0 && (
                                                <div className="text-center py-12 text-slate-400 bg-slate-800/50 rounded-xl p-8 border border-slate-700">
                                                    <span className="text-6xl mb-4 block">üßò</span>
                                                    <p className="text-lg mb-2">Nenhuma medita√ß√£o registrada ainda</p>
                                                    <p className="text-sm">Comece sua jornada espiritual registrando suas pr√°ticas di√°rias!</p>
                                                </div>
                                            )}
                                        </>
                                    );
                                })()}
                            </div>
                        )}

                        {/* NoFap Tab */}
                        {activeTab === 'nofap' && nofapModeEnabled && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold flex items-center">
                                    <span className="mr-3 text-3xl">üí™</span>
                                    Jornada NoFap
                                </h2>

                                {/* Lembretes e Estrat√©gias */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {/* Protocolo de Emerg√™ncia */}
                                    <div className="bg-gradient-to-br from-red-900/50 to-orange-900/50 backdrop-blur rounded-xl p-6 border-2 border-red-500/50">
                                        <h3 className="text-lg font-bold text-red-200 mb-3 flex items-center gap-2">
                                            üö® Protocolo de Emerg√™ncia
                                        </h3>
                                        <div className="space-y-3 text-sm text-slate-200">
                                            <p className="font-bold text-orange-300">
                                                Quando sentir um urge forte (7+):
                                            </p>
                                            <ol className="space-y-2 ml-4 list-decimal">
                                                <li><strong>20 flex√µes IMEDIATAMENTE</strong> - Redireciona a energia</li>
                                                <li><strong>Banho gelado</strong> - Reseta o sistema nervoso</li>
                                                <li><strong>Saia de casa</strong> - Caminhe 10 minutos</li>
                                                <li><strong>Ligue para algu√©m</strong> - Quebra o isolamento</li>
                                                <li><strong>Medita√ß√£o 5 min</strong> - Limpeza e prote√ß√£o</li>
                                            </ol>
                                            <div className="mt-4 p-3 bg-slate-800/50 rounded-lg border-l-4 border-red-400">
                                                <p className="text-xs text-red-200 font-bold">
                                                    ‚ö†Ô∏è O primeiro segundo ap√≥s o urge √© CR√çTICO. Aja R√ÅPIDO!
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Motivos Fundamentais */}
                                    <div className="bg-gradient-to-br from-blue-900/50 to-cyan-900/50 backdrop-blur rounded-xl p-6 border-2 border-cyan-500/50">
                                        <h3 className="text-lg font-bold text-cyan-200 mb-3 flex items-center gap-2">
                                            üéØ Seus Motivos Fundamentais
                                        </h3>
                                        <div className="space-y-3 text-sm text-slate-200">
                                            <p className="leading-relaxed">
                                                Por que voc√™ est√° fazendo isso?
                                            </p>
                                            <ul className="space-y-2 ml-4">
                                                <li className="flex items-start gap-2">
                                                    <span className="text-green-400 mt-1">‚úÖ</span>
                                                    <span><strong>Energia</strong> - Recupere sua vitalidade</span>
                                                </li>
                                                <li className="flex items-start gap-2">
                                                    <span className="text-blue-400 mt-1">üß†</span>
                                                    <span><strong>Clareza Mental</strong> - Dopamina regulada</span>
                                                </li>
                                                <li className="flex items-start gap-2">
                                                    <span className="text-purple-400 mt-1">üí™</span>
                                                    <span><strong>Autoconfian√ßa</strong> - Dom√≠nio pr√≥prio</span>
                                                </li>
                                                <li className="flex items-start gap-2">
                                                    <span className="text-pink-400 mt-1">‚ù§Ô∏è</span>
                                                    <span><strong>Conex√µes Reais</strong> - Rela√ß√µes aut√™nticas</span>
                                                </li>
                                            </ul>
                                            <div className="mt-4 p-3 bg-slate-800/50 rounded-lg border-l-4 border-cyan-400">
                                                <p className="text-xs text-cyan-200 italic">
                                                    "Escreva seus motivos em um papel. Leia toda manh√£ e toda vez que sentir um urge."
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Princ√≠pios Fundamentais */}
                                <div className="bg-gradient-to-r from-purple-900/30 to-blue-900/30 backdrop-blur rounded-xl p-6 border border-purple-700/50">
                                    <h3 className="text-xl font-bold text-purple-200 mb-4 flex items-center gap-2">
                                        ‚öîÔ∏è Os 5 Pilares da Transforma√ß√£o NoFap
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
                                        <div className="text-center p-4 bg-slate-800/30 rounded-lg border border-slate-600">
                                            <div className="text-3xl mb-2">üö´</div>
                                            <div className="text-sm font-bold text-white">Evite Gatilhos</div>
                                            <div className="text-xs text-slate-400 mt-1">M√≠dias sociais, filmes, solid√£o</div>
                                        </div>
                                        <div className="text-center p-4 bg-slate-800/30 rounded-lg border border-slate-600">
                                            <div className="text-3xl mb-2">üí™</div>
                                            <div className="text-sm font-bold text-white">Exerc√≠cio F√≠sico</div>
                                            <div className="text-xs text-slate-400 mt-1">Transmuta a energia</div>
                                        </div>
                                        <div className="text-center p-4 bg-slate-800/30 rounded-lg border border-slate-600">
                                            <div className="text-3xl mb-2">üßò</div>
                                            <div className="text-sm font-bold text-white">Medita√ß√£o</div>
                                            <div className="text-xs text-slate-400 mt-1">Controle mental</div>
                                        </div>
                                        <div className="text-center p-4 bg-slate-800/30 rounded-lg border border-slate-600">
                                            <div className="text-3xl mb-2">üë•</div>
                                            <div className="text-sm font-bold text-white">Comunidade</div>
                                            <div className="text-xs text-slate-400 mt-1">Voc√™ n√£o est√° sozinho</div>
                                        </div>
                                        <div className="text-center p-4 bg-slate-800/30 rounded-lg border border-slate-600">
                                            <div className="text-3xl mb-2">üéØ</div>
                                            <div className="text-sm font-bold text-white">Prop√≥sito</div>
                                            <div className="text-xs text-slate-400 mt-1">Redirecione sua energia</div>
                                        </div>
                                    </div>
                                </div>

                                {(() => {
                                    const nofapData = dailyLogs.filter(log => log.cleanDay !== undefined).sort((a, b) => new Date(b.date) - new Date(a.date));
                                    
                                    // Calcula streak atual
                                    let currentStreak = 0;
                                    for (const log of nofapData) {
                                        if (log.cleanDay) currentStreak++;
                                        else break;
                                    }
                                    
                                    // Calcula maior streak
                                    let longestStreak = 0;
                                    let tempStreak = 0;
                                    [...nofapData].reverse().forEach(log => {
                                        if (log.cleanDay) {
                                            tempStreak++;
                                            longestStreak = Math.max(longestStreak, tempStreak);
                                        } else {
                                            tempStreak = 0;
                                        }
                                    });

                                    // √öltimas 24h de urge alto
                                    const recentHighUrge = nofapData.slice(0, 7).filter(log => log.cleanDay && log.urgeLevel >= 7).length;
                                    
                                    // Total de reca√≠das
                                    const totalRelapses = nofapData.filter(log => !log.cleanDay).length;
                                    
                                    // M√™s atual
                                    const currentMonth = new Date().getMonth();
                                    const currentYear = new Date().getFullYear();
                                    const thisMonthData = nofapData.filter(log => {
                                        const logDate = new Date(log.date);
                                        return logDate.getMonth() === currentMonth && logDate.getFullYear() === currentYear;
                                    });
                                    const thisMonthClean = thisMonthData.filter(log => log.cleanDay).length;
                                    
                                    // M√âTRICAS ALL TIME
                                    const totalDaysTracked = nofapData.length;
                                    const totalCleanDays = nofapData.filter(log => log.cleanDay).length;
                                    const firstNofapDate = nofapData.length > 0 ? new Date(nofapData[nofapData.length - 1].date) : null;
                                    const daysSinceStartNofap = firstNofapDate ? 
                                        Math.round((new Date() - firstNofapDate) / (1000 * 60 * 60 * 24)) : 0;
                                    const successRate = totalDaysTracked > 0 ? (totalCleanDays / totalDaysTracked * 100) : 0;

                                    return (
                                        <>
                                            {/* Main Streak Banner */}
                                            <div className="bg-gradient-to-br from-cyan-900/70 to-blue-900/70 backdrop-blur rounded-2xl p-8 border-4 border-cyan-500/50 shadow-2xl">
                                                <div className="text-center">
                                                    <div className="text-7xl font-black text-cyan-300 mb-2 drop-shadow-lg">
                                                        {currentStreak}
                                                    </div>
                                                    <div className="text-2xl text-white font-bold mb-4">
                                                        {currentStreak === 0 ? 'Comece Hoje!' : currentStreak === 1 ? 'Dia Limpo!' : 'Dias Limpos! üî•'}
                                                    </div>
                                                    {currentStreak > 0 && (
                                                        <div className="flex items-center justify-center gap-6 mt-6">
                                                            <div className="text-center">
                                                                <div className="text-3xl font-bold text-yellow-300">üèÜ {longestStreak}</div>
                                                                <div className="text-xs text-slate-300 mt-1">Melhor Streak</div>
                                                            </div>
                                                            <div className="h-12 w-px bg-slate-500"></div>
                                                            <div className="text-center">
                                                                <div className="text-3xl font-bold text-green-300">‚úÖ {thisMonthClean}</div>
                                                                <div className="text-xs text-slate-300 mt-1">Dias Limpos (M√™s)</div>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Menu de Visualiza√ß√£o de M√©tricas NoFap */}
                                            {totalDaysTracked > 0 && (
                                                <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                                                    <div className="flex items-center gap-4 flex-wrap">
                                                        <span className="text-slate-300 font-semibold">üìä Visualizar M√©tricas:</span>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => setNofapMetricsView('monthly')}
                                                                className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                                                    nofapMetricsView === 'monthly'
                                                                        ? 'bg-blue-600 text-white shadow-lg'
                                                                        : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                                }`}
                                                            >
                                                                üìÖ Este M√™s
                                                            </button>
                                                            <button
                                                                onClick={() => setNofapMetricsView('alltime')}
                                                                className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                                                    nofapMetricsView === 'alltime'
                                                                        ? 'bg-cyan-600 text-white shadow-lg'
                                                                        : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                                }`}
                                                            >
                                                                üèÜ Todos os Tempos
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* M√©tricas Hist√≥ricas ALL TIME NoFap */}
                                            {nofapMetricsView === 'alltime' && totalDaysTracked > 0 && (
                                                <div className="bg-gradient-to-br from-cyan-900/50 to-blue-900/50 backdrop-blur rounded-xl p-6 border-2 border-cyan-500/50 shadow-xl">
                                                    <h3 className="text-2xl font-bold mb-6 flex items-center">
                                                        <span className="mr-2 text-3xl">üèÜ</span>
                                                        Legado de Transforma√ß√£o - TOTAIS (Desde o In√≠cio)
                                                    </h3>
                                                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                                                        <div className="bg-cyan-800/40 rounded-lg p-4 text-center border-2 border-cyan-400/40">
                                                            <div className="text-5xl font-black text-cyan-300 mb-2">
                                                                {totalCleanDays}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">‚úÖ Dias Limpos</div>
                                                            <div className="text-xs text-cyan-200 mt-1">TOTAL HIST√ìRICO</div>
                                                        </div>
                                                        <div className="bg-blue-800/40 rounded-lg p-4 text-center border-2 border-blue-400/40">
                                                            <div className="text-5xl font-black text-blue-300 mb-2">
                                                                {longestStreak}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">üèÜ Melhor Streak</div>
                                                            <div className="text-xs text-blue-200 mt-1">RECORDE PESSOAL</div>
                                                        </div>
                                                        <div className="bg-green-800/40 rounded-lg p-4 text-center border-2 border-green-400/40">
                                                            <div className="text-5xl font-black text-green-300 mb-2">
                                                                {successRate.toFixed(0)}%
                                                            </div>
                                                            <div className="text-sm font-bold text-white">üìä Taxa</div>
                                                            <div className="text-xs text-green-200 mt-1">SUCESSO TOTAL</div>
                                                        </div>
                                                        <div className="bg-purple-800/40 rounded-lg p-4 text-center border-2 border-purple-400/40">
                                                            <div className="text-5xl font-black text-purple-300 mb-2">
                                                                {totalRelapses}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">‚ö†Ô∏è Reca√≠das</div>
                                                            <div className="text-xs text-purple-200 mt-1">TOTAL</div>
                                                        </div>
                                                        <div className="bg-pink-800/40 rounded-lg p-4 text-center border-2 border-pink-400/40">
                                                            <div className="text-5xl font-black text-pink-300 mb-2">
                                                                {daysSinceStartNofap}
                                                            </div>
                                                            <div className="text-sm font-bold text-white">üåü Jornada</div>
                                                            <div className="text-xs text-pink-200 mt-1">DIAS TOTAIS</div>
                                                        </div>
                                                    </div>
                                                    <div className="mt-4 text-center p-3 bg-gradient-to-r from-cyan-900/50 to-blue-900/50 rounded-lg border border-cyan-400/30">
                                                        <p className="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 to-blue-300">
                                                            {successRate >= 90 ? 'üí™üî• Voc√™ √© um guerreiro IMBAT√çVEL!' : 
                                                             successRate >= 75 ? 'üí™ Seu dom√≠nio est√° CRESCENDO! Continue forte!' :
                                                             successRate >= 50 ? '‚öîÔ∏è Voc√™ est√° na LUTA! Cada dia limpo √© uma vit√≥ria!' :
                                                             'üå± A jornada come√ßou. Persist√™ncia √© a CHAVE!'}
                                                        </p>
                                                    </div>
                                                </div>
                                            )}

                                            {/* M√©tricas do M√™s Atual NoFap */}
                                            {nofapMetricsView === 'monthly' && totalDaysTracked > 0 && (
                                                <div className="bg-gradient-to-br from-blue-900/50 to-indigo-900/50 backdrop-blur rounded-xl p-6 border border-blue-700/50">
                                                    <h3 className="text-xl font-bold mb-6 flex items-center">
                                                        <span className="mr-2 text-2xl">üìÖ</span>
                                                        Progresso deste M√™s
                                                    </h3>
                                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                                        <div className="bg-cyan-800/30 rounded-lg p-4 text-center border border-cyan-500/30">
                                                            <div className="text-4xl font-bold text-cyan-300">
                                                                {thisMonthClean}
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">‚úÖ Dias Limpos</div>
                                                            <div className="text-xs text-slate-400 mt-1">Este m√™s</div>
                                                        </div>
                                                        <div className="bg-blue-800/30 rounded-lg p-4 text-center border border-blue-500/30">
                                                            <div className="text-4xl font-bold text-blue-300">
                                                                {thisMonthData.length - thisMonthClean}
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">‚ö†Ô∏è Reca√≠das</div>
                                                            <div className="text-xs text-slate-400 mt-1">Este m√™s</div>
                                                        </div>
                                                        <div className="bg-green-800/30 rounded-lg p-4 text-center border border-green-500/30">
                                                            <div className="text-4xl font-bold text-green-300">
                                                                {thisMonthData.length > 0 ? ((thisMonthClean / thisMonthData.length) * 100).toFixed(0) : 0}%
                                                            </div>
                                                            <div className="text-xs text-slate-300 mt-2">üìä Taxa</div>
                                                            <div className="text-xs text-slate-400 mt-1">Este m√™s</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* Alert System */}
                                            {recentHighUrge > 0 && (
                                                <div className="bg-gradient-to-br from-orange-900/50 to-red-900/50 backdrop-blur rounded-xl p-6 border border-orange-700/50">
                                                    <h3 className="text-xl font-bold mb-4 flex items-center text-orange-300">
                                                        <span className="mr-2 text-2xl">‚ö†Ô∏è</span>
                                                        Alerta: Zona de Perigo
                                                    </h3>
                                                    <p className="text-slate-200 mb-4">
                                                        Voc√™ teve <span className="font-bold text-orange-400">{recentHighUrge} dia{recentHighUrge > 1 ? 's' : ''}</span> com urges altos na √∫ltima semana.
                                                    </p>
                                                    <div className="bg-slate-800/50 rounded-lg p-4">
                                                        <div className="font-bold text-white mb-2">üí° Estrat√©gias Emergenciais:</div>
                                                        <ul className="text-sm text-slate-300 space-y-1 list-disc list-inside">
                                                            <li>Fa√ßa 20 flex√µes ou polichinelos AGORA</li>
                                                            <li>Tome um banho gelado</li>
                                                            <li>Saia de casa imediatamente</li>
                                                            <li>Ligue para um amigo ou familiar</li>
                                                            <li>Pratique medita√ß√£o de 5 minutos</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            )}

                                            {/* An√°lise de Progresso e Evolu√ß√£o */}
                                            {nofapData.length >= 14 && (() => {
                                                const last14Days = nofapData.slice(0, 14);
                                                const first7 = last14Days.slice(7, 14);
                                                const last7 = last14Days.slice(0, 7);
                                                
                                                const cleanFirst7 = first7.filter(log => log.cleanDay).length;
                                                const cleanLast7 = last7.filter(log => log.cleanDay).length;
                                                const improvement = cleanLast7 - cleanFirst7;
                                                
                                                const avgUrgeFirst7 = first7.reduce((acc, log) => acc + (log.urgeLevel || 0), 0) / first7.length;
                                                const avgUrgeLast7 = last7.reduce((acc, log) => acc + (log.urgeLevel || 0), 0) / last7.length;
                                                const urgeReduction = avgUrgeFirst7 - avgUrgeLast7;
                                                
                                                return (
                                                    <div className="bg-gradient-to-br from-green-900/50 to-emerald-900/50 backdrop-blur rounded-xl p-6 border border-green-700/50">
                                                        <h3 className="text-xl font-bold mb-4 flex items-center text-green-200">
                                                            <span className="mr-2 text-2xl">üìà</span>
                                                            Sua Evolu√ß√£o (√öltimas 2 Semanas)
                                                        </h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                            <div className="bg-green-800/30 rounded-lg p-4 text-center border border-green-500/30">
                                                                <div className="text-sm text-slate-300 mb-2">Dias Limpos</div>
                                                                <div className="flex items-center justify-center gap-3">
                                                                    <div className="text-2xl font-bold text-slate-400">{cleanFirst7}</div>
                                                                    <div className="text-2xl">‚Üí</div>
                                                                    <div className="text-2xl font-bold text-green-300">{cleanLast7}</div>
                                                                </div>
                                                                <div className={`text-xs mt-2 font-bold ${
                                                                    improvement > 0 ? 'text-green-300' : 
                                                                    improvement < 0 ? 'text-red-300' : 'text-slate-400'
                                                                }`}>
                                                                    {improvement > 0 ? `+${improvement} dias! ‚ÜóÔ∏è` : 
                                                                     improvement < 0 ? `${improvement} dias ‚ÜòÔ∏è` : 'Manteve ‚öñÔ∏è'}
                                                                </div>
                                                            </div>
                                                            <div className="bg-blue-800/30 rounded-lg p-4 text-center border border-blue-500/30">
                                                                <div className="text-sm text-slate-300 mb-2">Intensidade de Urges</div>
                                                                <div className="flex items-center justify-center gap-3">
                                                                    <div className="text-2xl font-bold text-slate-400">{avgUrgeFirst7.toFixed(1)}</div>
                                                                    <div className="text-2xl">‚Üí</div>
                                                                    <div className="text-2xl font-bold text-blue-300">{avgUrgeLast7.toFixed(1)}</div>
                                                                </div>
                                                                <div className={`text-xs mt-2 font-bold ${
                                                                    urgeReduction > 0.5 ? 'text-green-300' : 
                                                                    urgeReduction < -0.5 ? 'text-red-300' : 'text-slate-400'
                                                                }`}>
                                                                    {urgeReduction > 0.5 ? `Diminuiu ${urgeReduction.toFixed(1)}! üìâ` : 
                                                                     urgeReduction < -0.5 ? `Aumentou ${Math.abs(urgeReduction).toFixed(1)} üìà` : 'Est√°vel ‚öñÔ∏è'}
                                                                </div>
                                                            </div>
                                                            <div className={`rounded-lg p-4 text-center border ${
                                                                improvement >= 2 || urgeReduction > 1 ? 'bg-green-800/30 border-green-500/30' :
                                                                improvement >= 0 && urgeReduction >= 0 ? 'bg-yellow-800/30 border-yellow-500/30' :
                                                                'bg-orange-800/30 border-orange-500/30'
                                                            }`}>
                                                                <div className="text-3xl mb-2">
                                                                    {improvement >= 2 || urgeReduction > 1 ? 'üöÄ' :
                                                                     improvement >= 0 && urgeReduction >= 0 ? 'üìä' : '‚ö†Ô∏è'}
                                                                </div>
                                                                <div className="text-sm font-bold text-white">
                                                                    {improvement >= 2 || urgeReduction > 1 ? 'Evolu√ß√£o Forte!' :
                                                                     improvement >= 0 && urgeReduction >= 0 ? 'Em Progresso' : 'Aten√ß√£o Necess√°ria'}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="mt-4 p-3 bg-slate-800/50 rounded-lg border-l-4 border-green-400">
                                                            <p className="text-xs text-green-200">
                                                                {improvement >= 2 || urgeReduction > 1 ? 
                                                                    'üí™ Excelente progresso! Voc√™ est√° ficando mais forte. Continue!' :
                                                                 improvement >= 0 && urgeReduction >= 0 ? 
                                                                    'üå± Voc√™ est√° no caminho certo. Mantenha o foco!' :
                                                                    '‚öîÔ∏è Momento de refor√ßar as defesas. Revise seus gatilhos e fortale√ßa o protocolo.'}
                                                            </p>
                                                        </div>
                                                    </div>
                                                );
                                            })()}

                                            {/* Momentos de Maior Desafio (An√°lise Temporal) */}
                                            {nofapData.length >= 10 && (() => {
                                                const relapses = nofapData.filter(log => !log.cleanDay);
                                                if (relapses.length === 0) return null;
                                                
                                                // An√°lise por dia da semana
                                                const dayCount = {};
                                                const dayNames = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
                                                relapses.forEach(log => {
                                                    const day = new Date(log.date).getDay();
                                                    dayCount[day] = (dayCount[day] || 0) + 1;
                                                });
                                                
                                                const maxDay = Object.entries(dayCount).sort((a, b) => b[1] - a[1])[0];
                                                const riskDay = maxDay ? dayNames[maxDay[0]] : null;
                                                
                                                return (
                                                    <div className="bg-gradient-to-br from-orange-900/50 to-red-900/50 backdrop-blur rounded-xl p-6 border border-orange-700/50">
                                                        <h3 className="text-xl font-bold mb-4 flex items-center text-orange-200">
                                                            <span className="mr-2 text-2xl">üéØ</span>
                                                            Mapeamento de Gatilhos
                                                        </h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                            <div className="bg-red-800/30 rounded-lg p-4 border border-red-500/30">
                                                                <div className="text-lg font-bold text-red-200 mb-2">üìÖ Dia Mais Desafiador</div>
                                                                <div className="text-3xl font-bold text-red-300">{riskDay}</div>
                                                                <div className="text-xs text-slate-300 mt-2">
                                                                    {maxDay[1]} reca√≠da{maxDay[1] > 1 ? 's' : ''} registrada{maxDay[1] > 1 ? 's' : ''}
                                                                </div>
                                                                <div className="mt-3 p-2 bg-slate-800/50 rounded text-xs text-slate-300">
                                                                    üí° Prepare-se com anteced√™ncia neste dia!
                                                                </div>
                                                            </div>
                                                            <div className="bg-yellow-800/30 rounded-lg p-4 border border-yellow-500/30">
                                                                <div className="text-lg font-bold text-yellow-200 mb-2">‚ö†Ô∏è Padr√µes Detectados</div>
                                                                <div className="space-y-2 text-sm text-slate-300">
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-lg">üî¥</span>
                                                                        <span>Reca√≠das totais: {relapses.length}</span>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-lg">üìä</span>
                                                                        <span>Frequ√™ncia: a cada {Math.round(nofapData.length / relapses.length)} dias</span>
                                                                    </div>
                                                                </div>
                                                                <div className="mt-3 p-2 bg-slate-800/50 rounded text-xs text-slate-300">
                                                                    üí™ Use esse conhecimento a seu favor!
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="mt-4 p-4 bg-gradient-to-r from-purple-900/40 to-blue-900/40 rounded-lg border border-purple-500/40">
                                                            <div className="font-bold text-purple-200 mb-2">üõ°Ô∏è Estrat√©gia de Defesa para {riskDay}:</div>
                                                            <ul className="text-xs text-slate-300 space-y-1 ml-4 list-disc">
                                                                <li>Programe atividades para ocupar seu tempo</li>
                                                                <li>Reforce o protocolo espiritual pela manh√£</li>
                                                                <li>Tenha um plano de escape (exerc√≠cio, liga√ß√£o, sair de casa)</li>
                                                                <li>Evite situa√ß√µes de risco (solid√£o, t√©dio, acesso livre √† internet)</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                );
                                            })()}

                                            {/* Correla√ß√£o Espiritualidade x NoFap */}
                                            {spiritualModeEnabled && nofapData.length > 10 && (
                                                (() => {
                                                    // An√°lise de correla√ß√£o
                                                    const last30Days = nofapData.slice(0, 30);
                                                    let daysWithMeditation = 0;
                                                    let cleanDaysWithMeditation = 0;
                                                    let cleanDaysWithoutMeditation = 0;
                                                    let daysWithoutMeditation = 0;
                                                    
                                                    last30Days.forEach(log => {
                                                        const hasMeditations = log.meditations && log.meditations.length > 0;
                                                        const hasProtocol = log.meditations?.some(m => m.type === 'limpeza-propria') &&
                                                                          log.meditations?.some(m => m.type === 'protecao') &&
                                                                          log.meditations?.some(m => m.type === 'conexao');
                                                        
                                                        if (hasProtocol) {
                                                            daysWithMeditation++;
                                                            if (log.cleanDay) cleanDaysWithMeditation++;
                                                        } else {
                                                            daysWithoutMeditation++;
                                                            if (log.cleanDay) cleanDaysWithoutMeditation++;
                                                        }
                                                    });
                                                    
                                                    const successRateWithMeditation = daysWithMeditation > 0 ? 
                                                        (cleanDaysWithMeditation / daysWithMeditation * 100) : 0;
                                                    const successRateWithoutMeditation = daysWithoutMeditation > 0 ? 
                                                        (cleanDaysWithoutMeditation / daysWithoutMeditation * 100) : 0;
                                                    const correlation = successRateWithMeditation - successRateWithoutMeditation;
                                                    
                                                    if (daysWithMeditation >= 5 && daysWithoutMeditation >= 5) {
                                                        return (
                                                            <div className="bg-gradient-to-br from-purple-900/50 to-cyan-900/50 backdrop-blur rounded-xl p-6 border border-purple-700/50">
                                                                <h3 className="text-xl font-bold mb-4 flex items-center text-purple-200">
                                                                    <span className="mr-2 text-2xl">üîÆ</span>
                                                                    Conex√£o: Espiritualidade √ó NoFap
                                                                </h3>
                                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                                    <div className="bg-purple-800/30 rounded-lg p-4 text-center border border-purple-500/30">
                                                                        <div className="text-3xl font-bold text-purple-300">
                                                                            {successRateWithMeditation.toFixed(0)}%
                                                                        </div>
                                                                        <div className="text-xs text-slate-300 mt-2">Sucesso COM Protocolo</div>
                                                                    </div>
                                                                    <div className="bg-slate-800/30 rounded-lg p-4 text-center border border-slate-500/30">
                                                                        <div className="text-3xl font-bold text-slate-300">
                                                                            {successRateWithoutMeditation.toFixed(0)}%
                                                                        </div>
                                                                        <div className="text-xs text-slate-300 mt-2">Sucesso SEM Protocolo</div>
                                                                    </div>
                                                                    <div className={`rounded-lg p-4 text-center border ${
                                                                        correlation > 20 ? 'bg-green-800/30 border-green-500/30' :
                                                                        correlation > 0 ? 'bg-yellow-800/30 border-yellow-500/30' :
                                                                        'bg-red-800/30 border-red-500/30'
                                                                    }`}>
                                                                        <div className={`text-3xl font-bold ${
                                                                            correlation > 20 ? 'text-green-300' :
                                                                            correlation > 0 ? 'text-yellow-300' :
                                                                            'text-red-300'
                                                                        }`}>
                                                                            {correlation > 0 ? '+' : ''}{correlation.toFixed(0)}%
                                                                        </div>
                                                                        <div className="text-xs text-slate-300 mt-2">Diferen√ßa</div>
                                                                    </div>
                                                                </div>
                                                                <div className="mt-4 p-4 bg-slate-800/50 rounded-lg border-l-4 border-purple-400">
                                                                    <div className="font-bold text-purple-200 mb-2">üí° Insight:</div>
                                                                    <p className="text-sm text-slate-300">
                                                                        {correlation > 20 ? 
                                                                            '‚ú® CORRELA√á√ÉO FORTE! O Protocolo Espiritual est√° te protegendo! Dias com pr√°ticas t√™m muito mais sucesso no NoFap.' :
                                                                         correlation > 10 ?
                                                                            'üåü H√° uma correla√ß√£o positiva. As pr√°ticas espirituais est√£o te ajudando na jornada NoFap.' :
                                                                         correlation > 0 ?
                                                                            'üí´ Leve correla√ß√£o positiva. Continue com as pr√°ticas para fortalecer sua prote√ß√£o.' :
                                                                            '‚ö†Ô∏è Os dados n√£o mostram correla√ß√£o clara ainda. Continue praticando e observe os padr√µes.'}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        );
                                                    }
                                                    return null;
                                                })()
                                            )}

                                            {/* Calend√°rio Visual de Streaks */}
                                            <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                <h3 className="text-xl font-bold mb-6 flex items-center">
                                                    <span className="mr-2 text-2xl">üìÖ</span>
                                                    Calend√°rio NoFap (√öltimos 30 dias)
                                                </h3>
                                                <div className="grid grid-cols-10 gap-1">
                                                    {(() => {
                                                        const last30Days = [];
                                                        for (let i = 29; i >= 0; i--) {
                                                            const date = new Date();
                                                            date.setDate(date.getDate() - i);
                                                            const dateStr = date.toISOString().split('T')[0];
                                                            const dayLog = dailyLogs.find(log => log.date === dateStr);
                                                            
                                                            let bgColor = 'bg-slate-700/30';
                                                            let title = 'Sem registro';
                                                            
                                                            if (dayLog && dayLog.cleanDay !== undefined) {
                                                                if (!dayLog.cleanDay) {
                                                                    bgColor = 'bg-red-600';
                                                                    title = 'Reca√≠da';
                                                                } else if (dayLog.urgeLevel >= 7) {
                                                                    bgColor = 'bg-orange-500';
                                                                    title = `Dia limpo mas urge alto (${dayLog.urgeLevel})`;
                                                                } else if (dayLog.urgeLevel >= 4) {
                                                                    bgColor = 'bg-yellow-500';
                                                                    title = `Dia limpo com urge moderado (${dayLog.urgeLevel})`;
                                                                } else {
                                                                    bgColor = 'bg-green-500';
                                                                    title = `Dia limpo e tranquilo (${dayLog.urgeLevel})`;
                                                                }
                                                            }
                                                            
                                                            last30Days.push(
                                                                <div
                                                                    key={dateStr}
                                                                    className={`w-full aspect-square rounded ${bgColor} transition-all hover:scale-110 cursor-pointer`}
                                                                    title={`${date.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'})} - ${title}`}
                                                                />
                                                            );
                                                        }
                                                        return last30Days;
                                                    })()}
                                                </div>
                                                <div className="mt-4 flex flex-wrap gap-3 text-xs">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded"></div>
                                                        <span className="text-slate-300">Limpo + tranquilo</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-yellow-500 rounded"></div>
                                                        <span className="text-slate-300">Limpo + urge moderado</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-orange-500 rounded"></div>
                                                        <span className="text-slate-300">Limpo + urge alto</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-red-600 rounded"></div>
                                                        <span className="text-slate-300">Reca√≠da</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 bg-slate-700/30 rounded"></div>
                                                        <span className="text-slate-300">Sem registro</span>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Stats Grid */}
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                <div className="bg-gradient-to-br from-blue-900/50 to-cyan-900/50 backdrop-blur rounded-xl p-6 border border-blue-700/50">
                                                    <div className="text-4xl font-bold text-cyan-300">
                                                        {nofapData.length}
                                                    </div>
                                                    <div className="text-sm text-slate-300 mt-2">üìÖ Dias rastreados</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-green-900/50 to-emerald-900/50 backdrop-blur rounded-xl p-6 border border-green-700/50">
                                                    <div className="text-4xl font-bold text-green-300">
                                                        {((nofapData.filter(log => log.cleanDay).length / nofapData.length) * 100 || 0).toFixed(0)}%
                                                    </div>
                                                    <div className="text-sm text-slate-300 mt-2">‚úÖ Taxa de sucesso</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-purple-900/50 to-pink-900/50 backdrop-blur rounded-xl p-6 border border-purple-700/50">
                                                    <div className="text-4xl font-bold text-purple-300">
                                                        {(() => {
                                                            const recentUrges = nofapData.slice(0, 7).filter(log => log.cleanDay && log.urgeLevel);
                                                            const avgUrge = recentUrges.reduce((acc, log) => acc + parseInt(log.urgeLevel || 0), 0) / (recentUrges.length || 1);
                                                            return avgUrge.toFixed(1);
                                                        })()}
                                                    </div>
                                                    <div className="text-sm text-slate-300 mt-2">üåä Urge m√©dio (7 dias)</div>
                                                </div>
                                                <div className="bg-gradient-to-br from-red-900/50 to-orange-900/50 backdrop-blur rounded-xl p-6 border border-red-700/50">
                                                    <div className="text-4xl font-bold text-red-300">
                                                        {totalRelapses}
                                                    </div>
                                                    <div className="text-sm text-slate-300 mt-2">‚ö†Ô∏è Total de reca√≠das</div>
                                                </div>
                                            </div>

                                            {/* An√°lise de Padr√µes e Gatilhos */}
                                            {totalRelapses > 0 && (
                                                <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                    <h3 className="text-xl font-bold mb-6 flex items-center">
                                                        <span className="mr-2 text-2xl">üîç</span>
                                                        An√°lise de Padr√µes e Gatilhos
                                                    </h3>
                                                    {(() => {
                                                        const relapses = nofapData.filter(log => !log.cleanDay);
                                                        const relapsesByDay = {};
                                                        const relapsesByHour = {}; // Se tiv√©ssemos hora
                                                        
                                                        relapses.forEach(relapse => {
                                                            const date = new Date(relapse.date);
                                                            const dayName = date.toLocaleDateString('pt-BR', {weekday: 'long'});
                                                            relapsesByDay[dayName] = (relapsesByDay[dayName] || 0) + 1;
                                                        });
                                                        
                                                        // Detecta padr√£o de dias antes de reca√≠da
                                                        let highUrgeBeforeRelapse = 0;
                                                        relapses.forEach(relapse => {
                                                            const relapseDate = new Date(relapse.date);
                                                            const dayBefore = new Date(relapseDate);
                                                            dayBefore.setDate(dayBefore.getDate() - 1);
                                                            const dayBeforeStr = dayBefore.toISOString().split('T')[0];
                                                            const prevDayLog = dailyLogs.find(log => log.date === dayBeforeStr);
                                                            
                                                            if (prevDayLog && prevDayLog.urgeLevel >= 7) {
                                                                highUrgeBeforeRelapse++;
                                                            }
                                                        });
                                                        
                                                        const mostCommonDay = Object.entries(relapsesByDay).sort((a, b) => b[1] - a[1])[0];
                                                        
                                                        return (
                                                            <div className="space-y-4">
                                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                                    <div className="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                                                                        <div className="font-bold text-red-300 mb-2">üìä Dia da Semana Mais Cr√≠tico</div>
                                                                        {mostCommonDay ? (
                                                                            <p className="text-white text-xl font-bold capitalize">
                                                                                {mostCommonDay[0]} <span className="text-sm text-slate-300">({mostCommonDay[1]} reca√≠das)</span>
                                                                            </p>
                                                                        ) : (
                                                                            <p className="text-slate-400">Dados insuficientes</p>
                                                                        )}
                                                                        <p className="text-xs text-slate-400 mt-2">Fique extra vigilante neste dia!</p>
                                                                    </div>
                                                                    
                                                                    <div className="bg-orange-900/30 rounded-lg p-4 border border-orange-500/30">
                                                                        <div className="font-bold text-orange-300 mb-2">‚ö†Ô∏è Urges Altos ‚Üí Reca√≠da</div>
                                                                        <p className="text-white text-xl font-bold">
                                                                            {highUrgeBeforeRelapse}/{relapses.length}
                                                                        </p>
                                                                        <p className="text-xs text-slate-400 mt-2">
                                                                            {highUrgeBeforeRelapse > 0 ? 
                                                                                `${Math.round(highUrgeBeforeRelapse/relapses.length * 100)}% das reca√≠das foram precedidas por urges altos!` :
                                                                                'Nenhuma correla√ß√£o detectada ainda'}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div className="bg-blue-900/30 rounded-lg p-4 border border-blue-500/30">
                                                                    <div className="font-bold text-blue-300 mb-3">üí° Estrat√©gias Baseadas nos Seus Dados</div>
                                                                    <ul className="text-sm text-slate-300 space-y-2">
                                                                        {mostCommonDay && mostCommonDay[1] >= 2 && (
                                                                            <li className="flex items-start gap-2">
                                                                                <span className="text-yellow-400">‚Ä¢</span>
                                                                                <span>Nas {mostCommonDay[0]}s, planeje atividades fora de casa ou com outras pessoas</span>
                                                                            </li>
                                                                        )}
                                                                        {highUrgeBeforeRelapse > 0 && (
                                                                            <li className="flex items-start gap-2">
                                                                                <span className="text-yellow-400">‚Ä¢</span>
                                                                                <span>Quando urge atingir 7+, ative IMEDIATAMENTE o protocolo de emerg√™ncia</span>
                                                                            </li>
                                                                        )}
                                                                        <li className="flex items-start gap-2">
                                                                            <span className="text-yellow-400">‚Ä¢</span>
                                                                            <span>Seu recorde √© {longestStreak} dias - voc√™ J√Å provou que consegue!</span>
                                                                        </li>
                                                                        {currentStreak > longestStreak * 0.7 && currentStreak > 0 && (
                                                                            <li className="flex items-start gap-2">
                                                                                <span className="text-green-400">‚Ä¢</span>
                                                                                <span className="font-bold">ATEN√á√ÉO: Efeito Ca√ßador detectado! Voc√™ est√° em {Math.round(currentStreak/longestStreak * 100)}% do seu recorde. Mantenha-se humilde e vigilante!</span>
                                                                            </li>
                                                                        )}
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        );
                                                    })()}
                                                </div>
                                            )}

                                            {/* Motivational Message */}
                                            {currentStreak >= 7 && (
                                                <div className="bg-gradient-to-br from-yellow-900/50 to-amber-900/50 backdrop-blur rounded-xl p-6 border border-yellow-700/50">
                                                    <h3 className="text-2xl font-bold mb-4 flex items-center text-yellow-300">
                                                        <span className="mr-2 text-3xl">‚≠ê</span>
                                                        Parab√©ns Guerreiro!
                                                    </h3>
                                                    <p className="text-slate-200 text-lg">
                                                        {currentStreak >= 90 ? 'üèÜ Voc√™ √© uma LENDA! 90+ dias √© transforma√ß√£o completa!' :
                                                         currentStreak >= 30 ? 'üî• Um m√™s limpo! Seus receptores de dopamina est√£o se recuperando!' :
                                                         currentStreak >= 7 ? 'üí™ Uma semana! A primeira √© a mais dif√≠cil. Continue!' : ''}
                                                    </p>
                                                </div>
                                            )}

                                            {/* Journal NoFap - Hist√≥rico de Dias */}
                                            {nofapData.length > 0 && (
                                                <div className="bg-slate-800/50 backdrop-blur rounded-xl p-6 border border-slate-700">
                                                    <h3 className="text-xl font-bold mb-6 flex items-center">
                                                        <span className="mr-2 text-2xl">üìñ</span>
                                                        Journal NoFap (√öltimos 15 Dias)
                                                    </h3>
                                                    <div className="space-y-4">
                                                        {nofapData.slice(0, 15).map(log => {
                                                            const isRelapse = !log.cleanDay;
                                                            const hasHighUrge = log.urgeLevel >= 7;
                                                            
                                                            return (
                                                                <div key={log.id} className={`rounded-lg p-4 border transition-all ${
                                                                    isRelapse ? 'bg-red-900/20 border-red-500/50' :
                                                                    hasHighUrge ? 'bg-orange-900/20 border-orange-500/50' :
                                                                    'bg-slate-700/30 border-slate-600/50 hover:border-cyan-500/50'
                                                                }`}>
                                                                    <div className="flex items-start justify-between mb-3">
                                                                        <div>
                                                                            <div className="font-bold text-white flex items-center gap-2">
                                                                                üìÖ {new Date(log.date).toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long' })}
                                                                                {isRelapse ? 
                                                                                    <span className="text-xs bg-red-500/30 text-red-200 px-2 py-1 rounded border border-red-500/50">‚ö†Ô∏è Reca√≠da</span> :
                                                                                    <span className="text-xs bg-green-500/20 text-green-300 px-2 py-1 rounded border border-green-500/30">‚úÖ Limpo</span>
                                                                                }
                                                                            </div>
                                                                            {!isRelapse && (
                                                                                <div className="text-xs text-slate-400 mt-1 flex items-center gap-2">
                                                                                    <span>N√≠vel de Urge:</span>
                                                                                    <div className="flex gap-0.5">
                                                                                        {[...Array(10)].map((_, i) => (
                                                                                            <div key={i} className={`w-2 h-3 rounded-sm ${
                                                                                                i < (log.urgeLevel || 0) ?
                                                                                                    (log.urgeLevel >= 7 ? 'bg-red-500' :
                                                                                                     log.urgeLevel >= 4 ? 'bg-yellow-500' :
                                                                                                     'bg-green-500') :
                                                                                                'bg-slate-600'
                                                                                            }`} />
                                                                                        ))}
                                                                                    </div>
                                                                                    <span className={`font-bold ${
                                                                                        log.urgeLevel >= 7 ? 'text-red-400' :
                                                                                        log.urgeLevel >= 4 ? 'text-yellow-400' :
                                                                                        'text-green-400'
                                                                                    }`}>{log.urgeLevel || 0}/10</span>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {/* Notas do dia */}
                                                                    {log.nofapNotes && (
                                                                        <div className={`rounded p-3 border-l-4 ${
                                                                            isRelapse ? 'bg-red-800/30 border-red-500' :
                                                                            hasHighUrge ? 'bg-orange-800/30 border-orange-500' :
                                                                            'bg-slate-800/50 border-cyan-500'
                                                                        }`}>
                                                                            <div className={`text-xs font-semibold mb-1 ${
                                                                                isRelapse ? 'text-red-300' :
                                                                                hasHighUrge ? 'text-orange-300' :
                                                                                'text-cyan-300'
                                                                            }`}>
                                                                                {isRelapse ? '‚ö†Ô∏è Reflex√£o sobre a reca√≠da:' :
                                                                                 hasHighUrge ? 'üåä Momento cr√≠tico:' :
                                                                                 'üìù Reflex√£o:'}
                                                                            </div>
                                                                            <div className="text-sm text-slate-300 italic">{log.nofapNotes}</div>
                                                                        </div>
                                                                    )}
                                                                    
                                                                    {/* Alertas espec√≠ficos */}
                                                                    {!isRelapse && hasHighUrge && (
                                                                        <div className="mt-2 text-xs bg-orange-600/20 border border-orange-500 rounded p-2 text-orange-200">
                                                                            ‚ö†Ô∏è Este foi um dia de teste! Voc√™ resistiu a um urge alto - isso √© crescimento!
                                                                        </div>
                                                                    )}
                                                                    {isRelapse && (
                                                                        <div className="mt-2 text-xs bg-blue-600/20 border border-blue-500 rounded p-2 text-blue-200">
                                                                            üí° Identifique os gatilhos deste dia. O que voc√™ pode fazer diferente da pr√≥xima vez?
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            )}

                                            {nofapData.length === 0 && (
                                                <div className="text-center py-12 text-slate-400 bg-slate-800/50 rounded-xl p-8 border border-slate-700">
                                                    <span className="text-6xl mb-4 block">üí™</span>
                                                    <p className="text-lg mb-2">Comece sua jornada NoFap hoje!</p>
                                                    <p className="text-sm">Registre seus dias e acompanhe seu progresso rumo √† liberdade.</p>
                                                </div>
                                            )}
                                        </>
                                    );
                                })()}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BodyTracker />);
    </script>
</body>
</html>